(function(d){d.vmApp=function(){return{apps:["Whiteboard","ScreenShare"],appSessionEnd:"vAppSessionEnd",appAudioTest:"vAppAudioTest",rWidgetConfig:{id:"audioWidget"},wb:"",ss:"",wss:"",rw:"",lang:{},error:[],gObj:{uid:d.wbUser.id,uRole:d.wbUser.role,uName:d.wbUser.name},init:function(a,b){this.wbConfig={id:"vApp"+this.apps[0],classes:"appOptions"};this.ssConfig={id:"vApp"+this.apps[1],classes:"appOptions"};this.wssConfig={id:"vApp"+this.apps[2],classes:"appOptions"};this.user=new d.user;this.lang.getString=
d.getString;this.lang.message=d.message;this.vutil=d.vutil;this.media=d.media;this.system=d.system;this.recorder=d.recorder;this.clear="";this.currApp=b;this.storage=d.storage;this.storage.init();this.dirtyCorner=d.dirtyCorner;this.html.init(this);this.adapter=d.adapter;this.makeAppReady(b,"byclick");this.system.check();this.vutil.isSystemCompatible();vApp.wb.utility.displayCanvas();b==this.apps[1]&&this.system.setAppDimension();vApp.user.assignRole(vApp.gObj.uRole,b);"t"==vApp.gObj.uRole&&vcan.utility.canvasCalcOffset(vcan.main.canid);
this.gObj.video=new d.vApp.media;this.initSocketConn();vApp.chat=new Chat;vApp.chat.init()},initSocketConn:function(){if(this.system.webSocket){var a=d.wbUser;vApp.uInfo={userid:a.id,sid:a.sid,rid:a.path,authuser:a.auth_user,authpass:a.auth_pass,userobj:{userid:a.id,name:a.name,lname:a.lname,img:a.imageurl,role:a.role},room:a.room};io.init(vApp.uInfo);d.userdata=vApp.uInfo}},html:{id:"vAppCont",optionsClass:"appOptions",init:function(a){this.vapp=a},optionsWithWrapper:function(){var a=document.getElementById(this.id),
b=this.createElement("div","vAppOptionsCont");a.insertBefore(b,a.firstChild);this.createDiv(vApp.wbConfig.id+"Tool","whiteboard",b,vApp.wbConfig.classes);this.createDiv(vApp.ssConfig.id+"Tool","screenshare",b,vApp.ssConfig.classes);"t"==vApp.gObj.uRole&&this.createDiv(vApp.appSessionEnd+"Tool","sessionend",b,"appOptions")},createDiv:function(a,b,c,f,g){var d=document.createElement("a");d.href="#";var h=document.createElement("div");h.id=a;"undefined "!=typeof f&&(h.className=f);a=document.createElement("span");
a.className="icon-"+b;d.appendChild(a);d.dataset.title=vApp.lang.getString(b);d.className="tooltip";h.appendChild(d);"undefined"!=typeof g?(g=document.getElementById("vAppScreenShareTool"),c.replaceChild(h,g)):c.appendChild(h)},createElement:function(a,b,c){a=document.createElement(a);"undefined"!=typeof b&&(a.id=b);if("undefined"!=typeof c&&1<c.length)for(b=0;b<c.length;b++)a.className+=c[b]+" ";return a}},makeAppReady:function(a,b){if(a==this.apps[0]){"object"==typeof this.ss&&(this.ss.prevStream=
!1);"undefined"!=typeof this.previous&&("undefined"!=typeof b&&"byclick"==b&&vApp.wb.utility.beforeSend({dispWhiteboard:!0}),document.getElementById(vApp.previous).style.display="none");var c=document.getElementById(this.wbConfig.id);null!=c&&(c.style.display="block");"object"!=typeof this.wb&&(this.wb=new d.whiteboard(this.wbConfig),this.wb.utility=new d.utility,this.wb.view=d.view,this.wb.packContainer=new d.packContainer,this.wb.draw_object=d.draw_object,this.wb.makeobj=d.makeobj,this.wb.readyFreeHandObj=
d.readyFreeHandObj,this.wb._replay=_replay,this.wb.readyTextObj=d.readyTextObj,this.wb.bridge=d.bridge,this.wb.response=d.response,this.wb.utility.initUpdateInfo(""));"undefined"!=typeof this.prevScreen&&this.prevScreen.hasOwnProperty("currentStream")&&this.prevScreen.unShareScreen();vApp.hasOwnProperty("prevApp")&&"t"==vApp.gObj.uRole&&vApp.vutil.makeActiveApp("vApp"+a,vApp.prevApp);null!=document.getElementById("canvas")&&(vcan.utility.canvasCalcOffset(vcan.main.canid),vApp.wb.utility.makeCanvasEnable());
"vAppScreenShare"==this.previous&&"t"==vApp.gObj.uRole&&(vApp.vutil.dimensionMatch("vAppWhiteboard","vAppScreenShare")||vApp.wb.utility.lockVapp());this.prevApp=this.previous=this.wbConfig.id}else a==this.apps[1]&&("object"!=typeof this.ss&&(this.ss=new d.screenShare(vApp.ssConfig)),this.ss.init({type:"ss",app:a}))},attachFunction:function(){for(var a=document.getElementsByClassName("appOptions"),b=0;b<a.length;b++){var c=a[b].getElementsByTagName("a")[0],f=this;clickedAnchor=c;c.onclick=function(){f.initlizer(this)}}},
initlizer:function(a){a=a.parentNode.id.split("vApp")[1];if("SessionEndTool"==a){if(!confirm(vApp.lang.getString("startnewsession")))return;a=a.substring(0,a.indexOf("Tool"));vApp.vutil.makeActiveApp("vApp"+a,vApp.previous);vApp.storage.config.endSession();vApp.wb.utility.beforeSend({sEnd:!0});vApp.hasOwnProperty("prevScreen")&&vApp.prevScreen.hasOwnProperty("currentStream")&&vApp.prevScreen.unShareScreen();vApp.prevApp="vApp"+a}else this.currApp=a=a.substring(0,a.indexOf("Tool")),this.PrvAndCurrIsWss(this.previous,
a)?alert("Already the whole screen is being shared."):this.makeAppReady(a,"byclick");"ScreenShare"!=a&&vApp.vutil.removeClass("audioWidget","fixed")},PrvAndCurrIsWss:function(a,b){return"vAppWholeScreenShare"==a&&b==this.apps[2]?!0:!1},prvCurrUsersSame:function(){var a=localStorage.getItem("prvUser");if(null==a)vApp.setPrvUser();else if(a=JSON.parse(a),a.id!=wbUser.id||a.room!=wbUser.room)vApp.gObj.sessionClear=!0,vApp.setPrvUser(),"t"==this.gObj.uRole&&localStorage.setItem("teacherId",wbUser.id)},
setPrvUser:function(){localStorage.clear();localStorage.setItem("prvUser",JSON.stringify({id:wbUser.id,room:wbUser.room}))}}}})(window);(function(d,a){var b={cmdWrapperDiv:"commandToolsWrapper",create:function(a){if("#"==a.charAt(0)){var f=a.substring(1,a.length);b.utility.canvasCalcOffset(f);return new b.main(a)}alert("there is a problem with canvas id")},main:function(c){b.main.children=[];b.main.id=0;b.main.uid=0;b.main.canvas=a.querySelector(c);b.main.canid=c.substring(1,c.length);b.main.currentTransform="";b.main.replayObjs=[];b.main.dragMode=!1;b.main.scaleMode=!1;b.main.usrCurrAction="";b.main.currObj="";b.main.textObj=!1;
b.main.action="create";b.wb={};b.wb.sentPack=!1;b.activMouse=new b.mouse;b.activMouse.init()},extend:function(a,b){if("object"==typeof a&&"object"==typeof b){for(var g in b)a[g]=b[g];return a}alert("it seems that the arguments you passed are not object")},transform:function(a,b){a.translate(b.x,b.y);a.rotate(b.theta);a.scale(b.scaleX*(b.flipX?-1:1),b.scaleY*(b.flipY?-1:1))},getStates:function(a){return b.main[a]},setValInMain:function(a,f){return b.main[a]=f},ArrayIndexOf:function(a,b){if(!b||"function"!=
typeof b||!a||!a.length||1>a.length)return-1;for(var g=0;g<a.length;g++)if(b(a[g]))return g;return-1},renderAll:function(a){var f=b.main.children.length;"object"!=typeof a&&(a=b.main.canvas.getContext("2d"));b.clearContext(a);if(f)for(var g=0;g<f;++g)"freeDrawing"==b.main.children[g].type?b.fhdRender(a,b.main.children[g]):b.render(a,b.main.children[g])},clearContext:function(a){var f=b.main.canvas;a.clearRect(0,0,f.width,f.height);return f},deactivateAll:function(){for(var a=b.main.children,f=0,g=
a.length;f<g;f++)a[f].setActive(!1)},makeDispObject:function(a){return{coreObj:a,bind:function(a,b){this.addEventListener("on"+a,b)}}},remove:function(a){var f=b.main.canvas,g=b.ArrayIndexOf(b.main.children,function(b){return b.id==a.id&&(b.mt==a.mt||!0==a.multiuser)});0<=g&&b.main.children.splice(g,1);var g=f.height,d=f.width,f=f.getContext("2d");f.beginPath();f.clearRect(0,0,d,g);f.closePath();b.renderAll()},render:function(a,f,g){a.beginPath();a.save();a.lineWidth=void 0!==a.lineWidth?f.lineWidth:
2;g||b.transform(a,f);a.strokeStyle=void 0!=f.borderColor?f.borderColor:"#000000";"rectangle"==f.type?b.objRect.draw(a,f,g):"line"==f.type?b.objLine.draw(a,f,g):"oval"==f.type?b.objOval.draw(a,f,g):"triangle"==f.type?b.objTri.draw(a,f,g):"text"==f.type&&b.objTxt.draw(a,f,g);f.active&&!g&&(f.drawBorders(a),f.hideCorners||f.drawCorners(a));a.closePath();a.restore()},fhdRender:function(a,f,g){a.save();var d=f.transformMatrix;d&&a.transform(d[0],d[1],d[2],d[3],d[4],d[5]);g||b.transform(a,f);f.overlayFill?
a.fillStyle=f.overlayFill:f.fill&&(a.fillStyle=f.fill);f.stroke&&(a.strokeStyle=f.stroke);a.beginPath();var h;h=d=0;for(var m=-(f.width/2),n=-(f.height/2),p=0,q=f.path.length;p<q;++p)switch(h=f.path[p],h[0]){case "L":d=h[1];h=h[2];a.lineTo(d+m,h+n);break;case "M":d=h[1],h=h[2],a.moveTo(d+m,h+n)}f.fill&&a.fill();f.stroke&&(a.strokeStyle=f.stroke,a.lineWidth=f.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke());!g&&f.active&&(f.drawBorders(a),f.hideCorners||f.drawCorners(a));a.restore()},makeStackObj:function(a,
b,g,d){return{mt:a,ac:b,x:g,y:d}}};d.vcan=b})(window,document);(function(d,a){d.whiteboard=function(b){var c=b.hasOwnProperty("id")?b.id:"appWhitebaordCont";b=b.hasOwnProperty("class");return{id:c,classes:b,tool:"",obj:{},prvObj:"",replayTime:0,sentPackets:0,sentPackDiv:"sentPacket",sentPackDivPS:"sentPacketPS",receivedPackets:0,receivedPackDiv:"receivedNumber",receivedPackDivPS:"receivedNumberPS",uid:0,lt:"",commandToolsWrapperId:"commandToolsWrapper",view:{},lang:{},system:{},user:{},gObj:{myrepObj:[],replayObjs:[],myArr:[],displayedObjId:0,packQueue:[],virtualWindow:!1},
init:function(){vApp.wb.vcan=d.vcan;var b=vApp.wb.vcan;vApp.wb.canvas=b.create("#canvas");b=b.main.canvas;b.setAttribute("tabindex","0");b.focus();b.onkeydown=vApp.wb.utility.keyOperation;vApp.system.setAppDimension();"undefined"!==typeof Storage&&(d.vApp.wb=vApp.wb);this.arrowInit();var c=vApp.wb.sentPackets;vApp.clear2=setInterval(function(){null!=a.getElementById(vApp.wb.sentPackDivPS)&&(c=vApp.wb.utility.calcPsSentPackets(c),a.getElementById(vApp.wb.sentPackDiv).innerHTML=vApp.wb.sentPackets)},
1E3);this._init()},_init:function(){vApp.vutil.chkValueInLocalStorage("orginalTeacherId")?vApp.wb.pageEnteredTime=localStorage.getItem("pageEnteredTime"):(vApp.wb.pageEnteredTime=(new Date).getTime(),localStorage.setItem("pageEnteredTime",vApp.wb.pageEnteredTime));vApp.wb.oTeacher=vApp.vutil.chkValueInLocalStorage("orginalTeacherId");vApp.vutil.chkValueInLocalStorage("rcvdPackId")?vApp.wb.gObj.rcvdPackId=parseInt(localStorage.rcvdPackId):vApp.wb.gObj.rcvdPackId=0;"t"==vApp.gObj.uRole&&d.addEventListener("resize",
function(){"Whiteboard"==vApp.currApp&&vApp.wb.utility.lockVapp()});d.addEventListener("click",function(){vApp.wb.view.disappearBox("WebRtc");vApp.wb.view.disappearBox("Canvas");vApp.wb.view.disappearBox("drawArea")});vApp.vutil.chkValueInLocalStorage("reclaim");this.stHasTeacher=vApp.vutil.chkValueInLocalStorage("teacherId");if(vApp.vutil.chkValueInLocalStorage("reclaim")){var a=vApp.wb.createCommandWrapper();vApp.wb.utility.createReclaimButton(a);vApp.gObj.uRole="s"}this.stHasTeacher&&(vApp.gObj.uRole=
"t");vApp.wb.utility.crateCanvasDrawMesssage()},arrowInit:function(){this.arrImg=new Image;this.arrImg.src="undefined"!=typeof d.whiteboardPath?d.whiteboardPath+"/images/arrow.png":"/images/arrow.png";this.arrImgDraw=!1;var a=this;this.arrImg.onload=function(){a.arrImgDraw=!0}},createCommand:function(){if(vApp.wb.utility.alreadyExistToolBar())return!0;var a=this.createCommandWrapper();vApp.wb.createDiv("t_rectangle","rectangle",a,"tool");vApp.wb.createDiv("t_line","line",a,"tool");vApp.wb.createDiv("t_freeDrawing",
"freeDrawing",a,"tool");vApp.wb.createDiv("t_oval","oval",a,"tool");vApp.wb.createDiv("t_triangle","triangle",a,"tool");vApp.wb.createDiv("t_text","text",a,"tool");vApp.wb.createDiv("t_activeall","activeAll",a,"tool");vApp.wb.createDiv("t_clearall","clearAll",a,"tool");vApp.wb.socketOn=parseInt(wbUser.socketOn);1==vApp.wb.socketOn&&vApp.wb.utility.setClass("vcanvas","socketon")},createCommandWrapper:function(){var b=a.createElement("div");b.id=vApp.wb.commandToolsWrapperId;var c=a.getElementById(vcan.canvasWrapperId);
null!=c?a.getElementById("containerWb").insertBefore(b,c):a.getElementById("containerWb").appendChild(b);return b},createDiv:function(b,c,d,h){var m=c;c=vApp.lang.getString(c);var n=a.createElement("a");n.href="#";var p=a.createElement("div");p.id=b;"undefined"!=typeof h&&(p.className=h);h=a.createElement("span");h.className="icon-"+m;n.appendChild(h);n.dataset.title=c;n.className="tooltip";p.appendChild(n);"t_reclaim"==b?(b=a.getElementById(vApp.html.id),d.appendChild(p),b.insertBefore(d,b.firstChild)):
d.appendChild(p)},createCanvas:function(){var b=a.createElement("div");b.id=vcan.canvasWrapperId;vcan.canvasWrapperId=b.id;var c=a.createElement("canvas");c.id="canvas";c.innerHTML="Canvas is missing in your browsers. Please update the latest version of your browser";b.appendChild(c);a.getElementById("containerWb").appendChild(b)},objInit:function(a){"t"==vApp.gObj.uRole&&"t_clearall"!=this.parentNode.id&&vApp.wb.utility.makeActiveTool(this.parentNode.id);"t_replay"==this.parentNode.id?(vApp.wb.utility.clearAll(!1),
vApp.wb.utility.beforeSend({replayAll:!0})):vApp.wb.toolInit(this.parentNode.id);"t_replay"!=this.parentNode.id&&"t_clearall"!=this.parentNode.id&&"t_reclaim"!=this.parentNode.id&&"t_assign"!=this.parentNode.id&&(a=(new Date).getTime(),vApp.wb.lt=this.parentNode.id,a={cmd:this.parentNode.id,mt:a},vApp.wb.uid++,a.uid=vApp.wb.uid,vcan.main.replayObjs.push(a),vApp.storage.store(JSON.stringify(vcan.main.replayObjs)),vApp.storage.wholeStore(a),vApp.wb.utility.beforeSend({repObj:[a]}));"t_clearall"!=this.parentNode.id&&
(vApp.wb.prvTool=this.parentNode.id)},attachToolFunction:function(b,c){vApp.wb.createCommand(c);if("undefined"==typeof c){var d=vApp.vutil.chkValueInLocalStorage("orginalTeacherId");vApp.wb.dataInfo=parseInt(wbUser.dataInfo);d&&1==vApp.wb.dataInfo&&!vApp.wb.utility.alreadyExistPacketContainer()&&(vApp.wb.packContainer.createPacketContainer(),vApp.wb.packContainer.createPacketInfoContainer(),vApp.wb.utility.initStoredPacketsNumbers())}for(var d=a.getElementById(b).getElementsByTagName("div"),h=0;h<
d.length;h++)d[h].getElementsByTagName("a")[0].addEventListener("click",vApp.wb.objInit)},toolInit:function(a,b,c,d){"object"==typeof vApp.wb.obj.drawTextObj&&!0==vApp.wb.obj.drawTextObj.wmode&&vcan.main.canvas.getContext("2d");0<vApp.wb.vcan.getStates("children").length?"t_clearall"!=a&&("undefined"!=typeof c&&"t_replay"==a||vApp.wb.utility.deActiveFrmDragDrop(),!0!=c&&"t_replay"!=a&&vApp.wb.vcan.renderAll()):vApp.wb.vcan.main.action="create";vApp.wb.utility.IsObjEmpty(vApp.wb.obj.freeDrawObj&&!1==
c)||(vApp.wb.obj.freeDrawObj.freesvg=!1);vApp.wb.vcan.main.currUserCommand=a+"Init";if("t_activeall"==a)vApp.wb.utility.t_activeallInit();else if("t_replay"==a)"undefined"==typeof c&&vcan.setValInMain("id",0),"undefined"!=typeof d?vApp.wb.t_replayInit(b,d):vApp.wb.t_replayInit(b);else if("t_clearall"==a){if(!confirm(vApp.lang.getString("clearAllWarnMessage")))return;vApp.wb.utility.makeActiveTool(a);vApp.wb.utility.t_clearallInit();vApp.wb.utility.makeDefaultValue(a);vApp.storage.clearStorageData();
vApp.wb.prvTool=a;vApp.wb.utility.beforeSend({clearAll:!0})}else"t_assign"==a?(b=localStorage.getItem("toolHeight"),null!=b?vApp.wb.utility.beforeSend({assignRole:!0,toolHeight:b,socket:vApp.wb.socketOn}):vApp.wb.utility.beforeSend({assignRole:!0,socket:vApp.wb.socketOn})):"t_reclaim"==a&&vApp.wb.utility._reclaimRole();"t_activeall"!=a&&"t_replay"!=a&&"t_clearallInit"!=a&&"t_assign"!=a&&"t_reclaim"!=a&&(vApp.wb.tool=new vApp.wb.tool_obj(a),vApp.wb.utility.attachEventHandlers())},tool_obj:function(a){this.cmd=
a;"t_freeDrawing"!=a&&(vApp.wb.obj.freeDrawObj="");"t_text"==a||vApp.vutil.exitTextWrapper()||(vApp.wb.obj.drawTextObj="");"t_freeDrawing"==a?(vApp.wb.obj.freeDrawObj=new vApp.wb.readyFreeHandObj("#424240","3"),vApp.wb.obj.freeDrawObj.init()):"t_text"==a&&(vApp.wb.obj.drawTextObj=new vApp.wb.readyTextObj,vApp.wb.obj.drawTextObj.init("canvasWrapper"));a=a.slice(2,a.length);vApp.wb.draw_object(a,vApp.wb.canvas,this)},t_replayInit:function(a,b){"fromFile"==a?(vApp.gObj.chat.removeAllChat(),vApp.wb.recordAudio=
!0,vApp.recorder.init()):(vApp.wb.replay=vApp.wb._replay(),"undefined"!=typeof b?(vApp.wb.replay.init(a,b),vApp.wb.replay.renderObj(b)):(vApp.wb.replay.init(a),vApp.wb.replay.renderObj()))}}}})(window,document);(function(d){d.utility=function(){return{userIds:[],isObjExistRE:function(a){if(0<=vApp.wb.replay.removeElements.length){var b=vApp.wb.vcan.ArrayIndexOf(vApp.wb.replay.removeElements,function(b){return b.id==a.id});if(0<=b)return b}},IsObjEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},stringToNumber:function(a){" "==a[a.length-1]&&(a=a.substring(0,a.length-1));return a=Number(a)},clickOutSidebox:function(a){return 1!=a%2?!0:!1},keyOperation:function(a){if(8==a.keyCode||
46==a.keyCode)a=vApp.wb.vcan,""!=a.main.currObj&&(a=vApp.wb.utility.removeSelectedItem(a.main.currObj),vApp.wb.utility.beforeSend({repObj:[a]}))},removeSelectedItem:function(a,b){vApp.wb.canvas.removeObject(vcan.main.currObj);a={mt:(new Date).getTime(),ac:"del"};"undefined"==typeof b&&vApp.wb.uid++;a.uid=vApp.wb.uid;"s"==vApp.gObj.uRole?vApp.storage.store(JSON.stringify(vApp.wb.gObj.replayObjs)):(vcan.main.replayObjs.push(a),vApp.storage.store(JSON.stringify(vcan.main.replayObjs)));vcan.main.currObj=
"";return a},attachEventHandlers:function(){vApp.wb.canvas.bind("mousedown",vApp.wb.utility.ev_canvas);vApp.wb.canvas.bind("mousemove",vApp.wb.utility.ev_canvas);vApp.wb.canvas.bind("mouseup",vApp.wb.utility.ev_canvas)},t_clearallInit:function(){vApp.wb.utility.clearAll(!0)},clearAll:function(a,b){vApp.wb.uid=0;vApp.wb.lt="";for(var c=vApp.wb.vcan;0<c.main.children.length;)vApp.wb.canvas.removeObject(c.main.children[0]);!0==a&&c.main.replayObjs.splice(0,c.main.replayObjs.length);void 0!=vApp.wb.replay&&
(vApp.wb.replay.objNo=0);"move"==c.getStates("action")&&c.setValInMain("action","create");c=document.getElementById("sendPackCont");if(null!=c){var f=c.getElementsByClassName("numbers");if(0<f.length)for(c=0;c<f.length;c++)f[c].innerHTML=0}"undefined"==typeof b&&(vApp.wb.sentPackets=0,vApp.wb.receivedPackets=0);c=document.getElementById("sentMsgInfo");null!=c&&(c.innerHTML="");c=document.getElementById("rcvdMsgInfo");null!=c&&(c.innerHTML="");f=document.getElementsByClassName("textBoxContainer");
for(c=0;c<f.length;c++)f[c].parentNode.removeChild(f[c]);c=document.getElementById("serverErrorCont");null!=c&&c.parentNode.removeChild()},deActiveFrmDragDrop:function(){var a=vApp.wb.vcan,b=a.main.children;if("move"==a.getStates("action")){a.setValInMain("action","create");for(a=0;a<b.length;a++)b[a].dragDrop(!1),b[a].setActive(!1);return!0}return!1},getOffset:function(a){for(var b=a.target,c=y=0;b&&!isNaN(b.offsetLeft)&&!isNaN(b.offsetTop);)c+=b.offsetLeft-b.scrollLeft,y+=b.offsetTop-b.scrollTop,
b=b.offsetParent;c=a.clientX-c;y=a.clientY-y;return{x:c,y:y}},ev_canvas:function(a){var b=vApp.wb.vcan.utility.getReltivePoint(a);a.currX=b.x;a.currY=b.y;if(b=vApp.wb.tool[a.type])return b(a),this.ev_canvas},t_activeallInit:function(){var a=vApp.wb.vcan,b=a.getStates("children");if(1<=b.length)for(a.setValInMain("action","move"),a=0;a<b.length;a++)b[a].dragDrop(!0)},drawArrowImg:function(a,b){var c=vApp.wb.vcan.main.canvas.getContext("2d");c.clearRect(0,0,vApp.wb.vcan.main.canvas.width,vApp.wb.vcan.main.canvas.height);
vcan.renderAll();c.save();c.beginPath();c.translate(b.mp.x,b.mp.y);c.drawImage(a,-3,-3,18,24);c.closePath();c.restore()},calcPsSentPackets:function(a){if(vApp.vutil.chkValueInLocalStorage("orginalTeacherId"))return a=vApp.wb.sentPackets-a,0>a&&(a=0),document.getElementById(null!=vApp.wb.sentPackDivPS)&&(document.getElementById(vApp.wb.sentPackDivPS).innerHTML=a),vApp.wb.sentPackets},calcPsRecvdPackets:function(a){a=vApp.wb.receivedPackets-a;0>a&&(a=0);null!=document.getElementById(vApp.wb.receivedPackDivPS)&&
(document.getElementById(vApp.wb.receivedPackDivPS).innerHTML=a);return vApp.wb.receivedPackets},initStoredPacketsNumbers:function(){if(vApp.vutil.chkValueInLocalStorage("orginalTeacherId")){if(localStorage.sentPackets){var a=JSON.parse(localStorage.sentPackets);vApp.wb.sentPackets=a;null!=document.getElementById(vApp.wb.sentPackDiv)&&(document.getElementById(vApp.wb.sentPackDiv).innerHTML=a)}localStorage.receivedPackets&&(vApp.wb.receivedPackets=JSON.parse(localStorage.receivedPackets),null!=document.getElementById(vApp.wb.receivedPackDiv)&&
(document.getElementById(vApp.wb.receivedPackDiv).innerHTML=vApp.wb.receivedPackets))}},updateSentPackets:function(a){1==vApp.wb.dataInfo&&vApp.vutil.chkValueInLocalStorage("orginalTeacherId")&&(vApp.wb.sentPackets+=JSON.stringify(a).length,null!=document.getElementById(vApp.wb.sentPackDiv)&&(document.getElementById(vApp.wb.sentPackDiv).innerHTML=vApp.wb.sentPackets))},assignRole:function(a){vApp.wb.tool="";"move"==vcan.main.action&&vApp.wb.utility.deActiveFrmDragDrop();if("undefined"!=typeof a){if(null!=
localStorage.getItem("reclaim")){var b=document.getElementById(vApp.wb.commandToolsWrapperId);b.parentNode.removeChild(b);localStorage.removeItem("reclaim")}localStorage.removeItem("studentId");localStorage.setItem("teacherId",a);vApp.gObj.uRole="t";vApp.user.assignRole(vApp.gObj.uRole,vApp.currApp);vcan.utility.canvasCalcOffset(vcan.main.canid)}else{vApp.gObj.uRole="s";b=document.getElementById(vApp.wb.commandToolsWrapperId);if(null!=b)for(;b.hasChildNodes();)b.removeChild(b.lastChild);vApp.wb.utility.makeCanvasDisable();
"undefined"!=typeof localStorage.orginalTeacherId?(vApp.wb.utility.createReclaimButton(b),localStorage.setItem("reclaim",!0)):null!=b&&b.parentNode.removeChild(b);a=localStorage.getItem("teacherId");localStorage.removeItem("teacherId");localStorage.setItem("studentId",a);vApp.wb.utility.uniqueArrOfObjsToStudent()}null==localStorage.getItem("orginalTeacherId")&&vApp.vutil.toggleRoleClass(!0)},reclaimRole:function(){vApp.gObj.controlAssign=!1;vApp.wb.response.assignRole(vApp.gObj.uid,vApp.gObj.uid,
!0)},dispQueuePacket:function(a){(null!=localStorage.getItem("teacherId")||null!=localStorage.getItem("orginalTeacherId")&&vApp.vutil.chkValueInLocalStorage("reclaim"))&&vApp.wb.utility.toolWrapperEnable();vApp.wb.drawMode=!1;null!=localStorage.getItem("teacherId")&&(vApp.wb.utility.makeCanvasEnable(),vApp.wb.utility.enableAppsBar());0<vApp.wb.gObj.packQueue.length&&(d.vApp.wb.vcan.main.replayObjs=vApp.wb.gObj.packQueue,vApp.wb.gObj.packQueue=[],vApp.wb.toolInit("t_replay","fromBrowser",!0,vApp.wb.utility.dispQueuePacket))},
updateRcvdInformation:function(a){var b=document.getElementById("rcvdMsgInfo");if(null!=b){var c="",f;for(f in a)c+=f+" : "+a[f]+" <br />";b.innerHTML=c}},makeCanvasDisable:function(){var a=vcan.main.canvas;a.style.position="relative";a.style.pointerEvents="none"},makeCanvasEnable:function(){null==localStorage.getItem("teacherId")||vApp.wb.hasOwnProperty("canvasDisable")&&vApp.wb.canvasDisable||(vcan.main.canvas.style.pointerEvents="visible")},removeToolBox:function(){var a=document.getElementById(vcan.cmdWrapperDiv);
a.parentNode.removeChild(a)},createReclaimButton:function(a){vApp.wb.createDiv("t_reclaim","reclaim",a);document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",vApp.wb.objInit)},chkValueInLocalStorage:function(a){return null===localStorage.getItem(a)?!1:localStorage[a]},uniqueArrOfObjsToStudent:function(){var a="";vApp.wb.gObj.replayObjs=[];for(var b=0;b<vcan.main.replayObjs.length;b++)a=vcan.extend({},vcan.main.replayObjs[b]),vApp.wb.gObj.replayObjs.push(a)},uniqueArrOfObjsToTeacher:function(){vcan.main.replayObjs=
[];for(var a="",b=0;b<vApp.wb.gObj.replayObjs.length;b++)a=vcan.extend({},vApp.wb.gObj.replayObjs[b]),vcan.main.replayObjs.push(a)},makeDefaultValue:function(a){"undefined"!=typeof a&&"t_clearall"==a||vApp.wb.utility.makeDeActiveTool();vApp.wb.gObj.myrepObj=[];vApp.wb.gObj.replayObjs=[];vApp.wb.gObj.rcvdPackId=0;vApp.wb.gObj.displayedObjId=0;vApp.wb.gObj.packQueue=[];vApp.wb.uid=0;vApp.vutil.chkValueInLocalStorage("teacherId");vApp.vutil.chkValueInLocalStorage("orginalTeacherId");vApp.vutil.chkValueInLocalStorage("wbrtcMsg");
vApp.vutil.chkValueInLocalStorage("canvasDrwMsg");vApp.vutil.chkValueInLocalStorage("toolHeight");JSON.parse(vApp.vutil.chkValueInLocalStorage("prvUser"));JSON.parse(vApp.vutil.chkValueInLocalStorage("tc"));vApp.recorder.items=[];vApp.gObj.video.audio.bufferSize=0;vApp.gObj.video.audio.encMode="alaw";vApp.gObj.video.audio.rec="";vApp.gObj.video.audio.audioNodes=[];"undefined"!=typeof vcan.objTxt&&vcan.objTxt.removeTextNode();"undefined"!=typeof vcan.main.currentTransform&&(vcan.main.currentTransform=
"");vApp.gObj.video.audio.updateInfo()},clearCurrentTool:function(){vApp.wb.hasOwnProperty("tool")&&(vApp.wb.tool="")},setOrginalTeacherContent:function(){localStorage.setItem("teacherId",vApp.gObj.uid);d.vApp.wb.view.canvasDrawMsg("Canvas");localStorage.setItem("canvasDrwMsg",!0);vApp.wb.utility.alreadyExistPacketContainer()||1!=parseInt(wbUser.dataInfo,10)||(vApp.wb.packContainer.createPacketContainer(),vApp.wb.packContainer.createPacketInfoContainer(),vApp.wb.utility.initStoredPacketsNumbers());
localStorage.setItem("orginalTeacherId",vApp.gObj.uid)},initDefaultInfo:function(a){"t"==a?null==localStorage.getItem("orginalTeacherId")&&(vApp.wb.utility.setOrginalTeacherContent(),d.vApp.wb.attachToolFunction(vcan.cmdWrapperDiv,!0)):"s"==a&&(vcan.studentId=wbUser.id,null==localStorage.getItem("studentId")&&null==localStorage.getItem("teacherId")&&localStorage.setItem("studentId",wbUser.id),vApp.vutil.removeSessionTool());vApp.gObj.video.init();vApp.gObj.video.isInitiator=!0;vcan.oneExecuted=!1},
checkWebRtcConnected:function(){return"undefined"==typeof cthis||!cthis.pc[0].hasOwnProperty("iceConnectionState")&&"undefined"==typeof cthis.pc[0].iceConnectionState?!1:!0},createVirtualWindow:function(a){vApp.wb.gObj.virtualWindow=!0;var b=document.createElement("div");vApp.wb.utility.removeVirtualWindow("virtualWindow");b.setAttribute("id","virtualWindow");b.style.width=a.width+"px";if("undefined"!=typeof assignRoleAtStudent)var c=0;else c=parseInt(localStorage.getItem("toolHeight")),c=null!=c?
c:0;null!=localStorage.getItem("orginalTeacherId")?b.style.height=a.height+c+"px":null!=localStorage.getItem("teacherId")?b.style.height=a.height+"px":b.style.height=a.height-c+"px";a=document.getElementById("containerWb");a.insertBefore(b,a.firstChild)},removeVirtualWindow:function(a){a=document.getElementById(a);null!=a&&(vApp.wb.gObj.virtualWindow=!1,a.parentNode.removeChild(a))},getWideValueAppliedByCss:function(a,b){var c=document.getElementById(a);if(null!=c){var f=d.getComputedStyle(c);if("undefined"!=
typeof f.marginTop){var g=parseInt(f.marginTop.match(/\d+/));null==g&&(g=0)}return c.clientHeight+g}return!1},isNumber:function(a){return isNaN(+a)?!1:+a},setCommandToolHeights:function(a,b){var c=document.getElementById("virtualWindow");if(null!=c){var f=parseInt(c.style.height.match(/\d+/));c.style.height="decrement"==b?f-parseInt(a)+"px":f+parseInt(a)+"px"}},setClass:function(a,b){var c=document.getElementById(a),f=c.classList,g="";0<f.length&&(g=2>g.length?f[0]+" ":f.join(" ")+" ");c.setAttribute("class",
g+b)},setStyleUserConnetion:function(a,b,c){a=document.getElementsByClassName(a)[0];null!=a&&a.setAttribute("class",b+" controlCmd")},existUserLikeMe:function(a){if(a.fromUser.userid!=wbUser.id){if(a.message.checkUser.hasOwnProperty("role")){var b=a.message.checkUser.role;if(b){if(null==localStorage.getItem("otherRole")){var c=[];if(b!=vApp.gObj.uRole)c.push(b);else return existUser=!0}else c=JSON.parse(localStorage.getItem("otherRole")),-1==c.indexOf(b)&&c.push(b);"undefined"!=typeof c&&(localStorage.setItem("otherRole",
JSON.stringify(c)),console.log("Other Browser "+b+" "+a.fromUser.userid))}return vApp.gObj.uRole==b?!0:!1}}else{if("undefined"!=typeof existUser)return!0;a=JSON.parse(localStorage.getItem("otherRole"));if(null!=a){for(b=0;b<a.length;b++)if(vApp.gObj.uRole==a[b])return!0;return!1}}},existUserWithSameId:function(a){this.userIds.push(a.fromUser.userid);if(1<this.userIds.length&&vApp.wb.utility.arrayContainsSameValue(this.userIds[0],this.userIds))return!0},makeUserAvailable:function(){null==localStorage.getItem("repObjs")&&
(vApp.wb.utility.toolWrapperEnable(),null!=vcan.main.canvas&&vApp.wb.utility.makeCanvasEnable())},displayCanvas:function(){vcan.canvasWrapperId="canvasWrapper";null==document.getElementById("canvas")&&vApp.wb.createCanvas();d.vApp.wb.init();vApp.wb.utility.makeCanvasDisable();vApp.wb.utility.toolWrapperDisable()},initAll:function(a){null!=localStorage.getItem("teacherId")&&vApp.wb.utility.makeCanvasDisable();vApp.system.measureResoultion({width:d.outerWidth,height:d.innerHeight})},alreadyExistToolBar:function(){var a=
document.getElementById("t_rectangle");if(null!=a)return 8<=a.parentNode.getElementsByClassName("tool").length?!0:!1},alreadyExistPacketContainer:function(){var a=document.getElementById("packetContainer"),b=document.getElementById("informationCont");return 2<=a.getElementsByTagName("div").length||1<=b.getElementsByTagName("div").length?!0:!1},toolWrapperDisable:function(a){var b=document.getElementById("commandToolsWrapper");if(null!=b)if("undefined"!=typeof a)for(a=b.getElementsByTagName("a"),b=
0;b<a.length;b++)a[b].style.pointerEvents="none";else b=document.getElementById("commandToolsWrapper"),null!=b&&(b.style.pointerEvents="none")},toolWrapperEnable:function(a){var b=document.getElementById("commandToolsWrapper");if(null!=b)if("undefined"!=typeof a)for(a=b.getElementsByTagName("a"),b=0;b<a.length;b++)a[b].style.pointerEvents="visible";else null!=b&&(b.style.pointerEvents="visible")},replayFromLocalStroage:function(a){"undefined"!==typeof Storage&&(!1===vApp.storage.reclaim&&vApp.vutil.disableAppsBar(),
vApp.wb.vcan.main.replayObjs=a,vApp.wb.utility.clearAll(!1,"dontClear"),vApp.wb.gObj.replayObjs=vApp.wb.gObj.replayObjs.concat(a),0<a.length&&(vApp.wb.utility.makeCanvasDisable(),vApp.wb.utility.toolWrapperDisable(),vApp.wb.uid=a[a.length-1].uid,vApp.wb.gObj.rcvdPackId=vApp.wb.uid,vApp.wb.toolInit("t_replay","fromBrowser",!0,vApp.wb.utility.dispQueuePacket)))},setUserStatus:function(a,b){a||b?vApp.wb.utility.setClass("vcanvas","teacher"):(vApp.wb.utility.removeToolBox(),vApp.wb.utility.setClass("vcanvas",
"student"))},crateCanvasDrawMesssage:function(){"undefined"!=typeof localStorage.teacherId&&null==localStorage.getItem("canvasDrwMsg")&&(d.vApp.wb.view.canvasDrawMsg("Canvas"),d.vApp.wb.view.drawLabel("drawArea"),localStorage.canvasDrwMsg=!0)},removeOtherUserExist:function(a){"t"==a?null!=localStorage.getItem("studentId")&&localStorage.removeItem("studentId"):"s"==a&&null!=localStorage.getItem("orginalTeacherId")&&(localStorage.removeItem("orginalTeacherId"),null!=localStorage.getItem("teacherId")&&
localStorage.removeItem("teacherId"),null!=localStorage.getItem("reclaim")&&localStorage.removeItem("reclaim"),vApp.wb.utility.removeToolBox())},arrayContainsSameValue:function(a,b){for(var c=0;c<b.length;c++)if(b[c]!==a)return!1;return!0},actionAfterRemovedUser:function(){vApp.wb.utility.makeCanvasDisable();vApp.wb.utility.setStyleUserConnetion("con","coff");vApp.wb.utility.removeVirtualWindow("virtualWindow");vApp.wb.user.connected=!1;localStorage.removeItem("otherRole");"undefined"!=typeof cthis&&
(tempIsInitiaor=!0,cthis.isStarted&&cthis.handleRemoteHangup())},sendRequest:function(a,b){vApp.wb.utility.beforeSend({reclaimRole:!0})},updateSentInformation:function(a,b){if(vApp.vutil.chkValueInLocalStorage("orginalTeacherId")){var c=JSON.parse(a),c="undefined"!=typeof b?c:c.repObj[0],f="",g;for(g in c)f+=g+" : "+c[g]+" <br />";null!=document.getElementById("sentMsgInfo")&&(document.getElementById("sentMsgInfo").innerHTML=f)}},audioSend:function(a,b){if(vApp.gObj.audMouseDown&&1==io.sock.readyState){var c;
c=vApp.gObj.uid.toString();for(var f=c.length;8>f;f++)c="0"+c;c=c.match(/[\S]{1,2}/g)||[];c=new Int8Array([101,c[0],c[1],c[2],c[3]]);f=new Int8Array(a.length+c.length);f.set(c);f.set(a,c.length);io.sendBinary(f);vApp.gObj.video.audio.setAudioStatus(b)}else vApp.gObj.video.audio.setAudioStatus("stop")},beforeSend:function(a){if(a.hasOwnProperty("createArrow")){var b=JSON.stringify(a);vApp.wb.vcan.optimize.sendPacketWithOptimization(b,io.sock.readyState,100)}else a.hasOwnProperty("repObj")&&(vApp.wb.gObj.rcvdPackId=
a.repObj[a.repObj.length-1].uid,vApp.wb.gObj.displayedObjId=vApp.wb.gObj.rcvdPackId),b=JSON.stringify(a),vApp.wb.sentPackets+=b.length,1==io.sock.readyState&&io.send(a),JSON.parse(b).hasOwnProperty("repObj")&&vApp.wb.utility.updateSentInformation(b);localStorage.sentPackets=vApp.wb.sentPackets},checkCanvasHasParents:function(){for(var a=document.getElementById("vcanvas");"BODY"!=a.parentNode.tagName;)"vcanvas"!=a.id&&(a.style.margin="0",a.style.padding="0"),a=a.parentNode;"vcanvas"!=a.id&&(a.style.margin=
"0",a.style.padding="0")},lockVapp:function(){if(d.earlierWidth!=d.innerWidth&&(vApp.wb.canvasDisable=!0,vApp.wb.utility.makeCanvasDisable(),vApp.wb.utility.toolWrapperDisable(),vApp.vutil.disableAppsBar(),null==document.getElementById("divForReloadMsg"))){var a=null!=localStorage.getItem("teacherId")?"msgForReload":"msgStudentForReload";d.vApp.wb.view.displayMsgBox("divForReloadMsg",a);d.earlierWidth=d.innerWidth}},getElementRightOffSet:function(a){var b=20;null!=a.parentNode&&(a=a.parentNode,b=
vcan.utility.getElementOffset(a),b=d.innerWidth-(a.clientWidth+(b.x-0)));return b},initUpdateInfo:function(a){a=vApp.wb.receivedPackets;setInterval(function(){null!=document.getElementById(vApp.wb.receivedPackDivPS)&&(a=vApp.wb.utility.calcPsRecvdPackets(a),document.getElementById(vApp.wb.receivedPackDiv).innerHTML=vApp.wb.receivedPackets)},1E3)},objPutInContainer:function(a){vcan.main.replayObjs.push(a);vApp.storage.store(JSON.stringify(vcan.main.replayObjs))},removeClassFromElement:function(a,b){if("t_reclaim"!=
a){a=document.getElementById(a).className;for(var c=a.split(" "),f=[],g=0;g<c.length;g++)c[g]!=b&&f.push(c[g]);return 1<f.length?f.join(" "):f[0]}},makeActiveTool:function(a){a=document.getElementById(a);var b;vApp.wb.hasOwnProperty("prvTool")&&"t_reclaim"!=vApp.wb.prvTool?(b=vApp.wb.utility.removeClassFromElement(vApp.wb.prvTool,"active"),document.getElementById(vApp.wb.prvTool).className=b):b=a.className;a.className=b+" active";localStorage.activeTool=a.id},makeDeActiveTool:function(){vApp.wb.tool=
"";document.getElementById("commandToolsWrapper");var a=document.getElementsByClassName("tool active");0<a.length&&a[0].classList.remove("active")},createAudioTransmitIcon:function(a){var b=document.cteateElement("div");b.id="audioTransmit"+uuserId;b.className="audioTransmit";document.getElementById(a+"ControlContainer")},_reclaimRole:function(){vApp.wb.utility.reclaimRole();vApp.wb.utility.sendRequest("reclaimRole",!0);vApp.user.control.changeAttrToAssign("enable")},enableAppsBar:function(){var a=
document.getElementById("vAppOptionsCont");null!=a&&(a.style.pointerEvents="visible")}}}})(window);(function(d){d.message={notSupportCanvas:'This browser does not support Canvas. Please update your browser with the latest versionFor more information about Canvas, click on the link given here <a href="http://en.wikipedia.org/wiki/Canvas_element/">Canvas</a>',notSupportGetUserMedia:'The browser does not support getUserMedia for webRtc. Please update your browser with the latest version For more information about getUuserMedia, click on the link given here <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">getUserMedia</a>',
notSupportPeerConnect:'The browser is unable to create Peer Connection object for WebRtc Please update your browser with the latest version. For more information about WebRtc, click on the link given here <a href="http://www.webrtc.org/">WebRtc</a>',notSupportWebSocket:'This browser does not support WebSocket. Please update your browser with the latest version. For more information about WebSocket, click on the link given here <a href="http://www.websocket.org/">WebSocket</a>.',notSupportWebRtc:'This browser does not support WebRTC. Please update your browser with the latest version. For more information about WebRtc, click on the link given here <a href="http://www.webrtc.org/">WebRtc</a>',
line:"Line",rectangle:"Rectangle",triangle:"Triangle",oval:"Oval",assign:"Assign",reclaim:"Reclaim",freeDrawing:"Free Drawing",text:"Text",replay:"Replay",activeAll:"Active All",clearAll:"Clear All",drawArea:"Draw Area",totRcvdPackets:"Total Received Packets",perSecRcvdData:"Per Second Recevied Packet",totSentPackets:"Total Sent Packets",perSecSentPacket:"Per Second Sent Packets",perSecond:"Per Second",sentPackets:"Sent <br/><span>Packets</span>",receviedPackets:"Received <br/><span>Pacekts</span>",
total:"Total",dataDetails:"Data Details",sentMessageInfo:"Sent Message <br/><span>Information</span>",receivedMessageInfo:"Received Message <br/><span>information</span>",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your microphone and camera with other users',wbrtcMsgChrome:"You can click on deny button for not sharing your microphone and camera with other users.or click on allow button to share your microphone and camera with other users.",canvasDrawMsg:"You can click on any tool to draw object with a mouse click, mouse move and mouse up in the Draw Area",
clearAllWarnMessage:"Do you want to clear the Whiteboard?",cof:"connection off",askForConnect:"You will be able to perform this action only when other user get connected",msgForReload:"You will be unable to draw the objects after resizing the window. <br />  So, please reload the page for drawing. ",msgStudentForReload:"After resizing the window, there can be a problem over the drawn objects, <br />  So, please realod the page for better results ",reload:"Reload",whiteboard:"Whiteboard",screenshare:"Screen Share",
sessionend:"Session End",audioTest:"Kindly speak some words for audio testing",chatEnable:"Chat is on",chatDisable:"Chat Disabled",assignEnable:"Transfer Controls",assignDisable:"Reclaim Role",audioEnable:"Audio Enabled",audioDisable:"Audio Disabled",audioOn:"Audio on",minCommonChat:"Hide Common Chat",maxCommonChat:"Show Common Chat",miniuserbox:"Hide User Box",maxuserbox:"Show User Box",miniUserList:"Show User List",maxUserList:"Hide User List",startnewsession:"Do you want start a new session with ending current session?",
DevicesNotFoundError:"You may not have Webcam(camera/microphone).",PermissionDeniedError:"You denied to access your Webcam.",PERMISSION_DENIED:"You denied to access your Webcam(camera/microphone).",notSupportBrowser:"Not supported screen sharing for this version of browser",disableSpeaker:"Disable Audio",enableSpeaker:"Enable Audio"}})(window);(function(d){d.getString=function(a){return d.vApp.lang.message[a]}})(window);(function(d){var a={init:function(){this.msgBoxClass="msgBox";this.window={};this.virtualWindow={};return this},displayMessage:function(a,c,f,g,d){a="undefined"==typeof d?this.createMsgBox(a,c,f):this.createMsgBox(a,c,f,d);c=document.getElementById("vcanvas");"undefined"!=typeof g?document.getElementById(g).appendChild(a):c.insertBefore(a,c.childNodes[0])},customCreateElement:function(a,c,f){a=document.createElement(a);"undefined"!=typeof c&&(a.id=c);"undefined"!=typeof f&&(a.className=f);return a},
createMsgBox:function(a,c,f,g){var d=this.customCreateElement("div",c,f);"undefined"==typeof g&&(f=this.customCreateElement("div",c+"img",f+"img"),d.appendChild(f));c=this.customCreateElement("p",c+"Para");c.innerHTML=a;d.appendChild(c);return d},disappearBox:function(a){a=document.getElementsByClassName(this.msgBoxClass+a);null!=a[0]&&a[0].parentNode.removeChild(a[0])},multiMediaMsg:function(a){if("Firefox"==vApp.system.mybrowser.name){var c=vApp.lang.getString("wbrtcMsgFireFox");this.displayMessage(c,
"fireFoxWebrtcCont",this.msgBoxClass+a)}else"Chrome"==vApp.system.mybrowser.name&&(c=vApp.lang.getString("wbrtcMsgChrome"),this.displayMessage(c,"chormeWebrtcCont",this.msgBoxClass+a))},canvasDrawMsg:function(a){document.getElementById("vcanvas").className="canvasMsgBoxParent";if("Firefox"==vApp.system.mybrowser.name){var c=vApp.lang.getString("canvasDrawMsg");this.displayMessage(c,"canvasDrawMsgContFirefox",this.msgBoxClass+a,"containerWb")}else"Chrome"==vApp.system.mybrowser.name&&(c=vApp.lang.getString("canvasDrawMsg"),
this.displayMessage(c,"canvasDrawMsgContChrome",this.msgBoxClass+a,"containerWb"))},drawLabel:function(a){var c=vApp.lang.getString("drawArea");this.displayMessage(c,"canvasDrawArea",this.msgBoxClass+a,"containerWb",!1)},displayMsgBox:function(a,c){var f=this.customCreateElement("div",a),g=this.customCreateElement("p",a+"Para");g.innerHTML=vApp.lang.getString(c);f.appendChild(g);g=this.customCreateElement("a",a+"Anchor");g.href=d.location;g.innerHTML=vApp.lang.getString("reload");g.onclick=function(){d.location.reload()};
f.appendChild(g);g=document.getElementById("vAppCont");g.insertBefore(f,g.firstChild)},displayServerError:function(a,c){var f=this.customCreateElement("div",a);f.innerHTML=c;var g=document.getElementById("vcanvas");g.parentNode.insertBefore(f,g)},removeElement:function(a){a=document.getElementById(a);null!=a&&a.parentNode.removeChild(a)}},a=a.init();count=0;a.window.resizeFinished=function(){var a=0;return function(c,f){clearTimeout(a);a=setTimeout(c,f)}}();a.window.resize=function(){var a=vApp.system.measureResoultion({width:d.innerWidth,
height:d.innerHeight});vApp.vutil.setContainerWidth(a);vcan.renderAll()};a.virtualWindow.manupulation=function(a){var c=a.message.virtualWindow;if(c.hasOwnProperty("removeVirtualWindow"))a.fromUser.userid!=wbUser.id&&vApp.wb.utility.removeVirtualWindow("virtualWindow");else if(c.hasOwnProperty("createVirtualWindow"))c.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",c.toolHeight),a.fromUser.userid!=wbUser.id&&vApp.wb.utility.createVirtualWindow(c.createVirtualWindow);else if(c.hasOwnProperty("shareBrowserWidth")){c.hasOwnProperty("toolHeight")&&
localStorage.setItem("toolHeight",c.toolHeight);if(null!=localStorage.getItem("teacherId")){var f=vApp.wb.utility.getWideValueAppliedByCss("commandToolsWrapper");localStorage.setItem("toolHeight",f)}a.fromUser.userid!=wbUser.id?(null!=localStorage.getItem("teacherId")&&vApp.wb.utility.makeCanvasEnable(),otherBrowser=c.browserRes):myBrowser=vApp.system.measureResoultion({width:d.outerWidth,height:d.innerHeight});"object"==typeof myBrowser&&"object"==typeof otherBrowser&&(myBrowser.width>otherBrowser.width?
vApp.wb.gObj.virtualWindow||(vApp.wb.utility.createVirtualWindow(otherBrowser),vApp.wb.gObj.virtualWindow=!0):myBrowser.width<otherBrowser.width&&!vApp.wb.gObj.virtualWindow&&(a=document.getElementById("vcanvas"),a=vApp.wb.utility.getElementRightOffSet(a),null!=localStorage.getItem("teacherId")?vApp.wb.utility.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a,toolHeight:f}}):vApp.wb.utility.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-a}})))}};d.view=a})(window);(function(d){var a={init:function(){this.wbRtc={};this.wbRtc.className="webrtcCont";this.mybrowser={};return this},isCanvasSupport:function(a,c,f){"MSIE"==c?9!=f&&vApp.error.push({msg:vApp.lang.getString("notSupportCanvas"),id:"errorCanvas",className:"error"}):d.CanvasRenderingContext2D||vApp.error.push({msg:vApp.lang.getString("notSupportCanvas"),id:"errorCanvas",className:"error"})},isWebRtcSupport:function(a,c,f){"Firefox"==c?a.mozGetUserMedia?(this.wbRtc.userMedia=!0,d.mozRTCPeerConnection?this.wbRtc.peerCon=
!0:vApp.error.push({msg:vApp.lang.getString("notSupportPeerConnect"),id:"errorPeerConnect",className:"error"})):vApp.error.push({msg:vApp.lang.getString("notSupportGetUserMedia"),id:"errorGetUserMedia",className:"error"}):"Chrome"==c||"Safari"==c?a.webkitGetUserMedia?(this.wbRtc.userMedia=!0,d.webkitRTCPeerConnection?this.wbRtc.peerCon=!0:vApp.error.push({msg:vApp.lang.getString("notSupportPeerConnect"),id:"errorPeerConnect",className:"error"})):vApp.error.push({msg:vApp.lang.getString("notSupportGetUserMedia"),
id:"errorGetUserMedia",className:"error"}):"MSIE"==c&&9>=f&&vApp.error.push({msg:vApp.lang.getString("notSupportWebRtc"),id:"errorWebRtc",className:"error"})},isWebSocketSupport:function(a,c,f){this.webSocket={};"undefined"==typeof d.WebSocket||"function"!=typeof d.WebSocket&&"object"!=typeof d.WebSocket||!d.WebSocket.hasOwnProperty("OPEN")?vApp.error.push({msg:vApp.lang.getString("notSupportWebSocket"),id:"errorWebSocket",className:"error"}):this.webSocket=!0},measureResoultion:function(a){var c=
document.getElementById("vAppCont"),c=vcan.utility.getElementOffset(c),f=c.x;return{width:1024>a.width?1024-f:a.width-f,height:a.height-c.y}},setAppDimension:function(){var b=this.measureResoultion({width:d.innerWidth,height:d.innerHeight});vApp.vutil.setContainerWidth(b);"Whiteboard"==vApp.currApp&&a.setCanvasDimension(b)},setCanvasDimension:function(a){if("undefined"!=typeof vcan.main.canvas){var c=vcan.main.canvas;ctx=vcan.main.canvas.getContext("2d");c.width=a.width;c.height=a.height-("t"==vApp.gObj.uRole?
65:10);console.log("canvas width "+c.width);a=vcan.utility.getElementOffset(document.getElementById("canvas"));vcan.main.offset.x=a.x}},getResoultion:function(a){var c={};1280>a?(c.width=1024,c.height=768):1280<=a&&1366>a?(c.width=1280,c.height=1024):1366<=a&&1920>a?(c.width=1366,c.height=768):1920<=a&&(c.width=1920,c.height=1080);return c},check:function(){var a=this.mybrowser.detection(),c=a[0],a=a[1];this.mybrowser.name=c;this.mybrowser.version=a;this.isCanvasSupport(navigator,c,a);this.isWebRtcSupport(navigator,
c,a);this.isWebSocketSupport(navigator,c,a)}},a=a.init();d.addEventListener("resize",function(){d.earlierWidth!=d.innerWidth&&a.setAppDimension()});d.addEventListener("resize",function(){d.earlierWidth!=d.innerWidth&&vApp.wb.view.window.resize()});a.mybrowser.detection=function(){var a=navigator.userAgent,c,f=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];if(/trident/i.test(f[1]))return c=/\brv[ :]+(\d+(\.\d+)?)/g.exec(a)||[],"IE "+(c[1]||"");f=f[2]?[f[1],f[2]]:[navigator.appName,
navigator.appVersion,"-?"];null!=(c=a.match(/version\/([\.\d]+)/i))&&(f[2]=c[1]);return f};d.system=a})(window);(function(d){d.packContainer=function(){return{createPacketContDiv:function(a,b){var c=document.createElement("div");"undefined"!=typeof a&&(c.id=a);"undefined"!=typeof b&&(c.clasName=b);return c},togglePacketCont:function(a){for(var b=this.className.split(" "),c=0;c<b.length;c++)if("display"==b[c]){this.className="hide";this.innerHTML="+";a._togglePacketCont(b[c]);break}else if("hide"==b[c]){this.className="display";this.innerHTML="-";a._togglePacketCont(b[c]);break}},_togglePacketCont:function(a){a=
"display"==a?"none":"block";document.getElementById("dataInfoHeading").style.display=a;var b=document.getElementById("packetContainer");b.style.display=a;b=document.getElementById("informationCont");b.style.display=a},createPacketContainer:function(){var a=document.getElementById("packetContainer"),b=document.createElement("h4");b.id="dataInfoHeading";b.innerHTML=vApp.lang.getString("dataDetails");var c=document.createElement("div");c.id="toggleContainer";c.className="display";var f=this;c.addEventListener("click",
function(){f.togglePacketCont.call(this,f)});c.innerHTML="-";var g=document.getElementById("mainContainer");g.insertBefore(c,g.firstChild);g.insertBefore(b,a);b=this.createPacketContDiv("dataInformation");a.appendChild(b);c=this.createPacketContDiv("blankDiv");c.innerHTML="&nbsp;<br/>&nbsp;";b.appendChild(c);c=this.createPacketContDiv("perSecData");c.innerHTML=vApp.lang.getString("perSecond");b.appendChild(c);c=this.createPacketContDiv("totalDataLabel");c.innerHTML=vApp.lang.getString("total");b.appendChild(c);
c=this.createPacketContDiv("sendPackCont");a.appendChild(c);b=this.createPacketContDiv("sentPacketsLabel");b.innerHTML=vApp.lang.getString("sentPackets");c.appendChild(b);g=this.createPacketContDiv("sendPackPsCont");c.appendChild(g);b=this.createPacketContDiv(this.sentPackDivPS,"numbers");b.innerHTML=0;g.appendChild(b);g=this.createPacketContDiv("totSendPackCont");c.appendChild(g);b=this.createPacketContDiv(this.sentPackDiv,"numbers");b.innerHTML=0;g.appendChild(b);c=this.createPacketContDiv("receivePackCont");
a.appendChild(c);a=this.createPacketContDiv("receivedPacketsLabel");a.innerHTML=vApp.lang.getString("receviedPackets");c.appendChild(a);a=this.createPacketContDiv("receivePackPsCont");c.appendChild(a);b=this.createPacketContDiv(this.receivedPackDivPS,"numbers");b.innerHTML=0;a.appendChild(b);a=this.createPacketContDiv("totReceivedPackCont");c.appendChild(a);b=this.createPacketContDiv(this.receivedPackDiv,"numbers");b.innerHTML=0;a.appendChild(b)},createPacketInfoContainer:function(){var a=document.getElementById("informationCont");
label=document.createElement("label");label.innerHTML=vApp.lang.getString("sentMessageInfo");var b=this.createPacketContDiv("sentMsgInfoContainer");b.appendChild(label);var c=this.createPacketContDiv("sentMsgInfo");b.appendChild(c);a.appendChild(b);b=this.createPacketContDiv("receivedMsgInfoContainer");label=document.createElement("label");label.innerHTML=vApp.lang.getString("receivedMessageInfo");b.appendChild(label);c=this.createPacketContDiv("rcvdMsgInfo");b.appendChild(c);a.appendChild(b)}}}})(window);(function(d){d.draw_object=function(a,b,c){var f=this;c.started=!1;var g,d,h=[];c.mousedown=function(b,g){(new Date).getTime();b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+f.vcan.main.offset.x,b.y=b.detail.cevent.x+f.vcan.main.offset.y,b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);var d=f.vcan;
lastmousemovetime=null;c.startPosX=b.currX;c.startPosY=b.currY;vApp.wb.gObj.spx=c.startPosX;vApp.wb.gObj.spy=c.startPosY;if("create"==d.getStates("action")){var k=(new Date).getTime();if("text"!=a&&"t_clearall"!=f.tool.cmd){var h=d.getStates("currentTransform");if(""==h||null==h)b.detail.hasOwnProperty("cevent")||d.optimize.calculatePackets(k,"d",c.startPosX,c.startPosY),c.started=!0}else f.obj.drawTextObj.muser=!1,b.detail.hasOwnProperty("cevent")||"t_clearall"==f.tool.cmd?f.obj.drawTextObj.muser=
!0:f.utility.clickOutSidebox(f.obj.drawTextObj.textWriteMode)&&d.optimize.calculatePackets(k,"d",c.startPosX,c.startPosY),b.detail.hasOwnProperty("cevent")?b.detail.cevent.hasOwnProperty("mtext")?f.obj.drawTextObj.textUtility(c.startPosX,c.startPosY,b.detail.cevent.mtext):f.obj.drawTextObj.textUtility(c.startPosX,c.startPosY):"object"==typeof f.obj.drawTextObj&&f.obj.drawTextObj.textUtility(c.startPosX,c.startPosY)}"freeDrawing"==a&&!0==f.obj.freeDrawObj.freesvg&&f.obj.freeDrawObj.drawStart(b)};c.mousemove=
function(b,n){b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+f.vcan.main.offset.x,b.y=b.detail.cevent.x+f.vcan.main.offset.y,b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);if(c.started&&"t_clearall"!=f.tool.cmd)if(void 0!=f.obj.freeDrawObj&&!0==f.obj.freeDrawObj.freesvg){if(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&
(f.obj.freeDrawObj.wb_draw(b),!b.detail.hasOwnProperty("cevent"))){"undefined"!=typeof n||"undefined"!=typeof lastmousemovetime&&null!=lastmousemovetime||(lastmousemovetime=(new Date).getTime(),vcan.optimize.calculatePackets(lastmousemovetime,"m",b.currX,b.currY));var p=(new Date).getTime(),p=vcan.makeStackObj(p,"m",b.currX,b.currY);h.push(p);if("undefined"==typeof n&&(presentmousemovetime=(new Date).getTime(),2E3<=presentmousemovetime-lastmousemovetime)){for(p=0;p<h.length;p++)f.uid++,h[p].uid=f.uid,
vcan.main.replayObjs.push(h[p]);f.utility.beforeSend({repObj:h});vApp.storage.store(JSON.stringify(vcan.main.replayObjs));vApp.storage.wholeStore(h);f.utility.updateSentPackets(h);h=[];lastmousemovetime=(new Date).getTime()}}}else{g=b.currX;d=b.currY;""!=f.prvObj&&f.canvas.removeObject(f.prvObj);var p=f.makeobj(c.startPosX,c.startPosY,g,d,a),q=f.canvas.readyObject(p);f.canvas.addObject(q);q.coreObj.usrCurrAction="create";p=(new Date).getTime();if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=
(new Date).getTime(),b.detail.hasOwnProperty("cevent")||"text"==a||"t_clearall"==f.tool.cmd||vcan.optimize.calculatePackets(p,"m",g,d);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&(b.detail.hasOwnProperty("cevent")||"text"==a||"t_clearall"==f.tool.cmd||vcan.optimize.calculatePackets(p,"m",g,d),lastmousemovetime=(new Date).getTime());f.prvObj=q.coreObj}else"move"==f.vcan.main.action&&(""!=vcan.main.currentTransform&&null!=vcan.main.currentTransform||"move"!=
f.vcan.main.action)||f.utility.beforeSend({createArrow:!0,x:b.currX,y:b.currY})};c.mouseup=function(b,n){b.detail.hasOwnProperty("cevent")&&(b.clientX=b.detail.cevent.x+f.vcan.main.offset.x,b.clientY=b.detail.cevent.y+f.vcan.main.offset.y,b.x=b.detail.cevent.x+f.vcan.main.offset.x,b.y=b.detail.cevent.x+f.vcan.main.offset.y,b.pageX=b.detail.cevent.x+f.vcan.main.offset.x,b.pageY=b.detail.cevent.y+f.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);g=b.currX;d=b.currY;lastmousemovetime=
null;if(c.started&&"text"!=a){c.mousemove(b,"up");if(!b.detail.hasOwnProperty("cevent")&&"freeDrawing"!=a){var p=(new Date).getTime();vcan.optimize.calculatePackets(p,"u",g,d)}if(void 0!=f.obj.freeDrawObj&&!0==f.obj.freeDrawObj.freesvg&&(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&f.obj.freeDrawObj.finalizeDraw(b),!b.detail.hasOwnProperty("cevent")&&0<h.length)){p=(new Date).getTime();p=vcan.makeStackObj(p,"u",g,d);h.push(p);for(p=0;p<h.length;p++)f.uid++,h[p].uid=f.uid,vcan.main.replayObjs.push(h[p]);
f.utility.beforeSend({repObj:h});vApp.storage.store(JSON.stringify(vcan.main.replayObjs));vApp.storage.wholeStore(h);f.utility.updateSentPackets(h);h=[]}""!=f.prvObj&&(f.prvObj="");f.prvObj="";c.started=!1}f.vcan.wb.sentPack&&(f.vcan.wb.sentPack=!1)}}})(window);(function(d){d.makeobj=function(a,b,c,f,g){var d={mp:{}};d.mp.x=c;d.mp.y=f;if(a>c){var h=c,m=f;c=a;f=b;a=h;b=m;d.dRoad="b2t"}else d.dRoad="t2b";d.type=g;if("rectangle"==g||"triangle"==g)d.sx=a,d.sy=b,d.ex=c,d.ey=f;if("line"==g)d.lineColor="#424240",d.lineWidth=3,d.start={x:a,y:b},d.end={x:c,y:f};else if("rectangle"==g)d.width=c-a,d.height=f-b,d.borderColor="#424240",d.lineWidth=3;else if("oval"==g)d.lineWidth=3,d.borderColor="#424240",d.width=c-a,d.height=f-b,d.x=c-d.width/2,d.y=f-d.height/2,d.rx=
d.width/2,d.ry=d.height/2;else if("triangle"==g)d.lineWidth=3,d.borderColor="#424240";else if("text"==g)return;return d}})(window);(function(d){var a=d.vcan;a.utility={canvasCalcOffset:function(b){var c=a.main;b=document.getElementById(b);b=a.utility.getElementOffset(b);return c.offset=b},getElementOffset:function(a){var c=0,f=0;do c+=a.offsetTop||0,f+=a.offsetLeft||0,a=a.offsetParent;while(a);return{x:f,y:c}},setVal:function(b,c,f){("scaleX"===c||"scaleY"===c)&&f<b.MIN_SCALE_LIMIT&&(f=b.MIN_SCALE_LIMIT);if("object"==typeof c)for(var g in c)a.utility.setVal(b,g,c[g]);else"angle"===c?a.utility.setAngle(b,f):b[c]=f;return b},getVal:function(a,
c){return a[c]},setAngle:function(a,c){a.theta=c/180*Math.PI;a.angle=c;return a},actualPointer:function(b){return{x:a.utility.pointerX(b),y:a.utility.pointerY(b)}},pointerX:function(a){var c=document.documentElement,f=document.body||{scrollLeft:0};return a.pageX||("unknown"!=typeof a.clientX?a.clientX:0)+(c.scrollLeft||f.scrollLeft)-(c.clientLeft||0)},pointerY:function(a){var c=document.documentElement,f=document.body||{scrollTop:0};return a.pageY||("unknown"!=typeof a.clientY?a.clientY:0)+(c.scrollTop||
f.scrollTop)-(c.clientTop||0)},getReltivePoint:function(b){var c=a.main.offset;b=a.utility.actualPointer(b);return{x:b.x-c.x,y:b.y-c.y}},degreesToRadians:function(a){return Math.PI/180*a},setActiveObject:function(b){a.main.activeObject&&a.main.activeObject.setActive(!1);a.main.activeObject=b;b.setActive(!0);return b},updateObj:function(a){var c={};for(prop in a)"oCoords"!=prop?c[prop]=a[prop]:(c.start={},c.end={},c.start.x=a[prop].tl.x,c.start.y=a[prop].tl.y,c.end.x=a[prop].br.x,c.end.y=a[prop].br.y);
return c},setCursorFromEvent:function(a,c,f){var g=a.upperCanvasEl.style;if(f)if(c=f.findTargetCorner(c))if(c in a.cursorMap)g.cursor=a.cursorMap[c];else if("mtr"===c&&f.hasRotatingPoint)g.cursor=a.rotationCursor;else return g.cursor=this.defaulCursor,!1;else g.cursor=a.hoverCursor;else return g.cursor=this.defaultCursor,!1;return!0},getChildren:function(){return a.main.children}}})(window);(function(d){var a=d.vcan;a.main.prototype={addObject:function(b){if("object"==typeof b.coreObj){"freehand"!=b.coreObj.type&&a.main.children.push(b.coreObj);var c=a.main.canvas.getContext("2d");a.render(c,b.coreObj)}},removeObject:function(b){a.remove(b)},bind:function(b,c){a.events().bind(a.main.canvas,b,c)},readyObject:function(b,c){b=a.extend({},b);c||void 0!=b.id||(a.main.id++,b.id=a.main.id);b.cornersize=12;b.rotatingPointOffset=40;b.selectable=!0;b.downObj=!1;b.active=!1;b.cornersize=12;b.padding=
0;b.hasControls=!0;b.cornerColor="rgba(102,153,255,0.5)";void 0==b.borderColor&&(b.borderColor="#000");b.flipX=!1;b.flipY=!1;b.draggable=!1;b.hasBorders=!0;b.hasRotatingPoint=!1;b.hideCorners=!1;b.lockRotation=!1;b.MIN_SCALE_LIMIT=.1;b.borderOpacityWhenMoving=.4;b.hasOwnProperty("theta")||(b.theta=0);b.hasOwnProperty("scaleX")||(b.scaleX=1);b.hasOwnProperty("scaleY")||(b.scaleY=1);"line"==b.type?(a.objLine=new a.line,a.objLine.init(b)):"rectangle"==b.type?(a.objRect=new a.rectangle,a.objRect.init(b)):
"oval"==b.type?(a.objOval=new a.oval,a.objOval.init(b)):"triangle"==b.type?(a.objTri=new a.triangle,a.objTri.init(b)):"text"==b.type&&(a.objTxt=new a.text,a.objTxt.init(b));b.getWidth=function(){return this.width*this.scaleX};b.getHeight=function(){return this.height*this.scaleY};b.setCoords=function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this.hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this.angle=Math.atan(this.currentHeight/
this.currentWidth);this.theta=this.theta;var c=Math.cos(this.angle+this.theta)*this.hypotenuse,g=Math.sin(this.angle+this.theta)*this.hypotenuse,d=this.theta,h=Math.sin(d),d=Math.cos(d),c={x:this.x-c,y:this.y-g},g={x:c.x+this.currentWidth*d,y:c.y+this.currentWidth*h},m={x:c.x-this.currentHeight*h,y:c.y+this.currentHeight*d};this.oCoords={tl:c,tr:g,br:{x:g.x-this.currentHeight*h,y:g.y+this.currentHeight*d},bl:m,ml:{x:c.x-this.currentHeight/2*h,y:c.y+this.currentHeight/2*d},mt:{x:c.x+this.currentWidth/
2*d,y:c.y+this.currentWidth/2*h},mr:{x:g.x-this.currentHeight/2*h,y:g.y+this.currentHeight/2*d},mb:{x:m.x+this.currentWidth/2*d,y:m.y+this.currentWidth/2*h},mtr:{x:c.x+this.currentWidth/2*d,y:c.y+this.currentWidth/2*h}};this.setCornerCoords();b.findTargetCorner=function(c){var f=a.main.offset;if(!this.hasControls)return!1;var g=a.utility.actualPointer(c);c=g.x-f.x;var f=g.y-f.y,d;for(d in this.oCoords){if("mtr"===d&&!this.hasRotatingPoint)break;g=a.virtual_box.getImageLines(this.oCoords[d].corner,
d);g=a.virtual_box.findCrossPoints(c,f,g);if(1==g%2&&0!=g)return b.corner=d}return!1};return this};b.drawBorders=function(a){if(this.hasBorders){var b=this.padding,c=2*b;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var d=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),m=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(d,m);d=this.getWidth();m=this.getHeight();
a.strokeRect(~~(-(d/2)-b)+.5,~~(-(m/2)-b)+.5,~~(d+c),~~(m+c));!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(b=(this.flipY?m:-m)/2,a.beginPath(),a.moveTo(0,b),a.lineTo(0,b+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this}};b.drawCorners=function(a){if(this.hasControls){var b=this.cornersize,c=b/2,d=this.padding,m=-(this.width/2),n=-(this.height/2),p=b/this.scaleX,q=b/this.scaleY,r=(d+c)/this.scaleY,u=(d+c)/this.scaleX,
s=(d+c-b)/this.scaleX,c=(d+c-b)/this.scaleY,d=this.height;a.save();a.fillStyle=this.cornerColor;a.fillRect(m-u,n-r,p,q);b=m+this.width-u;a.fillRect(b,n-r,p,q);a.fillRect(m-u,n+d+c,p,q);b=m+this.width+s;a.fillRect(b,n+d+c,p,q);b=m+this.width/2-u;a.fillRect(b,n-r,p,q);b=m+this.width/2-u;a.fillRect(b,n+d+c,p,q);b=m+this.width+s;a.fillRect(b,n+d/2-r,p,q);a.fillRect(m-u,n+d/2-r,p,q);this.hasRotatingPoint&&(b=m+this.width/2-u,m=this.flipY?n+d+this.rotatingPointOffset/this.scaleY-q/2:n-this.rotatingPointOffset/
this.scaleY-q/2,a.fillRect(b,m,p,q));a.restore();return this}};b.setActive=function(a){this.active=!!a;return this};b.dragDrop=function(a){this.draggable=void 0!=a?a:!1};b.setCornerCoords=function(){var b=this.oCoords,c=a.utility.degreesToRadians(45-this.getAngle()),d=Math.sqrt(2*Math.pow(this.cornersize,2))/2,h=d*Math.cos(c),c=d*Math.sin(c),d=Math.sin(this.theta),m=Math.cos(this.theta);b.tl.corner={tl:{x:b.tl.x-c,y:b.tl.y-h},tr:{x:b.tl.x+h,y:b.tl.y-c},bl:{x:b.tl.x-h,y:b.tl.y+c},br:{x:b.tl.x+c,y:b.tl.y+
h}};b.tr.corner={tl:{x:b.tr.x-c,y:b.tr.y-h},tr:{x:b.tr.x+h,y:b.tr.y-c},br:{x:b.tr.x+c,y:b.tr.y+h},bl:{x:b.tr.x-h,y:b.tr.y+c}};b.bl.corner={tl:{x:b.bl.x-c,y:b.bl.y-h},bl:{x:b.bl.x-h,y:b.bl.y+c},br:{x:b.bl.x+c,y:b.bl.y+h},tr:{x:b.bl.x+h,y:b.bl.y-c}};b.br.corner={tr:{x:b.br.x+h,y:b.br.y-c},bl:{x:b.br.x-h,y:b.br.y+c},br:{x:b.br.x+c,y:b.br.y+h},tl:{x:b.br.x-c,y:b.br.y-h}};b.ml.corner={tl:{x:b.ml.x-c,y:b.ml.y-h},tr:{x:b.ml.x+h,y:b.ml.y-c},bl:{x:b.ml.x-h,y:b.ml.y+c},br:{x:b.ml.x+c,y:b.ml.y+h}};b.mt.corner=
{tl:{x:b.mt.x-c,y:b.mt.y-h},tr:{x:b.mt.x+h,y:b.mt.y-c},bl:{x:b.mt.x-h,y:b.mt.y+c},br:{x:b.mt.x+c,y:b.mt.y+h}};b.mr.corner={tl:{x:b.mr.x-c,y:b.mr.y-h},tr:{x:b.mr.x+h,y:b.mr.y-c},bl:{x:b.mr.x-h,y:b.mr.y+c},br:{x:b.mr.x+c,y:b.mr.y+h}};b.mb.corner={tl:{x:b.mb.x-c,y:b.mb.y-h},tr:{x:b.mb.x+h,y:b.mb.y-c},bl:{x:b.mb.x-h,y:b.mb.y+c},br:{x:b.mb.x+c,y:b.mb.y+h}};b.mtr.corner={tl:{x:b.mtr.x-c+d*this.rotatingPointOffset,y:b.mtr.y-h-m*this.rotatingPointOffset},tr:{x:b.mtr.x+h+d*this.rotatingPointOffset,y:b.mtr.y-
c-m*this.rotatingPointOffset},bl:{x:b.mtr.x-h+d*this.rotatingPointOffset,y:b.mtr.y+c-m*this.rotatingPointOffset},br:{x:b.mtr.x+c+d*this.rotatingPointOffset,y:b.mtr.y+h-m*this.rotatingPointOffset}}};b.getAngle=function(){return 180*this.theta/Math.PI};b.setZindex=function(){for(var b=0;b<a.main.children.length;b++)if(this.id==a.main.children[b].id){var c=a.main.children[b];a.main.children.splice(b,1);break}return" "!=c?(a.main.children.push(c),!0):!1};b.setupCurrentTransform=function(b){var c=a.main,
d="drag",h=a.utility.actualPointer(b);if(b=this.findTargetCorner(b))d="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":this.hasRotatingPoint?"scale":"rotate";c.currentTransform={target:this,action:d,scaleX:this.scaleX,scaleY:this.scaleY,offsetX:h.x-this.x,offsetY:h.y-this.y,ex:h.x,ey:h.y,x:this.x,y:this.y,theta:this.theta,width:this.width*this.scaleX};c.currentTransform.original={x:this.x,y:this.y}};"text"!=b.type&&b.setCoords();return a.makeDispObject(b)}}})(window);(function(d){var a=d.vcan;a.events=function(){return{bind:function(a,c,f){a["on"+c]=f},findTarget:function(b){for(var c,f=a.main.children,g=f.length;g--;)if(f[g]&&a.virtual_box.containsPoint(b,f[g])){c=f[g];break}if(c&&c.selectable)return c}}}})(window);(function(d){var a=d.vcan;a.virtual_box={findCrossPoints:function(a,c,f){var g,d,h,m=0,n;for(n in f)if(h=f[n],!(h.o.y<c&&h.d.y<c||h.o.y>=c&&h.d.y>=c)&&(h.o.x==h.d.x&&h.o.x>=a?g=h.o.x:(g=(h.d.y-h.o.y)/(h.d.x-h.o.x),d=c-0*a,h=h.o.y-g*h.o.x,g=-(d-h)/(0-g)),g>=a&&(m+=1),2==m))break;return m},getImageLines:function(a,c){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},containsPoint:function(b,c){var f=a.utility.getReltivePoint(b),g=f.x,f=f.y,
d=a.virtual_box.getImageLines(c.oCoords);return(g=a.virtual_box.findCrossPoints(g,f,d))&&1===g%2||c.findTargetCorner(b)?!0:!1}}})(window);(function(d){var a=d.vcan;a.interact={rotateObject:function(b,c){var f=a.main.currentTransform,g=a.main.offset;if(!f.target.lockRotation){var d=Math.atan2(f.ey-f.y-g.y,f.ex-f.x-g.x),g=Math.atan2(c-f.y-g.y,b-f.x-g.x);a.utility.setVal(f.target,"theta",g-d+f.theta)}},scaleObject:function(b,c,f){var g=a.main.currentTransform,d=a.main.offset;target=g.target;if(!target.lockScalingX||!target.lockScalingY){var h=Math.sqrt(Math.pow(g.ey-g.y-d.y,2)+Math.pow(g.ex-g.x-d.x,2));b=Math.sqrt(Math.pow(c-g.y-d.y,2)+
Math.pow(b-g.x-d.x,2));target.scaling=!0;f?"x"!==f||target.lockUniScaling?"y"!==f||target.lockUniScaling||target.lockScalingY||a.utility.setVal(target,"scaleY",g.scaleY*b/h):target.lockScalingX||a.utility.setVal(target,"scaleX",g.scaleX*b/h):(target.lockScalingX||a.utility.setVal(target,"scaleX",g.scaleX*b/h),target.lockScalingY||a.utility.setVal(target,"scaleY",g.scaleY*b/h))}},translateObject:function(b,c){var f=a.main.currentTransform.target;f.lockMovementX||a.utility.setVal(f,"x",b-a.main.currentTransform.offsetX);
f.lockMovementY||a.utility.setVal(f,"y",c-a.main.currentTransform.offsetY);return f}}})(window);(function(d){d.vcan.rectangle=function(){return{type:"rectangle",init:function(a){void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,b,c){c=-b.width/2;var f=-b.height/2,g=b.width,d=b.height;a.beginPath();a.strokeStyle=void 0!=b.borderColor?'"'+b.strokeColor+'"':"#000";a.moveTo(c,f);a.stroke();a.lineTo(c+g,f);a.stroke();a.lineTo(c+g,f+d);a.stroke();a.lineTo(c,f+d);a.stroke();a.lineTo(c,f);a.fillStyle=void 0!=b.fillColor?b.fillColor:" ";a.closePath();a.stroke();
void 0!=b.fillColor&&(a.fillStyle=b.fillColor,a.fill())}}}})(window);(function(d){d.vcan.oval=function(){return{type:"oval",init:function(a){void 0==a.width&&(a.width=2*a.rx);void 0==a.height&&(a.height=2*a.ry);void 0==a.borderColor&&(a.borderColor="#000000");void 0!=a.fillColor&&(a.fillStyle=a.fillColor);return a},draw:function(a,b,c){a.beginPath();a.save();var f=2*Math.PI;a.lineWidth=b.lineWidth;var g=b.ry/b.rx,g=g.toFixed(3);0==g&&(g=.01);a.transform(1,0,0,g,0,0);a.arc(c?b.x:0,c?b.y:0,b.rx,0,f,!1);a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());
void 0!=b.borderColor&&(a.fillStyle=b.borderColor,a.stroke());a.restore()}}}})(window);(function(d){d.vcan.triangle=function(){return{type:"triangle",init:function(a){a.fillStyle=a.fillColor;void 0==a.dRoad&&(a.dRoad="ltr");void 0==a.width&&(a.width=a.ex-a.sx);void 0==a.height&&(a.height=a.ey-a.sy);void 0==a.x&&(a.x=a.ex-a.width/2);void 0==a.y&&(a.y=a.ey-a.height/2);return a},draw:function(a,b,c){a.beginPath();if("t2b"==b.dRoad){c=b.width/2;var f=b.height/2}else c=-b.width/2,f=-b.height/2;a.lineWidth=b.lineWidth;void 0!=b.borderColor&&(a.strokeStyle=b.borderColor);a.moveTo(-c,f);a.lineTo(0,
-f);a.lineTo(c,f);a.closePath();void 0!=b.fillStyle&&(a.fillStyle=b.fillStyle,a.fill());a.stroke()}}}})(window);(function(d){d.vcan.line=function(){return{type:"line",init:function(a){var b=a.start.x,c=a.start.y,f=a.end.x,g=a.end.y;void 0==a.width&&(a.width=f-b,a.height=g-c);a.x=b+(f-b)/2;a.y=c+(g-c)/2;return a},draw:function(a,b,c){a.beginPath();c=1===b.width?0:b.width/2;var f=1===b.height?0:b.height/2;a.moveTo(1===b.width?0:-b.width/2,1===b.height?0:-b.height/2);a.lineTo(c,f);a.lineWidth=b.lineWidth;void 0!=b.lineColor&&(a.strokeStyle=b.lineColor);a.closePath();a.stroke()}}}})(window);(function(d){d.vcan.text=function(){return{type:"text",init:function(a){a.lineHeight=1.3;void 0==a.fontSize&&(a.fontSize=30);a.font=a.fontSize+"px Times New Roman";return a},draw:function(a,b,c){a.font=b.font;c=b.text.split(/\r?\n/);b.height=this.getTextHeight(a,c,b);b.width=this.getTextWidth(a,c);a.beginPath();for(var f=0,g=c.length;f<g;f++)a.fillText(c[f],-b.width/2,-b.height/2+f*b.fontSize*b.lineHeight+b.fontSize);a.closePath();b.setCoords()},getTextWidth:function(a,b){for(var c=a.measureText(b[0]).width,
f=1,g=b.length;f<g;f++){var d=a.measureText(b[f]).width;d>c&&(c=d)}return c},getTextHeight:function(a,b,c){return c.fontSize*b.length*c.lineHeight},removeTextNode:function(){for(var a=document.getElementsByClassName("textBoxContainer"),b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])}}}})(window);(function(d){var a=d.vcan;a.main.freeHandDrawing=function(b){return{type:"freeDrawing",init:function(){this.contextTop={};this.isCurrentlyDrawing=!1;this.freeDrawingXPoints=[];this.freeDrawingYPoints=[];this.mdTime=[];this.freeDrawingColor=void 0==b.borderColor?"#000000":b.borderColor;this.freeDrawingLineWidth=void 0!=b.lineWidth?b.lineWidth:"3";return this},fhdStart:function(a,b,d){d=(new Date).getTime();this.contextTop=a;this.isCurrentlyDrawing=!0;this.freeDrawingXPoints.push(b.x);this.freeDrawingYPoints.push(b.y);
this.contextTop.beginPath();this.contextTop.save();this.contextTop.moveTo(b.x,b.y);this.mdTime.push(d);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},fhRendering:function(a,b){var d=(new Date).getTime();this.freeDrawingXPoints.push(a.x);this.freeDrawingYPoints.push(a.y);this.contextTop.lineTo(a.x,a.y);this.contextTop.stroke();this.mdTime.push(d)},finalizeDrawingPath:function(c,f,d){(new Date).getTime();
this.contextTop.closePath();this.isCurrentlyDrawing=!1;var k=this.utility.min(this.freeDrawingXPoints);f=this.utility.min(this.freeDrawingYPoints);var h=this.utility.max(this.freeDrawingXPoints);d=this.utility.max(this.freeDrawingYPoints);var m=[],n,p,q,r=this.freeDrawingXPoints,u=this.freeDrawingYPoints,s=this.mdTime;m.push("M ",r[0]-k," ",u[0]-f," ",s[0]," ");for(var v=1;n=r[v],p=u[v],q=s[v];v++)m.push("L ",n-k," ",p-f," ",q," ");m=m.join("");if("M 0 0 L 0 0 "!==m)return n=this.freeDrawingXPoints[this.freeDrawingXPoints.length-
1],p=this.freeDrawingYPoints[this.freeDrawingYPoints.length-1],q=new a.Path(m,this),q.mp={},q.mp.x=n,q.mp.y=p,q.init(m),q=c.readyObject(q),q.coreObj.type="freeDrawing",q=q.coreObj,q.fill=null,q.stroke=this.freeDrawingColor,q.strokeWidth=this.freeDrawingLineWidth,q.minX=k,q.minY=f,this.utility.objAdd(q),c=a.utility.setVal(q,"x",k+(h-k)/2),c=a.utility.setVal(c,"y",f+(d-f)/2),c.setCoords(),"object"==typeof b&&this.contextTop.restore(),a.renderAll(this.contextTop),c},utility:{max:function(a,b){if(a&&
0!==a.length){var d=a.length-1,k=b?a[d][b]:a[d];if(b)for(;d--;)a[d][b]>=k&&(k=a[d][b]);else for(;d--;)a[d]>=k&&(k=a[d]);return k}},min:function(a,b){if(a&&0!==a.length){var d=a.length-1,k=b?a[d][b]:a[d];if(b)for(;d--;)a[d][b]<k&&(k=a[d][b]);else for(;d--;)a[d]<k&&(k=a[d]);return k}},objAdd:function(b){a.main.children.push(b);return this}}}}})(window);(function(d){var a=d.vcan;a.Path=function(b,c){return{objectType:"path",init:function(a,b){b=b||{};this.commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};if(!a)throw Error("`path` argument is required");if(this.path=a.match&&a.match(/[a-zA-Z][^a-zA-Z]*/g))return this.initializeFromArray(b),this},initializeFromArray:function(a){var b="width"in a,c="height"in a;this.path=this._parsePath();b&&c||(this.utility.extend(this,this._parseDimensions()),b&&(this.width=a.width),c&&(this.height=a.height))},
_render:function(a){var b,c=0;b=0;for(var d=-(this.width/2),m=-(this.height/2),n=0,p=this.path.length;n<p;++n)switch(b=this.path[n],b[0]){case "L":c=b[1];b=b[2];a.lineTo(c+d,b+m);break;case "M":c=b[1],b=b[2],a.moveTo(c+d,b+m)}},replay_render:function(a,b,c,d){var m=y=0;switch(b[0]){case "L":m+=b[1];y+=b[2];a.lineTo(m+c,y+d);a.stroke();break;case "M":m+=b[1],y+=b[2],a.moveTo(m+c,y+d)}},render:function(b,c){b.save();var d=this.transformMatrix;d&&b.transform(d[0],d[1],d[2],d[3],d[4],d[5]);c||a.transform(b,
this);this.overlayFill?b.fillStyle=this.overlayFill:this.fill&&(b.fillStyle=this.fill);this.stroke&&(b.strokeStyle=this.stroke);b.beginPath();this._render(b);this.fill&&b.fill();this.stroke&&(b.strokeStyle=this.stroke,b.lineWidth=this.strokeWidth,b.lineCap=b.lineJoin="round",b.stroke());!c&&this.active&&(this.drawBorders(b),this.hideCorners||this.drawCorners(b));b.restore()},_parsePath:function(){for(var a=[],b,c,d,m=0,n,p=this.path.length;m<p;m++){var q=/\d+\s$/.exec(this.path[m]);null!=q&&(b=this.path[m].indexOf(q),
this.path[m]=this.path[m].substring(0,b));b=this.path[m];c=b.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);b=[b.charAt(0)];n=0;for(var r=c.length;n<r;n++)d=parseFloat(c[n]),isNaN(d)||b.push(d);c=b[0].toLowerCase();c=this.commandLengths[c];if(b.length-1>c)for(d=1,n=b.length;d<n;d+=c)null==q?a.push([b[0]].concat(b.slice(d,d+c))):(a.push([b[0]].concat(b.slice(d,d+c))),b.push(q),a.push(b));else null!=q&&b.push(q[0]),a.push(b)}return a},_parseDimensions:function(){var a=[],b=[],d,h,m=!1,
n,p;this.path.forEach(function(c,q){if(" "!=c[3])var s=c.splice(3);"H"!==c[0]&&(d=0===q?this.utility.getX(c):this.utility.getX(this.path[q-1]));"V"!==c[0]&&(h=0===q?this.utility.getY(c):this.utility.getY(this.path[q-1]));c[0]===c[0].toLowerCase()&&(m=!0);n=m?d+this.utility.getX(c):"V"===c[0]?d:this.utility.getX(c);p=m?h+this.utility.getY(c):"H"===c[0]?h:this.utility.getY(c);var v=parseInt(n,10);isNaN(v)||a.push(v);v=parseInt(p,10);isNaN(v)||b.push(v);void 0!=s&&1<=s.length&&c.push(s[0])},this);var q=
c.utility.min(a),q={y:c.utility.min(b)-0,x:q-0,bottom:c.utility.max(b)-0,right:c.utility.max(a)-0};q.width=q.right-q.x;q.height=q.bottom-q.y;return q},utility:{getX:function(a){return"H"===a[0]?a[1]:a[a.length-2]},getY:function(a){return"V"===a[0]?a[1]:a[a.length-1]},extend:function(a,b){for(var c in b)a[c]=b[c];return a}}}}})(window);(function(d){var a=d.vcan;a.mouse=function(){return{init:function(){this.bindHandlers()},bindHandlers:function(){canvasElement=a.main.canvas;var b={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"};for(type in b)"mousedown"==type?canvasElement.addEventListener(type,this.mousedown,!1):"mousemove"==type?canvasElement.addEventListener(type,this.mousemove,!1):"mouseup"==type&&canvasElement.addEventListener(type,this.mouseup,!1)},mousedown:function(b,c){b.detail.hasOwnProperty("cevent")&&
"create"!=a.main.action&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);lastmousemovetime=null;this.moveChunk=[];if("move"==a.main.action){if(!a.main.currentTransform){var f=a.events().findTarget(b);a.utility.getReltivePoint(b);f?(0<a.main.children.length&&
f.setZindex(),f.downObj=!0,f.setupCurrentTransform(b),a.utility.setActiveObject(f),a.main.currObj=f):a.deactivateAll();void 0!=f&&a.renderAll();b.detail.hasOwnProperty("cevent")||(f=(new Date).getTime(),f=a.makeStackObj(f,"d",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y),vApp.wb.uid++,console.log("uid "+vApp.wb.uid),f.uid=vApp.wb.uid,a.main.replayObjs.push(f),vApp.wb.utility.beforeSend({repObj:[f]}),vApp.wb.utility.updateSentPackets(f))}}else"create"==a.main.action&&(b.detail.hasOwnProperty("cevent")&&
(b.clientX=b.detail.cevent.x+vApp.wb.vcan.main.offset.x,b.clientY=b.detail.cevent.y+vApp.wb.vcan.main.offset.y,b.x=b.detail.cevent.x+vApp.wb.vcan.main.offset.x,b.y=b.detail.cevent.x+vApp.wb.vcan.main.offset.y,b.pageX=b.detail.cevent.x+vApp.wb.vcan.main.offset.x,b.pageY=b.detail.cevent.y+vApp.wb.vcan.main.offset.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y),f=a.events().findTarget(b),a.utility.getReltivePoint(b),f&&"text"==f.type&&"t_text"==vApp.wb.tool.cmd&&f.setupCurrentTransform(b))},mousemove:function(b){b.detail.hasOwnProperty("cevent")&&
(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);if("move"==a.main.action){var c=a.main;if(c.currentTransform){var f=a.utility.actualPointer(b),d=f.x,f=f.y;c.currentTransform.target.isMoving=!0;if("rotate"===c.currentTransform.action)a.interact.rotateObject(d,
f),c.currentTransform.target.hasRotatingPoint||a.interact.scaleObject(d,f),b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b);else if("scale"===c.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),a.interact.scaleObject(d,f);else if("scaleX"===c.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),a.interact.scaleObject(d,f,"x");else if("scaleY"===c.currentTransform.action)b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b),
a.interact.scaleObject(d,f,"y");else if(c.currentTransform.target.draggable){var k=a.extend({},a.main.currentTransform.target);(new Date).getTime();!0==c.currentTransform.target.downObj&&(a.main.dragMode=!0,c.currentTransform.target.downObj=!1);k=a.interact.translateObject(d,f);b.detail.hasOwnProperty("cevent")||a.optimize.doOptiMize(b);k.setActive(!0);k.setCoords()}if("scaleX"===c.currentTransform.action||"scaleY"===c.currentTransform.action||"rotate"===c.currentTransform.action&&!c.currentTransform.target.hasRotatingPoint)a.main.scaleMode=
!0,(new Date).getTime(),c.currentTransform.target.downObj&&(c.currentTransform.target.downObj=!1),k=a.extend({},a.main.currentTransform.target),k.setCoords();a.renderAll()}else a.events().findTarget(b)}},mouseup:function(b){b.detail.hasOwnProperty("cevent")&&(b.clientX=a.main.offset.x+b.detail.cevent.x,b.clientY=a.main.offset.y+b.detail.cevent.y,b.x=a.main.offset.x+b.detail.cevent.x,b.y=a.main.offset.y+b.detail.cevent.y,b.pageX=a.main.offset.x+b.detail.cevent.x,b.pageY=a.main.offset.y+b.detail.cevent.y,
b.currX=b.detail.cevent.x,b.currY=b.detail.cevent.y);lastmousemovetime=null;if("move"==a.main.action){a.activMouse.mousemove(b);var c=a.main;if(c.currentTransform){var f=c.currentTransform.target;f.scaling&&(f.scaling=!1);for(f=c.children.length;f--;)c.children[f].setCoords()}c.currentTransform=null;a.renderAll();if(!0==a.main.dragMode||!0==a.main.scaleMode){a.utility.actualPointer(b);var d=(new Date).getTime();b.detail.hasOwnProperty("cevent")||a.optimize.calculatePackets(d,"u",b.clientX-a.main.offset.x,
b.clientY-a.main.offset.y);a.main.dragMode&&(a.main.dragMode=!1);a.main.scaleMode&&(a.main.scaleMode=!1)}else b.detail.hasOwnProperty("cevent")||a.optimize.calculatePackets(d,"u",b.clientX-a.main.offset.x,b.clientY-a.main.offset.y);a.wb.sentPack=!0}}}}})(window);(function(d){d.readyFreeHandObj=function(a,b){return{init:function(){this.freesvg=!0;this.fdObj={};this.borderColor=a;this.freeDrawingLineWidth=b},drawStart:function(a){var b=vApp.wb.vcan;if(!0==vApp.wb.obj.freeDrawObj.freesvg){var d=b.main.canvas.getContext("2d");this.fdObj=b.main.freeHandDrawing({borderColor:this.borderColor,lineWidth:this.freeDrawingLineWidth});this.fdObj.init();pointer=b.utility.getReltivePoint(a);this.fdObj.fhdStart(d,pointer)}},wb_draw:function(a){a=vcan.utility.getReltivePoint(a);
this.fdObj.fhRendering(a)},finalizeDraw:function(a){a=vApp.wb.vcan;vApp.wb.prvObj=this.fdObj.finalizeDrawingPath(vApp.wb.canvas);a.main.children[a.main.children.length-1].mt=vApp.wb.utility.stringToNumber(vApp.wb.prvObj.path[vApp.wb.prvObj.path.length-1][3])}}}})(window);(function(d){_replay=function(){return{init:function(a,b){var c=vApp.wb.vcan;this.objs="undefined"!=typeof b?c.getStates("replayObjs"):recorder.items;this.objNo=0;this.repMode=a;this.callBkfunc=""},renderObj:function(a){vApp.wb.drawMode=!0;if("undefined"==typeof this.objs[this.objNo])console.log("is this happend");else{"undefined"!=typeof a&&(this.callBkfunc=a);if(this.objs[this.objNo].hasOwnProperty("cmd"))vApp.wb.gObj.displayedObjId=this.objs[this.objNo].uid,vApp.wb.toolInit(this.objs[this.objNo].cmd,
"fromFile",!0);else{a="";if("del"==this.objs[this.objNo].ac)""!=vcan.main.currObj&&vApp.wb.utility.removeSelectedItem(vcan.main.currObj,!0);else{"d"==this.objs[this.objNo].ac?a="mousedown":"m"==this.objs[this.objNo].ac?a="mousemove":"u"==this.objs[this.objNo].ac&&(a="mouseup");var b=this.objs[this.objNo],b=b.hasOwnProperty("mtext")?{detail:{cevent:{x:b.x,y:b.y,mtext:b.mtext}}}:{detail:{cevent:{x:b.x,y:b.y}}};a=new CustomEvent(a,b);vcan.main.canvas.dispatchEvent(a)}vApp.wb.gObj.displayedObjId=this.objs[this.objNo].uid}"function"==
typeof this.callBkfunc&&this.objs[this.objs.length-1].uid==vApp.wb.gObj.displayedObjId&&this.callBkfunc("callBkfunc");if("object"==typeof this.objs[this.objNo+1]){vApp.wb.replayTime="undefined"!=typeof this.repMode&&"fromBrowser"==this.repMode?0:0==this.objNo?this.objs[this.objNo].mt-vApp.wb.pageEnteredTime:this.objs[this.objNo+1].mt-this.objs[this.objNo].mt;this.objNo++;var c=this;setTimeout(function(){c.renderObj.call(c)},vApp.wb.replayTime)}}}}};d._replay=_replay})(window);(function(d){d.readyTextObj=function(){return{init:function(a){this.currTextObjWrapper=this.prevTextObj="";this.currObject={};this.prvModTextObj={};this.prvCurrTransform={};this.totalBox=this.textWriteMode=0;this.boxContainer=a;this.muser=!1},textUtility:function(a,b,c){this.startPosX=a;this.startPosY=b;var f=vApp.wb.vcan,d=f.main.canvas.getContext("2d"),k={};this.textWriteMode++;this.wmode=!0;void 0!=f.main.currentTransform&&""!=f.main.currentTransform?(this.currObject=f.main.currentTransform.target,
void 0!=this.currObject&&"text"==this.currObject.type&&(k={width:300,height:100,x:this.currObject.oCoords.tl.x,y:this.currObject.oCoords.tl.y,text:this.currObject.text},vApp.wb.utility.clickOutSidebox(this.textWriteMode)||vApp.wb.obj.drawTextObj.drawTextBoxWrapper(k,this.currObject.id),f.main.currentTransform=""),vApp.wb.utility.clickOutSidebox(this.textWriteMode)&&vApp.wb.obj.drawTextObj.renderText(this.prvCurrTransform,this.prvModTextObj,d),void 0!=this.currObject&&"text"==this.currObject.type&&
(this.prvModTextObj={prvObjId:this.currObject.id,prvText:this.currObject.text,x:this.currObject.x,y:this.currObject.y},this.prvTextObj=this.currObject),this.prvCurrTransform=this.currObject):vApp.wb.utility.clickOutSidebox(this.textWriteMode)?"undefined"!=typeof c?vApp.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,d,c):vApp.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,d):(this.totalBox++,k={x:a,y:b,width:300,height:100},"undefined"==typeof c?vApp.wb.obj.drawTextObj.drawTextBoxWrapper(k,
this.totalBox):vApp.wb.obj.drawTextObj.drawTextBoxWrapper(k,this.totalBox,c))},drawTextBoxWrapper:function(a,b,c){var f=vApp.wb.vcan;c=document.createElement("div");c.id="box"+b;c.className="textBoxContainer";c.style.position="absolute";c.style.left=f.main.offset.x+a.x+"px";c.style.top=a.y+"px";b=document.createElement("textarea");b.id=c.id+"textarea";b.rows=8;b.cols=41;void 0!=a.text&&""!=a.text&&(b.value=a.text);c.appendChild(b);document.getElementById(this.boxContainer).appendChild(c);this.prevTextObj=
c;this.currTextObjWrapper=a;this.prevTextObj.measure=a;vApp.wb.utility.toolWrapperDisable(!0)},renderText:function(a,b,c,f){var d=vApp.wb.vcan;if(""!=this.prevTextObj){if(!vApp.wb.utility.IsObjEmpty(a))for(var k=0;k<d.main.children.length;k++)if(a.id==d.main.children[k].id){d.main.children.splice(k,1);this.currObject="";break}vApp.wb.utility.IsObjEmpty(a)?"undefined"!=typeof f?this.finalizeText(c,this.prevTextObj,"undefined",f):this.finalizeText(c,this.prevTextObj):"undefined"!=typeof f?this.finalizeText(c,
this.prevTextObj,b,f):this.finalizeText(c,this.prevTextObj,b);vApp.wb.obj.drawTextObj.wmode=!1}},finalizeText:function(a,b,c,f){c=vApp.wb.vcan;var d=document.getElementById(b.id),k="";if("undefined"==typeof f){f=d.getElementsByTagName("textarea");for(var h=0;h<f.length;h++)if(f[h].id==d.id+"textarea"){k=f[h].value;break}}else k=f;a.font="20px Times New Roman";var m=0,n=k.split(/\r?\n/),m=a.measureText(n[0]).width;f=15;for(h=1;h<n.length;h++){f+=15;var p=a.measureText(n[h]).width;p>m&&(m=p)}m/=2;h=
(new Date).getTime();a={type:"text",text:k,x:b.measure.x+m,y:b.measure.y+f,fontSize:20,fontWidth:a.measureText(k).width,mp:{x:b.measure.x,y:b.measure.y}};!1==vApp.wb.obj.drawTextObj.muser&&(k={mt:h,ac:"d",x:this.startPosX,y:this.startPosY,mtext:a.text},vApp.wb.uid++,k.uid=vApp.wb.uid,c.main.replayObjs.push(k),vApp.storage.store(JSON.stringify(c.main.replayObjs)),vApp.storage.wholeStore(k),vApp.wb.utility.beforeSend({repObj:[k]}),vApp.wb.utility.updateSentPackets(k));a=vApp.wb.canvas.readyObject(a);
vApp.wb.canvas.addObject(a);c.main.children[c.main.children.length-1].mt=h;d.parentNode.removeChild(b);c.renderAll();0<vApp.wb.sentPackets&&null!=document.getElementById(vApp.wb.sentPackDiv)&&(document.getElementById(vApp.wb.sentPackDiv).innerHTML=vApp.wb.sentPackets);vApp.wb.utility.toolWrapperEnable(!0)}}}})(window);(function(d){d.keyBoard={prvTool:"",skey:!1,triggerActiveAll:function(a){a.shiftKey&&(console.log("what happend mere bhai"),vApp.wb.keyBoard.skey=!0,vApp.wb.keyBoard.prvTool=vApp.wb.tool.cmd,vApp.wb.toolInit("t_activeall"),a={cmd:"t_activeall",mt:(new Date).getTime()},vcan.main.replayObjs.push(a),vApp.wb.utility.beforeSend({repObj:[a]}),vApp.wb.vcan.main.action="move")},triggerdeActiveAll:function(a){vApp.wb.keyBoard.skey&&(console.log("what happend mere bhai ddd"),a=(new Date).getTime(),vApp.wb.utility.deActiveFrmDragDrop(),
vApp.wb.toolInit(vApp.wb.keyBoard.prvTool),a={cmd:vApp.wb.keyBoard.prvTool,mt:a},vcan.main.replayObjs.push(a),vApp.wb.utility.beforeSend({repObj:[a]}))}}})(window);(function(d){d.adapter=function(){return{RTCPeerConnection:null,webrtcDetectedBrowser:null,init:function(a){!0==vApp.system.wbRtc.peerCon&&!0==vApp.system.wbRtc.userMedia&&(a.mozGetUserMedia?(d.webrtcDetectedBrowser="firefox",this.RTCPeerConnection=mozRTCPeerConnection,this.RTCSessionDescription=mozRTCSessionDescription,this.RTCIceCandidate=mozRTCIceCandidate,a.getUserMedia=a.mozGetUserMedia,this.attachMediaStream=function(a,c){this.videoAdd=!0;var f=d.URL||d.webkitURL;a.src=f?f.createObjectURL(c):
c;a.play()},reattachMediaStream=function(a,c){console.log("Reattaching media stream");a.mozSrcObject=c.mozSrcObject;a.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]}):a.webkitGetUserMedia?(console.log("This appears to be Chrome"),d.webrtcDetectedBrowser="chrome",this.RTCPeerConnection=webkitRTCPeerConnection,this.RTCSessionDescription=RTCSessionDescription,this.RTCIceCandidate=RTCIceCandidate,a.getUserMedia=a.webkitGetUserMedia,
this.attachMediaStream=function(a,c){var f=d.URL||d.webkitURL;a.src=f?f.createObjectURL(c):c;a.play();this.videoAdd=!0},reattachMediaStream=function(a,c){a.src=c.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},
webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})):console.log("Browser does not appear to be WebRTC-capable"));return a}}}})(window);function Resampler(d,a,b,c,f){this.fromSampleRate=d;this.toSampleRate=a;this.channels=b|0;this.outputBufferSize=c;this.noReturn=!!f;this.initialize()}
Resampler.prototype.initialize=function(){if(0<this.fromSampleRate&&0<this.toSampleRate&&0<this.channels)this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers());else throw Error("Invalid settings specified for the resampler.");
};
Resampler.prototype.compileLinearInterpolationFunction=function(){for(var d="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = this.lastWeight;\t\t\tvar firstWeight = 0;\t\t\tvar secondWeight = 0;\t\t\tvar sourceOffset = 0;\t\t\tvar outputOffset = 0;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tfor (; weight < 1; weight += ratioWeight) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;",a=
0;a<this.channels;++a)d+="outputBuffer[outputOffset++] = (this.lastOutput["+a+"] * firstWeight) + (buffer["+a+"] * secondWeight);";d+="}\t\t\tweight -= 1;\t\t\tfor (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;";for(a=0;a<this.channels;++a)d+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(0<a?" + "+a:"")+"] * firstWeight) + (buffer[sourceOffset + "+
(this.channels+a)+"] * secondWeight);";d+="weight += ratioWeight;\t\t\t\tsourceOffset = Math.floor(weight) * "+this.channels+";\t\t\t}";for(a=0;a<this.channels;++a)d+="this.lastOutput["+a+"] = buffer[sourceOffset++];";this.resampler=Function("buffer",d+'this.lastWeight = weight % 1;\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.compileMultiTapFunction=function(){for(var d="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = 0;",a=0;a<this.channels;++a)d+="var output"+a+" = 0;";d+="var actualPosition = 0;\t\t\tvar amountToNext = 0;\t\t\tvar alreadyProcessedTail = !this.tailExists;\t\t\tthis.tailExists = false;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tvar outputOffset = 0;\t\t\tvar currentPosition = 0;\t\t\tdo {\t\t\t\tif (alreadyProcessedTail) {\t\t\t\t\tweight = ratioWeight;";
for(a=0;a<this.channels;++a)d+="output"+a+" = 0;";d+="}\t\t\t\telse {\t\t\t\t\tweight = this.lastWeight;";for(a=0;a<this.channels;++a)d+="output"+a+" = this.lastOutput["+a+"];";d+="alreadyProcessedTail = true;\t\t\t\t}\t\t\t\twhile (weight > 0 && actualPosition < bufferLength) {\t\t\t\t\tamountToNext = 1 + actualPosition - currentPosition;\t\t\t\t\tif (weight >= amountToNext) {";for(a=0;a<this.channels;++a)d+="output"+a+" += buffer[actualPosition++] * amountToNext;";d+="currentPosition = actualPosition;\t\t\t\t\t\tweight -= amountToNext;\t\t\t\t\t}\t\t\t\t\telse {";
for(a=0;a<this.channels;++a)d+="output"+a+" += buffer[actualPosition"+(0<a?" + "+a:"")+"] * weight;";d+="currentPosition += weight;\t\t\t\t\t\tweight = 0;\t\t\t\t\t\tbreak;\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (weight == 0) {";for(a=0;a<this.channels;++a)d+="outputBuffer[outputOffset++] = output"+a+" / ratioWeight;";d+="}\t\t\t\telse {\t\t\t\t\tthis.lastWeight = weight;";for(a=0;a<this.channels;++a)d+="this.lastOutput["+a+"] = output"+a+";";this.resampler=Function("buffer",d+'this.tailExists = true;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t} while (actualPosition < bufferLength && outputOffset < outLength);\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.bypassResampler=function(d){return this.noReturn?(this.outputBuffer=d,d.length):d};Resampler.prototype.bufferSlice=function(d){if(this.noReturn)return d;try{return this.outputBuffer.subarray(0,d)}catch(a){try{return this.outputBuffer.length=d,this.outputBuffer}catch(b){return this.outputBuffer.slice(0,d)}}};
Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(d){this.outputBuffer=[],this.lastOutput=[]}};(function(d){repMode=!1;var a=d.io,b=0,c=0,f=0,g=0,k=65535,h=0;d.media=function(){return{isChannelReady:"",isInitiator:!1,isStarted:"",localStream:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",oneExecuted:!1,videoControlId:"videoContainer",videoContainerId:"videos",audio:{audioStreamArr:[],tempAudioStreamArr:[],recordingLength:0,bufferSize:0,encMode:"alaw",recordAudio:!1,resampler:new Resampler(44100,8E3,1,4096),rec:"",otherSound:!1,audioNodes:[],sdElem:"silenceDetect",
Html5Audio:{audioContext:new AudioContext},init:function(){null!=localStorage.getItem("orginalTeacherId")&&(vApp.gObj.audMouseDown=!0);this.graph={height:56,width:4,average:0,display:function(){var a=cthis.video;"t"==vApp.gObj.uRole&&this._display(a.tempVidCont,this.height-this.height*this.average/100)},_display:function(a,b){a.beginPath();a.moveTo(this.width,this.height);a.lineTo(this.width,b);a.lineWidth=this.width;a.strokeStyle="rgba(32, 37, 247, 0.8)";a.closePath();a.stroke()},canvasForVideo:function(){var a=
cthis.video.myVideo.parentNode,b=document.createElement("canvas");b.width=this.width+3;b.height=this.height;b.id="graphCanvas";a.style.position="relative";b.style.position="absolute";b.style.left=0;b.style.top=-7;a.appendChild(b)}};this.attachFunctionsToAudioWidget()},slienceDetection:function(a,d){var p=0,q=0,r=0;for(i=0;i<d.length;i++)r=Math.abs(d[i]),p<r&&(p=r),q+=r;g=q/d.length;r=Math.abs(g^2-f^2);f=g;5>r&&(k=p);k>p&&(k=p);h<p&&(h=p);50*k<h&&(k*=5);h/50>k&&(h=p);q=h/k;switch(!0){case 8<q:r=2.5;
break;case 5<q:r=2;break;case 3<q:r=1.2;break;default:r=1}2<=q&&p>=k*r?(0==b&&0!=c&&(vApp.wb.utility.audioSend(c),c=0),vApp.wb.utility.audioSend(a,"sending"),b=9):0<b?(vApp.wb.utility.audioSend(a,"sending"),b--):2>q?vApp.wb.utility.audioSend(a,"sending"):(this.setAudioStatus("notSending"),10<q&&(h*=.8),c=a);return a},setAudioStatus:function(a){if("undefined"==typeof b)var b=document.getElementById("audioWidget").getElementsByClassName(this.sdElem)[0];b.setAttribute("data-silence-detect",a)},makeIconNotDraggable:function(a,
b){var c=document.getElementById(a,b).getContext("2d"),f=new Image;f.onload=function(){c.drawImage(f,0,0)};f.src=d.whiteboardPath+"images/"+b},attachFunctionsToAudioWidget:function(){for(var a=document.getElementById("audioWidget").getElementsByClassName("audioTool"),b=0;b<a.length;b++)"speakerPressOnce"!=a[b].id&&"speakerPressing"==a[b].id&&this.attachSpeakToStudent(a[b].id),"speakerPressing"!=a[b].id&&a[b].addEventListener("click",this.audioToolInit)},audioToolInit:function(){var a=vApp.gObj.video.audio;
"speakerPressOnce"==this.id?a.clickOnceSpeaker(this.id):"audioTest"==this.id?confirm(vApp.lang.getString("audioTest"))&&a.testInit(this.id):"silenceDetect"==this.id&&(this.getElementsByTagName("a"),a.sd?(a.sd=!1,this.className+=" sdDisable"):(a.sd=!0,this.className+=" sdEnable"))},attachSpeakToStudent:function(a){var b=this,c=document.getElementById(a),f=!1;c.addEventListener("mousedown",function(){if(!vApp.gObj.audMouseDown){b.studentSpeak(c);f=!0;var a=document.getElementById("speakerPressonceLabel");
null!=a&&vApp.vutil.elemHasAnyClass("speakerPressonceLabel")&&a.classList.contains("silenceDetect")&&(a.removeAttribute("data-silence-detect"),a.classList.remove("silenceDetect"),0>=a.classList.length&&a.removeAttribute("class"),a=a.getElementsByTagName("i")[0],null!=a&&(a.setAttribute("data-silence-detect","stop"),a.className+=" silenceDetect"))}});c.addEventListener("mouseup",function(){if(f){b.studentNotSpeak(c);f=!1;var a=document.getElementById("speakerPressonceLabel"),d=a.getElementsByTagName("i")[0];
"undefined"!=typeof d.classList&&d.classList.contains("silenceDetect")&&(d.classList.remove("silenceDetect"),0>=d.classList.length&&d.removeAttribute("class"),a.removeAttribute("data-silence-detect"));null!==a&&(a.setAttribute("data-silence-detect","stop"),a.className=d.className+" silenceDetect")}})},attachAudioPressOnce:function(){var a=document.getElementById("speakerPressOnce");a.setAttribute("data-audio-playing","false");var b=this;a.addEventListener("click",function(){b.clickOnceSpeaker.call(b,
a.id)})},clickOnceSpeaker:function(a,b){var c=document.getElementById(a),f=document.getElementById("speakerPressing"),d=c.getElementsByClassName("tooltip")[0];"false"==c.getAttribute("data-audio-playing")&&"undefined"==typeof b?(this.studentSpeak(f),c.setAttribute("data-audio-playing","true"),d.setAttribute("data-title",vApp.lang.getString("disableSpeaker")),c.className="audioTool active"):(this.studentNotSpeak(f),c.setAttribute("data-audio-playing","false"),d.setAttribute("data-title",vApp.lang.getString("enableSpeaker")),
c.className="audioTool deactive")},studentSpeak:function(a){"undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("deactive"),a.classList.add("active"));vApp.gObj.audMouseDown=!0;vApp.wb.utility.beforeSend({sad:!0})},studentNotSpeak:function(a){vApp.gObj.hasOwnProperty("audMouseDown")&&vApp.gObj.audMouseDown&&("undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("active"),a.classList.add("deactive")),a=document.getElementById("speakerPressOnce"),
a.setAttribute("data-audio-playing","false"),a.className="audioTool deactive",vApp.gObj.audMouseDown=!1,vApp.gObj.video.audio.setAudioStatus("stop"),vApp.wb.utility.beforeSend({sad:!1}))},ab2str:function(a){return String.fromCharCode.apply(null,new Int8Array(a))},str2ab:function(a){for(var b=new ArrayBuffer(a.length),b=new Int8Array(b),c=0,f=a.length;c<f;c++)b[c]=a.charCodeAt(c);return b},recorderProcess:function(b){(new Date).getTime();if(!repMode){b=b.inputBuffer.getChannelData(0);b=this.resampler.resampler(b);
this.recordAudio||(this.recordingLength+=this.bufferSize);l=b.length;for(buf=new Int16Array(l);l--;)buf[l]=32767*Math.min(1,b[l]);b=buf;var c=this.audioInLocalStorage(b);this.hasOwnProperty("storeAudio")&&this.storeAudio&&this.audioForTesting(b);vApp.gObj.audMouseDown&&1==a.sock.readyState&&this.slienceDetection(c,b)}},audioInLocalStorage:function(a){return G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1})},testInit:function(a){var b=document.getElementById(a);b.classList.add("audioIsTesting");this.studentNotSpeak();
vApp.gObj.audioForTest=[];this.storeAudio=!0;var c=this;c.otherSound=!0;c.hasOwnProperty("testAudio")&&clearTimeout(c.testAudio);c.testAudio=setTimeout(function(){c.playRecordedAudio(vApp.gObj.audioForTest,vApp.gObj.uid,!0)},5E3);setTimeout(function(){b.classList.remove("audioIsTesting");c.otherSound=!1},11E3)},audioForTesting:function(a){a=G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1});vApp.gObj.audioForTest.push(a);vApp.gObj[vApp.gObj.uid]=!1},playRecordedAudio:function(a,b,c){var f;this.myaudioNodes=
[];for(var d=0,g=0;g<a.length;g++)f=a[g],f=G711.decode(f,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0}),this.myaudioNodes.push(new Float32Array(f)),d+=f.length;f=this.mergeBuffers(this.myaudioNodes,d);"undefined"!=typeof c?vApp.gObj.video.audio.play(f,b,c):vApp.gObj.video.audio.play(f,b)},play:function(a,b,c){var f=JSON.parse(localStorage.getItem("vApp"+b)),d=this.Html5Audio.audioContext.createBuffer(1,a.length,8E3);d.getChannelData(0).set(a);var g=this.Html5Audio.audioContext.createBufferSource();
g.buffer=d;g.buffer=d;a=this.Html5Audio.audioContext.createGain();a.gain.value=.9;g.connect(a);a.connect(this.Html5Audio.audioContext.destination);f.ad&&f.aud&&(vApp.user.control.iconAttrManupulate(b,"icon-audioEnaGreen"),document.getElementById(f.id+"contrAudAnch").setAttribute("data-title",vApp.lang.getString("audioOn")));g.onended=function(){f=JSON.parse(localStorage.getItem("vApp"+b));"undefined"==typeof c&&(console.log("Stack length "+vApp.gObj.video.audio.audioToBePlay[b].length+"; UID "+b+
" video Start  Duration :"+g.buffer.duration),clearTimeout(vApp.gObj[b].out),vApp.gObj[b].isplaying=!1,0<vApp.gObj.video.audio.audioToBePlay[b].length?vApp.gObj.video.audio.getChunks(b):f.ad&&f.aud&&vApp.user.control.iconAttrManupulate(b,"icon-audioEnaOrange"))};g.start();console.log("stack length "+this.audioToBePlay[b].length+" UID "+b+" video Start  Duration :"+g.buffer.duration);vApp.gObj[b].isplaying=!0;"undefined"==typeof c&&(vApp.gObj[b].out=setTimeout(function(){console.log("Stack length "+
vApp.gObj.video.audio.audioToBePlay[b].length+"; UID "+b+" video ended OUT :"+g.buffer.duration);vApp.gObj[b].isplaying=!1;0<vApp.gObj.video.audio.audioToBePlay[b].length&&vApp.gObj.video.audio.getChunks(b)},1E3*g.buffer.duration+10))},calcAverage:function(){var a=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(a);for(var b=0,c=a.length,f=0;f<c;f++)b+=a[f];this.graph.average=b/c},audioInGraph:function(){var a=cthis.video;if("t"==vApp.gObj.uRole){var b=this.graph.height-this.graph.height*
this.graph.average/100;a.tempVidCont.beginPath();a.tempVidCont.moveTo(a.tempVid.width-this.graph.width,this.graph.height);a.tempVidCont.lineTo(a.tempVid.width-this.graph.width,b);a.tempVidCont.lineWidth=this.graph.width;a.tempVidCont.strokeStyle="rgba(247, 25, 77, 1)";a.tempVidCont.closePath();a.tempVidCont.stroke()}},queue:function(a,b){this.hasOwnProperty("audioToBePlay")||(this.audioToBePlay={});this.audioToBePlay.hasOwnProperty(b)||(this.audioToBePlay[b]=[]);this.audioToBePlay[b].push(a)},getChunks:function(a,
b){8<this.audioToBePlay[a].length?(this.audioToBePlay[a].length=0,vApp.gObj[a].isplaying=!1):0<this.audioToBePlay[a].length?(this.playRecordedAudio(this.audioToBePlay[a],a),this.audioToBePlay[a].length=0):vApp.gObj[a].isplaying=!1},replayInit:function(){vApp.storage.getAllObjs(["audioData"],function(){vApp.gObj.video.audio.replay(0,0)})},replay:function(a,b){repMode=!0;var c,f,d;0<this.audioNodes.length&&(c=this.mergeBuffers(this.audioNodes),f=this.Html5Audio.audioContext.currentTime+a,d=this.Html5Audio.audioContext.createBuffer(1,
c.length,7800),d.getChannelData(0).set(c),c=this.Html5Audio.audioContext.createBufferSource(),c.buffer=d,c.connect(this.Html5Audio.audioContext.destination),c.start(f,b))},mergeBuffers:function(a,b){for(var c=new Float32Array(b),f=0,d=a.length,g=0;g<d;g++){var h=a[g];c.set(h,f);f+=h.length}return c},assignFromLocal:function(a,b){this.init();for(var c=0;c<a.length;c++){var f=LZString.decompressFromBase64(a[c]),f=this.str2ab(f);samples=G711.decode(f,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,
Eight:!0});this.audioNodes.push(new Float32Array(samples));this.recordingLength+=16384}"undefined"!=typeof b&&b()},manuPulateStream:function(){var a=cthis.stream;vApp.vutil.chkValueInLocalStorage("recordStart")?vApp.wb.recordStarted=localStorage.getItem("recordStart"):(vApp.wb.recordStarted=(new Date).getTime(),localStorage.setItem("recordStart",vApp.wb.recordStarted));a=cthis.audio.Html5Audio.audioContext.createMediaStreamSource(a);cthis.audio.bufferSize=16384;grec=cthis.audio.Html5Audio.audioContext.createScriptProcessor(cthis.audio.bufferSize,
1,1);grec.onaudioprocess=cthis.audio.recorderProcess.bind(cthis.audio);var b=cthis.audio.Html5Audio.audioContext.createGain();b.gain.value=.9;a.connect(b);b.connect(grec);grec.connect(cthis.audio.Html5Audio.audioContext.destination)},updateInfo:function(){this.audioStreamArr=[];vApp.wb.pageEnteredTime=vApp.wb.recordStarted=(new Date).getTime();repMode=this.recordAudio=!1},receivedAudioProcess:function(a){a=this.extractData(a);var b=a[0];if("undefined"==typeof c)var c={};c.hasOwnProperty(b)||(c[b]=
{},c[b].ad=!0,c=vApp.user.control.updateUser(b,"ad",!0),vApp.user.control.audioSign(c,"create"));vApp.gObj.video.audio.queue(a[1],b);vApp.gObj.hasOwnProperty(b)&&vApp.gObj[b].hasOwnProperty("isplaying")?!1==vApp.gObj[b].isplaying&&vApp.gObj.video.audio.getChunks(b):(vApp.gObj[b]={},vApp.gObj[b].isplaying=!0,vApp.gObj.video.audio.getChunks(b))},extractData:function(a){a=new Uint8ClampedArray(a);return[vApp.vutil.numValidateFour(a[1],a[2],a[3],a[4]),a.subarray(5,a.length)]}},video:{width:75,height:56,
tempVid:"",tempVidCont:"",myVideo:"",remoteVid:"",remoteVidCont:"",maxHeight:250,init:function(){this.videoCont=document.getElementById("allVideosCont");null!=this.videoCont&&(this.videoCont.style.maxHeight=this.maxHeight+"px")},calcDimension:function(){this.myVideo.width=this.width;this.myVideo.height=this.height},removeUser:function(a){a=document.getElementById("user"+a);null!=a&&a.parentNode.removeChild(a)},createElement:function(a){var b=document.createElement("div");b.className="videoWrapper";
var c=document.createElement("div");c.className="videoSubWrapper";c.id="user"+a.id;b.appendChild(c);vidId=a.id;var f=document.createElement("canvas");f.id="video"+vidId;f.className="userVideos";f.width=this.width;f.height=this.height;c.appendChild(f);cthis.video.imageReplaceWithVideo(a.id,b)},updateHightInSideBar:function(a){var b=document.getElementById("widgetRightSide").offsetHeight;document.getElementById("chatContainer").style.height=b-a+"px"},send:function(){function b(){function h(){try{f.tempVidCont.drawImage(f.myVideo,
0,0,f.width,f.height)}catch(a){if("NS_ERROR_NOT_AVAILABLE"==a.name)setTimeout(h,100);else throw a;}}if("t"==vApp.gObj.uRole){if("undefined"==typeof k){var k=document.getElementById("graphCanvas");null!=k&&(cthis.audio.graph.cvCont=k.getContext("2d"))}null!=k&&cthis.audio.graph.cvCont.clearRect(0,0,k.width,k.height)}f.tempVidCont.clearRect(0,0,f.tempVid.width,f.tempVid.height);d.navigator.userAgent.match("Firefox")?h():f.tempVidCont.drawImage(f.myVideo,0,0,f.width,f.height);"t"==vApp.gObj.uRole&&cthis.audio.graph.display();
k={name:vApp.gObj.uName,id:vApp.gObj.uid};"t"==vApp.gObj.uRole&&(k.role=vApp.gObj.uRole);vApp.wb.utility.beforeSend({videoByImage:k});var k=f.tempVidCont.getImageData(0,0,f.tempVid.width,f.tempVid.height),k=vApp.dirtyCorner.encodeRGB(k.data),s=c(vApp.gObj.uid,8),s=new Uint8ClampedArray([11,s[0],s[1],s[2],s[3]]),v=new Uint8ClampedArray(k.length+s.length);v.set(s);v.set(k,s.length);a.sendBinary(v);clearInterval(vApp.gObj.video.smallVid);k=2E3+2500*vApp.gObj.totalUser.length;g!=vApp.gObj.totalUser?(g=
vApp.gObj.totalUser.length,s=vApp.gObj.totalUser.indexOf(vApp.gObj.uId),vApp.gObj.video.smallVid=setInterval(b,k+k/g*s)):vApp.gObj.video.smallVid=setInterval(b,k)}function c(a,b){for(var f=a.toString(),d=f.length;d<b;d++)f="0"+f;return f.match(/[\S]{1,2}/g)||[]}vApp.gObj.video.hasOwnProperty("smallVid")&&clearInterval(vApp.gObj.video.smallVid);var f=this;randomTime=Math.floor(10001*Math.random())+5E3;var g=-1;vApp.gObj.video.smallVid=setInterval(b,300)},startToStream:function(){cthis.video.calcDimension();
cthis.video.send()},playWithoutSlice:function(a,b){this.remoteVid=document.getElementById("video"+a);this.remoteVidCont=this.remoteVid.getContext("2d");var c=vApp.dirtyCorner.decodeRGB(b,this.remoteVidCont,this.remoteVid);this.remoteVidCont.putImageData(c,0,0)},justForDemo:function(){var a=0,b=document.getElementById("allVideosCont");b.style.maxHeight="250px";setInterval(function(){if(20>=++a){b=document.getElementById("allVideosCont");var c=document.createElement("div");c.className="videoWrapper";
var f=document.createElement("div");f.className="videoSubWrapper";f.setAttribute("data-uname","suman"+a);c.appendChild(f);var d=document.createElement("video");d.className="userVideo";d.src="http://html5demos.com/assets/dizzy.mp4";f.appendChild(d);b.appendChild(c);250<=b.offsetHeight&&"undefined"!=b.style.overflowY&&"scroll"!=b.style.overflowY&&(b.style.overflowY="scroll",document.getElementById(vApp.gObj.chat.mainChatBoxId).style.borderTop="3px solid #bbb")}},200)},createVideoElement:function(){var a=
document.createElement("div");a.className="videoWrapper";var b=document.createElement("div");b.className="videoSubWrapper";a.appendChild(b);var c=document.createElement("video");c.id="video"+vApp.gObj.uid;c.autoplay=!0;b.appendChild(c);return a},imageReplaceWithVideo:function(a,b){var c=document.getElementById("ml"+a).getElementsByTagName("a")[0],f=c.getElementsByTagName("img")[0];c.replaceChild(b,f)},insertTempVideo:function(a){var b=document.createElement("canvas");b.id="tempVideo";a.parentNode.insertBefore(b,
a)},tempVideoInit:function(){cthis.video.tempVid=document.getElementById("tempVideo");cthis.video.tempVid.width=cthis.video.width;cthis.video.tempVid.height=cthis.video.height;cthis.video.tempVidCont=cthis.video.tempVid.getContext("2d")},process:function(a){var b=new Uint8ClampedArray(a);a=vApp.vutil.numValidateFour(b[1],b[2],b[3],b[4]);b=b.subarray(5,b.length);vApp.gObj.video.video.playWithoutSlice(a,b)}},init:function(a){cthis=this;vcan.oneExecuted=!0;cthis.video.init();vApp.adpt=new vApp.adapter;
vApp.adpt.init(navigator).getUserMedia({audio:!0,video:!0},this.handleUserMedia,this.handleUserMediaError);vApp.system.wbRtc.peerCon&&"undefined"==typeof localStorage.wbrtcMsg&&(vApp.wb.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=!0)},handleUserMedia:function(a){var b=document.getElementById("audioWidget");vApp.vutil.elemHasAnyClass("audioWidget")&&b.classList.contains("deactive")&&vApp.user.control.audioWidgetEnable();cthis.video.tempStream=a;cthis.audio.init();a=document.getElementById("ml"+
vApp.gObj.uid);null!=a&&null!=a.getElementsByTagName("video")&&cthis._handleUserMedia(vApp.gObj.uid)},addUserRole:function(a,b){var c=document.getElementById("ml"+a);c.setAttribute("data-role",b);c.classList.add("s"==b?"student":"teacher")},_handleUserMedia:function(a){document.getElementById(a);var b=cthis.video.tempStream;a=document.getElementById("ml"+vApp.gObj.uid);null!=a&&a.classList.add("mySelf");"undefined"!=typeof b&&(a=cthis.video.createVideoElement(),cthis.video.imageReplaceWithVideo(vApp.gObj.uid,
a),cthis.video.insertTempVideo(a),cthis.video.tempVideoInit(),cthis.video.myVideo=document.getElementById("video"+vApp.gObj.uid),vApp.adpt.attachMediaStream(cthis.video.myVideo,b),cthis.video.myVideo.muted=!0,b.ontimeupdate=function(){console.log("raja"+b.currentTime)},vApp.jId==vApp.gObj.uid&&(cthis.stream=cthis.video.tempStream,cthis.audio.manuPulateStream(),cthis.audio.graph.canvasForVideo()),cthis.video.myVideo.onloadedmetadata=function(){cthis.video.startToStream()});userMedia=!0},updateVidContHeight:function(){var a=
document.getElementById("vAppCont"),a=vcan.utility.getElementOffset(a),a=d.innerHeight-(a.y+75);document.getElementById("chat_div").style.maxHeight=a+"px"},close:function(){vApp.gObj.video.hasOwnProperty("smallVid")&&clearInterval(vApp.gObj.video.smallVid)},dispAllVideo:function(a){setTimeout(function(){var b=document.getElementById(a);if(null!=b)for(var b=b.getElementsByTagName("video"),c=0;c<b.length;c++)b[c].play()},1040)},existVideoContainer:function(a){for(var b=document.getElementsByClassName("userVideos"),
c=0;c<b.length;c++)if(b[c].id=="video"+a.id)return!0;return!1},handleUserMediaError:function(a){vApp.user.control.audioWidgetDisable();a.hasOwnProperty("name")?alert("media error:- "+vApp.lang.getString(a.name)):alert("media error:- "+vApp.lang.getString(a));vApp.wb.view.disappearBox("WebRtc");console.log("navigator.getUserMedia error: ",a)}}}})(window);(function(d){var a={requestPackets:function(a){1<a.length&&(vApp.wb.gObj.myArr=a);vApp.wb.sentReq=!0;return[vApp.wb.gObj.rcvdPackId,a[0].uid]},makeQueue:function(a){vApp.wb.gObj.rcvdPackId!=vApp.wb.gObj.displayedObjId&&(vApp.wb.gObj.packQueue=vApp.wb.gObj.packQueue.concat(a.message.repObj))},sendPackets:function(a,c){if(0==a.message.getMsPckt[0])var f=-1;else for(f=0;f<vApp.wb.gObj.myrepObj.length&&a.message.getMsPckt[0]!=vApp.wb.gObj.myrepObj[f].uid;f++);for(f+=1;f<a.message.getMsPckt[1];f++)c.push(vApp.wb.gObj.myrepObj[f]);
return c},handleMissedPackets:function(b,c,f){f=this.removeDupObjs(f);vApp.wb.gObj.replayObjs=vApp.wb.gObj.replayObjs.concat(f);a.sortingReplyObjs();b!=c&&vApp.storage.store(JSON.stringify(vApp.wb.gObj.replayObjs));this.containsIfQueuePacks(b,c,vApp.wb.gObj.displayedObjId,f)},removeDupObjs:function(a){0<vApp.wb.gObj.myArr.length&&(a[a.length-1].uid==vApp.wb.gObj.myArr[0].uid&&(vApp.wb.gObj.myArr[0].hasOwnProperty("cmd")||vApp.wb.gObj.myArr.shift()),a=a.concat(vApp.wb.gObj.myArr),vApp.wb.gObj.myArr=
[]);return a},containsIfQueuePacks:function(a,c,f,d){a!=c&&f+1!=d[0].uid&&0<vApp.wb.gObj.packQueue.length&&d[d.length-1].uid==vApp.wb.gObj.packQueue[0].uid&&(vApp.wb.gObj.packQueue=d.concat(vApp.wb.gObj.packQueue))},sortingReplyObjs:function(){vApp.wb.gObj.replayObjs=vApp.wb.gObj.replayObjs.sort(function(a,c){return a.uid-c.uid})}};d.bridge=a})(window);(function(d){vcan.optimize={sendPacketWithOptimization:function(a,b,c){"undefined"==typeof this.lastarrowtime&&(this.lastarrowtime=(new Date).getTime(),vApp.wb.sentPackets+=a.length,1==b&&vApp.wb.utility.beforeSend(JSON.parse(a)),vApp.wb.utility.updateSentInformation(a,!0));this.presentarrowtime=(new Date).getTime();this.presentarrowtime-this.lastarrowtime>=c&&(vApp.wb.sentPackets+=a.length,1==b&&io.send(JSON.parse(a)),vApp.wb.utility.updateSentInformation(a,!0),this.lastarrowtime=(new Date).getTime())},
doOptiMize:function(a){if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),a.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-vcan.main.offset.x,a.clientY-vcan.main.offset.y);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((new Date).getTime(),a.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-vcan.main.offset.x,
a.clientY-vcan.main.offset.y),vcan.optimize.calculatePackets(lastmousemovetime,"m",a.clientX-vcan.main.offset.x,a.clientY-vcan.main.offset.y),lastmousemovetime=(new Date).getTime())},calculatePackets:function(a,b,c,f){a=vcan.makeStackObj(a,b,c,f);vApp.wb.uid++;a.uid=vApp.wb.uid;vcan.main.replayObjs.push(a);vApp.wb.utility.beforeSend({repObj:[a]});vApp.storage.store(JSON.stringify(vcan.main.replayObjs));vApp.storage.wholeStore(a);vApp.wb.utility.updateSentPackets(a)}}})(window);(function(d){d.response={reclaimRole:function(a,b){a!=b&&(vApp.user.control._assign(b,"notsent",a),vApp.user.displayStudentSpeaker(!0),null!=localStorage.getItem("aId")&&localStorage.removeItem("aId"),vApp.user.control.removeAudioFromParticipate(a))},assignRole:function(a,b,c){if(a!=b||"undefined"!=typeof c)if(vApp.wb.utility.assignRole(b),vApp.wb.utility.uniqueArrOfObjsToTeacher(),null==localStorage.getItem("orginalTeacherId")){vApp.vutil.removeSessionTool();b=document.getElementById("ml"+a);c=["assign"];
var f=document.getElementById(a+"ControlContainer");null!=f?vApp.user.createAssignControl(f,a,!0):(c=vApp.user.createControl(a,c),b.appendChild(c));localStorage.setItem("aId",a)}else a=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=a&&vApp.user.control.removeCurrTeacherFromControl(a.id),vApp.user.control.changeAttrToAssign("enable");vApp.vutil.attachClickOutSideCanvas()},checkUser:function(a,b,c){"undefined"!=typeof vcan.teacher||c||vApp.wb.utility.makeCanvasDisable();
vApp.wb.utility.initDefaultInfo(a,wbUser.role);vApp.wb.utility.makeUserAvailable(a.message.checkUser.e.clientLen)},clearAll:function(a,b,c,f){a!=b&&(vApp.wb.tool=new vApp.wb.tool_obj("t_clearall"),vApp.wb.utility.t_clearallInit(),vApp.wb.utility.makeDefaultValue(),vApp.storage.clearStorageData());f&&vApp.wb.utility.updateRcvdInformation(c)},replayAll:function(){d.vApp.wb.vcan.main.replayObjs=vApp.wb.gObj.replayObjs;vApp.wb.utility.clearAll(!1);vApp.wb.toolInit("t_replay","fromFile")},createArrow:function(a,
b){var c=vApp.wb.arrImg,f={};f.mp={x:a.x,y:a.y};vApp.wb.utility.drawArrowImg(c,f);b&&vApp.wb.utility.updateRcvdInformation(a)},replayObj:function(a){d.vApp.wb.vcan.main.replayObjs=[];0<a.length&&vApp.wb.gObj.displayedObjId+1==a[0].uid&&(d.vApp.wb.vcan.main.replayObjs=a,vApp.wb.toolInit("t_replay","fromBrowser",!0,vApp.wb.utility.dispQueuePacket))},chunk:function(a,b,c){vApp.wb.bridge.handleMissedPackets(a,b,c)},repObjForMissedPkts:function(a){(0!=vApp.wb.gObj.rcvdPackId||0<vApp.wb.uid&&0==vApp.wb.gObj.rcvdPackId)&&
("object"==typeof a||a instanceof Array)&&a[0].hasOwnProperty("uid")&&vApp.wb.gObj.rcvdPackId+1!=a[0].uid&&!a.hasOwnProperty("chunk")&&Number(vApp.wb.gObj.rcvdPackId)<Number(a[0].uid)&&(a=vApp.wb.bridge.requestPackets(a),vApp.wb.utility.beforeSend({getMsPckt:a}))}}})(window);var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(d){if(null==d)return"";var a="",b,c,f,g,k,h,m=0;for(d=LZString.compress(d);m<2*d.length;)0==m%2?(b=d.charCodeAt(m/2)>>8,c=d.charCodeAt(m/2)&255,f=m/2+1<d.length?d.charCodeAt(m/2+1)>>8:NaN):(b=d.charCodeAt((m-1)/2)&255,(m+1)/2<d.length?(c=d.charCodeAt((m+1)/2)>>8,f=d.charCodeAt((m+1)/2)&255):c=f=NaN),m+=3,g=b>>2,b=(b&3)<<4|c>>4,k=(c&15)<<2|f>>6,h=f&63,isNaN(c)?
k=h=64:isNaN(f)&&(h=64),a=a+LZString._keyStr.charAt(g)+LZString._keyStr.charAt(b)+LZString._keyStr.charAt(k)+LZString._keyStr.charAt(h);return a},decompressFromBase64:function(d){if(null==d)return"";var a="",b=0,c,f,g,k,h,m,n=0,p=LZString._f;for(d=d.replace(/[^A-Za-z0-9\+\/\=]/g,"");n<d.length;)f=LZString._keyStr.indexOf(d.charAt(n++)),g=LZString._keyStr.indexOf(d.charAt(n++)),h=LZString._keyStr.indexOf(d.charAt(n++)),m=LZString._keyStr.indexOf(d.charAt(n++)),f=f<<2|g>>4,g=(g&15)<<4|h>>2,k=(h&3)<<
6|m,0==b%2?(c=f<<8,64!=h&&(a+=p(c|g)),64!=m&&(c=k<<8)):(a+=p(c|f),64!=h&&(c=g<<8),64!=m&&(a+=p(c|k))),b+=3;return LZString.decompress(a)},compressToUTF16:function(d){if(null==d)return"";var a="",b,c,f,g=0,k=LZString._f;d=LZString.compress(d);for(b=0;b<d.length;b++)switch(c=d.charCodeAt(b),g++){case 0:a+=k((c>>1)+32);f=(c&1)<<14;break;case 1:a+=k(f+(c>>2)+32);f=(c&3)<<13;break;case 2:a+=k(f+(c>>3)+32);f=(c&7)<<12;break;case 3:a+=k(f+(c>>4)+32);f=(c&15)<<11;break;case 4:a+=k(f+(c>>5)+32);f=(c&31)<<
10;break;case 5:a+=k(f+(c>>6)+32);f=(c&63)<<9;break;case 6:a+=k(f+(c>>7)+32);f=(c&127)<<8;break;case 7:a+=k(f+(c>>8)+32);f=(c&255)<<7;break;case 8:a+=k(f+(c>>9)+32);f=(c&511)<<6;break;case 9:a+=k(f+(c>>10)+32);f=(c&1023)<<5;break;case 10:a+=k(f+(c>>11)+32);f=(c&2047)<<4;break;case 11:a+=k(f+(c>>12)+32);f=(c&4095)<<3;break;case 12:a+=k(f+(c>>13)+32);f=(c&8191)<<2;break;case 13:a+=k(f+(c>>14)+32);f=(c&16383)<<1;break;case 14:a+=k(f+(c>>15)+32,(c&32767)+32),g=0}return a+k(f+32)},decompressFromUTF16:function(d){if(null==
d)return"";for(var a="",b,c,f=0,g=0,k=LZString._f;g<d.length;){c=d.charCodeAt(g)-32;switch(f++){case 0:b=c<<1;break;case 1:a+=k(b|c>>14);b=(c&16383)<<2;break;case 2:a+=k(b|c>>13);b=(c&8191)<<3;break;case 3:a+=k(b|c>>12);b=(c&4095)<<4;break;case 4:a+=k(b|c>>11);b=(c&2047)<<5;break;case 5:a+=k(b|c>>10);b=(c&1023)<<6;break;case 6:a+=k(b|c>>9);b=(c&511)<<7;break;case 7:a+=k(b|c>>8);b=(c&255)<<8;break;case 8:a+=k(b|c>>7);b=(c&127)<<9;break;case 9:a+=k(b|c>>6);b=(c&63)<<10;break;case 10:a+=k(b|c>>5);b=
(c&31)<<11;break;case 11:a+=k(b|c>>4);b=(c&15)<<12;break;case 12:a+=k(b|c>>3);b=(c&7)<<13;break;case 13:a+=k(b|c>>2);b=(c&3)<<14;break;case 14:a+=k(b|c>>1);b=(c&1)<<15;break;case 15:a+=k(b|c),f=0}g++}return LZString.decompress(a)},compress:function(d){if(null==d)return"";var a,b,c={},f={},g="",k="",h="",m=2,n=3,p=2,q="",r=0,u=0,s,v=LZString._f;for(s=0;s<d.length;s+=1)if(g=d.charAt(s),Object.prototype.hasOwnProperty.call(c,g)||(c[g]=n++,f[g]=!0),k=h+g,Object.prototype.hasOwnProperty.call(c,k))h=k;
else{if(Object.prototype.hasOwnProperty.call(f,h)){if(256>h.charCodeAt(0)){for(a=0;a<p;a++)r<<=1,15==u?(u=0,q+=v(r),r=0):u++;b=h.charCodeAt(0);for(a=0;8>a;a++)r=r<<1|b&1,15==u?(u=0,q+=v(r),r=0):u++,b>>=1}else{b=1;for(a=0;a<p;a++)r=r<<1|b,15==u?(u=0,q+=v(r),r=0):u++,b=0;b=h.charCodeAt(0);for(a=0;16>a;a++)r=r<<1|b&1,15==u?(u=0,q+=v(r),r=0):u++,b>>=1}m--;0==m&&(m=Math.pow(2,p),p++);delete f[h]}else for(b=c[h],a=0;a<p;a++)r=r<<1|b&1,15==u?(u=0,q+=v(r),r=0):u++,b>>=1;m--;0==m&&(m=Math.pow(2,p),p++);c[k]=
n++;h=String(g)}if(""!==h){if(Object.prototype.hasOwnProperty.call(f,h)){if(256>h.charCodeAt(0)){for(a=0;a<p;a++)r<<=1,15==u?(u=0,q+=v(r),r=0):u++;b=h.charCodeAt(0);for(a=0;8>a;a++)r=r<<1|b&1,15==u?(u=0,q+=v(r),r=0):u++,b>>=1}else{b=1;for(a=0;a<p;a++)r=r<<1|b,15==u?(u=0,q+=v(r),r=0):u++,b=0;b=h.charCodeAt(0);for(a=0;16>a;a++)r=r<<1|b&1,15==u?(u=0,q+=v(r),r=0):u++,b>>=1}m--;0==m&&(m=Math.pow(2,p),p++);delete f[h]}else for(b=c[h],a=0;a<p;a++)r=r<<1|b&1,15==u?(u=0,q+=v(r),r=0):u++,b>>=1;m--;0==m&&(Math.pow(2,
p),p++)}b=2;for(a=0;a<p;a++)r=r<<1|b&1,15==u?(u=0,q+=v(r),r=0):u++,b>>=1;for(;;)if(r<<=1,15==u){q+=v(r);break}else u++;return q},decompress:function(d){if(null==d)return"";if(""==d)return null;for(var a=[],b=4,c=4,f=3,g="",k="",h,m,n,p,q,r=LZString._f,u=d.charCodeAt(0),s=32768,v=1,k=0;3>k;k+=1)a[k]=k;g=0;n=Math.pow(2,2);for(p=1;p!=n;)m=u&s,s>>=1,0==s&&(s=32768,u=d.charCodeAt(v++)),g|=(0<m?1:0)*p,p<<=1;switch(g){case 0:g=0;n=Math.pow(2,8);for(p=1;p!=n;)m=u&s,s>>=1,0==s&&(s=32768,u=d.charCodeAt(v++)),
g|=(0<m?1:0)*p,p<<=1;q=r(g);break;case 1:g=0;n=Math.pow(2,16);for(p=1;p!=n;)m=u&s,s>>=1,0==s&&(s=32768,u=d.charCodeAt(v++)),g|=(0<m?1:0)*p,p<<=1;q=r(g);break;case 2:return""}for(h=k=a[3]=q;;){if(v>d.length)return"";g=0;n=Math.pow(2,f);for(p=1;p!=n;)m=u&s,s>>=1,0==s&&(s=32768,u=d.charCodeAt(v++)),g|=(0<m?1:0)*p,p<<=1;switch(q=g){case 0:g=0;n=Math.pow(2,8);for(p=1;p!=n;)m=u&s,s>>=1,0==s&&(s=32768,u=d.charCodeAt(v++)),g|=(0<m?1:0)*p,p<<=1;a[c++]=r(g);q=c-1;b--;break;case 1:g=0;n=Math.pow(2,16);for(p=
1;p!=n;)m=u&s,s>>=1,0==s&&(s=32768,u=d.charCodeAt(v++)),g|=(0<m?1:0)*p,p<<=1;a[c++]=r(g);q=c-1;b--;break;case 2:return k}0==b&&(b=Math.pow(2,f),f++);if(a[q])g=a[q];else if(q===c)g=h+h.charAt(0);else return null;k+=g;a[c++]=h+g.charAt(0);b--;h=g;0==b&&(b=Math.pow(2,f),f++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);(function(d){var a={BIAS:132,CLIP:32635,tables:{ulaw:{compress:[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-32124,-31100,-30076,-29052,-28028,-27004,-25980,-24956,-23932,-22908,-21884,-20860,-19836,-18812,-17788,-16764,-15996,-15484,-14972,-14460,-13948,-13436,-12924,-12412,-11900,-11388,-10876,-10364,-9852,-9340,-8828,-8316,-7932,-7676,-7420,-7164,-6908,-6652,-6396,-6140,-5884,-5628,-5372,-5116,-4860,-4604,-4348,-4092,-3900,-3772,-3644,-3516,-3388,-3260,-3132,-3004,-2876,-2748,-2620,-2492,-2364,-2236,-2108,-1980,-1884,
-1820,-1756,-1692,-1628,-1564,-1500,-1436,-1372,-1308,-1244,-1180,-1116,-1052,-988,-924,-876,-844,-812,-780,-748,-716,-684,-652,-620,-588,-556,-524,-492,-460,-428,-396,-372,-356,-340,-324,-308,-292,-276,-260,-244,-228,-212,-196,-180,-164,-148,-132,-120,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,32124,31100,30076,29052,28028,27004,25980,24956,23932,22908,21884,20860,19836,18812,17788,16764,15996,15484,14972,14460,13948,13436,12924,12412,11900,11388,10876,10364,9852,9340,8828,8316,7932,
7676,7420,7164,6908,6652,6396,6140,5884,5628,5372,5116,4860,4604,4348,4092,3900,3772,3644,3516,3388,3260,3132,3004,2876,2748,2620,2492,2364,2236,2108,1980,1884,1820,1756,1692,1628,1564,1500,1436,1372,1308,1244,1180,1116,1052,988,924,876,844,812,780,748,716,684,652,620,588,556,524,492,460,428,396,372,356,340,324,308,292,276,260,244,228,212,196,180,164,148,132,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,0]},alaw:{compress:[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,
-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,
7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,
624,592,944,912,1008,976,816,784,880,848]}},encode:function(b,c){c=c||{};b.constructor==Array&&(b.byteLength=2*b.length);for(var f=new ArrayBuffer(b.byteLength/2),f=new Int8Array(f),d=a[c.alaw?"alaw":"ulaw"],k=0;k<b.byteLength/2;k++)f[k]=d(b[k]);return f},decode:function(b,c){c=c||{};"undefined"==typeof b.byteLength&&(b.byteLength=b.length);for(var f=!!c.floating_point,d=new ArrayBuffer(b.byteLength*(f?4:2)),d=f?new Float32Array(d):new Int16Array(d),k=a[(c.alaw?"alaw":"ulaw")+"_dec"],h,m=0;m<b.byteLength;m++)h=
k(b[m]),d[m]=f?h/32768:h;return d},alaw:function(b){var c=new ArrayBuffer(2),f=new ArrayBuffer(1),c=new Int16Array(c),f=new Int8Array(f),d;d=~b>>8&128;128!=d&&(c[0]=-b,b=c[0]);b>a.CLIP&&(b=a.CLIP);256<=b?(c=a.tables.alaw.compress[b>>8&127],f[0]=c<<4|b>>c+3&15):f[0]=b>>4;f[0]=f[0]^d^85;return f[0]},alaw_dec:function(b){var c=new ArrayBuffer(2),c=new Int8Array(c);b=a.tables.alaw.decompress[b&255];c[0]=b;c[1]=b>>8;return(new Int16Array(c.buffer))[0]},ulaw:function(b){var c=new ArrayBuffer(2),f=new ArrayBuffer(1),
c=new Int16Array(c),f=new Int8Array(f),d;0>b?(c[0]=a.BIAS-b,b=c[0],c=127):(b+=a.BIAS,c=255);d=a.tables.ulaw.compress[b>>8&127];if(8<=d)return 127^c;f[0]=d<<4|b>>d+3&15;return f[0]^c},ulaw_dec:function(b){var c=new ArrayBuffer(2),c=new Int8Array(c);b=a.tables.ulaw.decompress[b&255];c[0]=b;c[1]=b>>8;return(new Int16Array(c.buffer))[0]},ulaw_dec_slow:function(b){var c=new ArrayBuffer(2),c=new Int16Array(c);c[0]=~b;b=c[0];t=((b&15)<<3)+a.BIAS;t<<=(b&112)>>4;b=128==(b&128);c=new ArrayBuffer(2);c=new Int16Array(c);
c[0]=b?a.BIAS-t:t-a.BIAS;return c[0]}};d.G711=a;d.version="0.0.1"})("undefined"!==typeof exports?module.exports:window);window.addEventListener("message",function(d){if(d.origin==window.location.origin)if("gotScreen"==d.data.type){var a;""===d.data.sourceId?(d=Error("NavigatorUserMediaError"),d.name="PERMISSION_DENIED",vApp.ss.onError(d)):(a=a||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d.data.sourceId,maxWidth:1440,maxHeight:9999},optional:[{maxFrameRate:3},{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},vApp.adpt=new vApp.adapter,navigator2=vApp.adpt.init(navigator),navigator2.getUserMedia(a,
function(a){vApp.ss._init();vApp.ss.initializeRecorder.call(vApp.ss,a)},function(a){vApp.ss.onError.call(vApp.ss,a)}))}else"getScreenPending"==d.data.type?window.clearTimeout(d.data.id):"yes"==d.data.type&&(vApp.gObj.ext=!0)});(function(d){d.dirtyCorner={decodeRGB:function(a,b,c){b=b.createImageData(c.width,c.height);for(c=0;c<4*a.length;c++)b.data[4*c+0]=36.5*(a[c]>>5),b.data[4*c+1]=36.5*((a[c]&28)>>2),b.data[4*c+2]=85*(a[c]&3),b.data[4*c+3]=255;return b},decodeRGBSlice:function(a,b,c){b=b.createImageData(c.w,c.h);for(c=0;c<4*a.length;c++)b.data[4*c+0]=36.5*(a[c]>>5),b.data[4*c+1]=36.5*((a[c]&28)>>2),b.data[4*c+2]=85*(a[c]&3),b.data[4*c+3]=255;return b},encodeRGB:function(a){for(var b=a.length/4,c=new Uint8ClampedArray(b),
f,d,k,h=0;h<b;h++)f=a[4*h+0],d=a[4*h+1],k=a[4*h+2],f=(Math.round(f/36.5)<<5)+(Math.round(d/36.5)<<2)+Math.round(k/85),c[h]=f;return c},str2ImageData:function(a,b){var c=context2.createImageData(b.w,b.h),f=new ArrayBuffer(a.length);c.data=new Uint8Array(f);for(f=0;f<strLen;f++)c.data[f]=a.charCodeAt(f);return c},doClearCanvas:function(){context2.clearRect(0,0,canvas2.width,canvas2.height)}}})(window);(function(d){d.vutil={createDOM:function(a,b,c){a=document.createElement(a);"undefined"!=typeof b&&(a.id=b);if("undefined"!=typeof c){b="";if(0<c.length)for(var f=0;f<c.length;f++)b+=c[f]+" ";a.className=b}return a},ab2str:function(a){return String.fromCharCode.apply(null,new Uint8ClampedArray(a))},str2ab:function(a){for(var b=new ArrayBuffer(a.length),b=new Uint8ClampedArray(b),c=0,f=a.length;c<f;c++)b[c]=a.charCodeAt(c);return b},sidebarHeightInit:function(){document.getElementById("widgetRightSide").style.height=
d.innerHeight+"px"},isSystemCompatible:function(){if(0<d.vApp.error.length)for(var a=0;a<d.vApp.error.length;a++){var b=d.vApp.error[a];b.hasOwnProperty("msg")&&vApp.wb.view.displayMessage(b.msg,b.id,b.className)}},chkValueInLocalStorage:function(a){return null===localStorage.getItem(a)?!1:localStorage[a]},setContainerWidth:function(a){var b="vAppWhiteboard";"undefined"!=typeof vApp.previous&&(b=vApp.previous);var c=document.getElementById(b);if("ScreenShare"==vApp.currApp){var f=document.getElementById("vAppOptionsCont");
if(null!=f){var d=vcan.utility.getElementOffset(f);leftSideBarWidth=f.offsetWidth+d.x}else leftSideBarWidth=0}else leftSideBarWidth=0;a.width-=5+leftSideBarWidth+0;c.style.width=a.width+"px";"vAppWhiteboard"!=b&&(f=document.getElementById(b+"Local"),a.width-=10,c.style.width=a.width,f.style.width=a.width+"px",vApp.vutil.setScreenInnerTagsWidth(b))},setScreenInnerTagsWidth:function(a){document.getElementById(a);document.getElementById(a+"Local");document.getElementById(a+"LocalVideo")},makeActiveApp:function(a,
b){if("undefined"!=typeof b){b+="Tool";var c=vApp.wb.utility.removeClassFromElement(b,"active");document.getElementById(b).className=c}document.getElementById(a+"Tool").className+=" active"},initInstallChromeExt:function(a){"EXTENSION_UNAVAILABLE"==a.name&&(console.log("ask for inline installation"),chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",function(a){d.location.reload()},function(a){alert(a)}))},removeAppPanel:function(){var a=document.getElementById("vAppOptionsCont");
null!=a&&a.parentNode.removeChild(a)},removeTempVideo:function(a){a=document.getElementById(a);a.parentNode.removeChild(a)},createLocalTempVideo:function(a,b){if("string"==typeof a||"String"==typeof a)a=document.getElementById(a);var c=vApp.vutil.createDOM("div",b),f=vApp.vutil.createDOM("canvas",b+"Video");c.appendChild(f);a.appendChild(c)},initLocCanvasCont:function(a){var b="ScreenShare"==vApp.currApp?"ss":"wss";vApp[b].localtempCanvas=document.getElementById(a);vApp[b].localtempCont=vApp[b].localtempCanvas.getContext("2d")},
videoTeacher2Student:function(a,b){var c=a,f=document.getElementById("vApp"+a+"LocalVideo");if(null!=f&&"VIDEO"==f.tagName){var d=document.createElement("canvas");d.id=f.id;d.width=f.offsetWidth;d.height=f.offsetHeight;f.parentNode.replaceChild(d,f);"ScreenShare"==c&&(c="ss");"undefined"!=typeof b||"undefined"==typeof c||"ss"!=c&&"wss"!=c||(vApp[c].localCanvas=d,vApp[c].localCont=vApp[c].localCanvas.getContext("2d"),f=vApp[c].localtempCont.getImageData(0,0,vApp[c].localtempCanvas.width,vApp[c].localtempCanvas.height),
vApp[c].localCont.putImageData(f,0,0));vApp.vutil.removeTempVideo("vApp"+a+"LocalTemp")}},clickOutSideCanvas:function(){this.exitTextWrapper()&&vApp.wb.obj.drawTextObj.textUtility(vApp.wb.gObj.spx,vApp.wb.gObj.spy)},exitTextWrapper:function(){return 0<document.getElementsByClassName("textBoxContainer").length?!0:!1},attachClickOutSideCanvas:function(){function a(a){a=document.getElementById(a);null!=a&&(a.onclick=function(){vApp.vutil.clickOutSideCanvas()})}a("commandToolsWrapper");a("vAppOptionsCont");
a("audioWidget");a("chatWidget")},dimensionMatch:function(a,b){var c=document.getElementById(a).offsetWidth,f=document.getElementById("vAppOptionsCont").offsetWidth;return document.getElementById(b).offsetWidth+f==c?!0:!1},disableAppsBar:function(){var a=document.getElementById("vAppOptionsCont");null!=a&&(a.style.pointerEvents="none")},isMiniFileIncluded:function(a){a=new RegExp(a+".js?=*([0-9]*)");for(var b=document.getElementsByTagName("script"),c=0;c<b.length;c++)if(a.test(b[c].src))return!0;
return!1},clearAllChat:function(){localStorage.removeItem(vApp.gObj.uid);sessionStorage.clear("chatroom");vApp.chat.idList.length=0;clearAllChatBox();var a=document.getElementById("chatWidget").getElementsByClassName("ui-chatbox-msg");if(0<a.length)for(;null!=a[0];)a[0].parentNode.removeChild(a[0])},isObjectEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},removeSessionTool:function(){if(null==localStorage.getItem("orginalTeacherId")){var a=document.getElementById("vAppSessionEndTool");
null!=a&&a.parentNode.removeChild(a)}},toggleRoleClass:function(a){if(null!=localStorage.getItem("teacherId")&&null==localStorage.getItem("orginalTeacherId")||a)document.getElementById("vAppCont").classList.toggle("teacher"),document.getElementById("vAppCont").classList.toggle("student")},addClass:function(a,b){var c=document.getElementById(a);vApp.vutil.elemHasAnyClass(a)?c.classList.add(b):c.className=b},removeClass:function(a,b){var c=document.getElementById(a);vApp.vutil.elemHasAnyClass(a)&&c.classList.contains(b)&&
c.classList.remove(b)},breakIntoBytes:function(a,b){for(var c=a.toString(),f=c.length;f<b;f++)c="0"+c;return c.match(/[\S]{1,2}/g)||[]},numValidateFour:function(a,b,c,f){a=this.preNumValidateTwo(a);b=this.preNumValidateTwo(b);c=this.preNumValidateTwo(c);f=this.preNumValidateTwo(f);return parseInt(a+b+c+f)},numValidateTwo:function(a,b){a=this.preNumValidateTwo(a);b=this.preNumValidateTwo(b);return parseInt(a+b)},preNumValidateTwo:function(a){a=a.toString();if(1==a.length)return"0"+a;if(2==a.length)return a},
elemHasAnyClass:function(a){a=document.getElementById(a);return null!=a?"undefined"!=typeof a.classList?!0:!1:!1},userIsOrginalTeacher:function(a){return null!=localStorage.getItem("orginalTeacherId")?!0:!1},isUserTeacher:function(a){return null!=localStorage.getItem("teacherId")?!0:!1}};d.onbeforeunload=function(){if("undefined"!=typeof vApp.storage.wholeStoreData){var a=JSON.parse(vApp.storage.wholeStoreData);a.beforeRefresh=!0;vApp.storage.wholeStore(a,"put")}localStorage.removeItem("otherRole");
vApp.wb.utility.userIds=[];vApp.gObj.video.audio.studentNotSpeak();vApp.vutil.clickOutSideCanvas();localStorage.setItem(wbUser.sid,JSON.stringify(vApp.chat.vmstorage));io.disconnect()}})(window);(function(d){d.studentScreen=function(){return{ssProcess:function(a,b,c,f){if(102==a[0]||202==a[0]){a=new Uint8ClampedArray(b);var d=vApp.vutil.numValidateTwo(a[1],a[2]),k=vApp.vutil.numValidateTwo(a[3],a[4]);b=a.subarray(5,a.length);this.initStudentScreen(b,{w:d,h:k},c,f)}else if(103==a[0]||203==a[0])for(a=new Uint8ClampedArray(b),b=7,d=0;d+7<=a.length;d=n+1){var h=vApp.vutil.numValidateTwo(a[d+1],a[d+2]),m=vApp.vutil.numValidateTwo(a[d+3],a[d+4]),k=parseInt(a[d+5]),d=parseInt(a[d+6]),n=b+k*d-1;
b=a.subarray(b,n+1);this.initStudentScreen(b,{x:h,y:m,w:d,h:k},c,f);b=n+7+1}else if(104==a[0]||204==a[0])a=new Uint8ClampedArray(b),k=vApp.vutil.numValidateTwo(a[1],a[2]),h=vApp.vutil.numValidateTwo(a[3],a[4]),m=vApp.vutil.numValidateTwo(a[5],a[6]),d=vApp.vutil.numValidateTwo(a[7],a[8]),b=a.subarray(9,a.length),this.initStudentScreen(b,{d:{w:k,h:h},vc:{w:m,h:d}},c,f)},initStudentScreen:function(a,b,c,f){vApp.vutil.addClass("audioWidget","fixed");app=c;"object"!=typeof vApp[app]?("undefined"!=typeof vtype&&
(vApp.recorder.recImgPlay=!0),vApp.makeAppReady(f)):(c=document.getElementById(vApp.previous),null!=c&&(c.style.display="none",document.getElementById(vApp[app].id).style.display="block"));if(b.hasOwnProperty("d"))vApp[app].dimensionStudentScreenResize(b),dim=!0,vApp[app].drawImages(a);else{if("undefined"==typeof dim||"undefined"!=typeof prvWidth&&prvWidth!=b.w&&!b.hasOwnProperty("x"))dim=!0,vApp[app].dimensionStudentScreen(b.w,b.h),prvWidth=b.w,prvHeight=b.h;b.hasOwnProperty("x")?vApp[app].drawImages(a,
b):(b.hasOwnProperty("w")&&(vApp[app].localCanvas.width=b.w,vApp[app].localCanvas.height=b.h),vApp[app].drawImages(a))}vApp.previous=vApp[app].id}}};d.screenShare=function(a){vApp.getSceenFirefox=function(){33<=parseInt(d.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)?(constraints={video:{mozMediaSource:"window",mediaSource:"window"}},vApp.adpt=new vApp.adapter,navigator2=vApp.adpt.init(navigator),navigator2.getUserMedia(constraints,function(a,c){vApp.ss._init();vApp.ss.initializeRecorder.call(vApp.ss,
a);if("undefined"==typeof c)var f=a.currentTime,g=d.setInterval(function(){a||d.clearInterval(g);if(a.currentTime==f&&(d.clearInterval(g),a.onended))a.onended();f=a.currentTime},500)},function(a){"string"==typeof a&&"PERMISSION_DENIED"===a&&d.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus()})):alert(vApp.lang.getString("notSupportBrowser"))};return{prevStream:!1,init:function(a){this.type=a.type;this.ssByClick=!0;this.manualStop=!1;"t"!=vApp.gObj.uRole||vApp.recorder.recImgPlay?
this._init():this.readyTostart(a.app)},_init:function(){vApp.previous!=a.id&&(document.getElementById(vApp.previous).style.display="none",vApp.previous=a.id);var b=document.getElementById(a.id);null!=b&&(b.style.display="block");if(!this.hasOwnProperty("id")){this.dc=vApp.dirtyCorner;this.postFix="Cont";this.id=a.hasOwnProperty("id")?a.id:"vAppScreenShare";this.className="vmApp";this.label="Local";this.local=this.id+this.label;this.localTemp=this.id+this.label+"Temp";this.classes=a.hasOwnProperty("class")?
a.classes:"";this.initPrevImage();b=document.getElementById(this.id);null!=b&&b.parentNode.removeChild(b);var b=this.html.UI.call(this,vApp.gObj.uRole),c=document.getElementById(vApp.rWidgetConfig.id);document.getElementById(vApp.html.id).insertBefore(b,c);"t"!=vApp.gObj.uRole||vApp.recorder.recImgPlay||vApp.vutil.initLocCanvasCont(this.localTemp+"Video")}},readyTostart:function(a){a==vApp.apps[1]&&this.getScreen()},onError:function(a){console.log("Error "+a)},getScreen:function(a){"Chrome"==vApp.system.mybrowser.name?
vApp.gObj.hasOwnProperty("ext")&&vApp.gObj.ext?d.postMessage({type:"getScreen",id:1},"*"):chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",function(){d.location.reload()}):"Firefox"==vApp.system.mybrowser.name&&vApp.getSceenFirefox()},unShareScreen:function(){this.video.src="";this.localtempCont.clearRect(0,0,this.localtempCanvas.width,this.localtempCanvas.height);clearInterval(vApp.clear);this.initPrevImage();this.hasOwnProperty("currentStream")&&
this.currentStream.stop();vApp.wb.utility.beforeSend({unshareScreen:!0,st:this.type})},removeStream:function(){vApp.vutil.removeClass("audioWidget","fixed");this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height)},initializeRecorder:function(a){vApp.vutil.addClass("audioWidget","fixed");changeonresize=1;resizecalled=0;this.prevStream&&(this.ssByClick=!1);"undefined"!=typeof vApp.prevScreen&&vApp.prevScreen.hasOwnProperty("currentStream")&&vApp.prevScreen.unShareScreen();this.video=
document.getElementById(this.local+"Video");if("VIDEO"!=this.video.tagName){var c=this.video,f=document.createElement("video");f.id=c.id;this.video.parentNode.replaceChild(f,this.video);this.video=document.getElementById(this.local+"Video");this.video.autoplay=!0;vApp.vutil.createLocalTempVideo("vAppScreenShare",this.local+"Temp");vApp.vutil.initLocCanvasCont(this.local+"TempVideo")}this.currentStream=a;var g=this;console.log("video changed");vApp.adpt.attachMediaStream(this.video,a);this.prevStream=
!0;this.currentStream.onended=function(a){g.ssByClick?(g.video.src="",g.localtempCont.clearRect(0,0,g.localtempCanvas.width,g.localtempCanvas.height),clearInterval(vApp.clear),g.initPrevImage(),vApp.wb.utility.beforeSend({unshareScreen:!0,st:g.type}),g.prevStream=!1,g.prevScreen="",vApp.prevScreen=""):g.ssByClick=!0};a={};a.width=d.innerWidth;a.height=d.innerHeight-140;var c=document.getElementById(this.local),k=this.html.getDimension(a);c.style.width=Math.round(k.width)+"px";c.style.height=Math.round(k.height)+
"px";g=this;this.video.onloadedmetadata=function(){g.width=k.width;g.height=k.height;g.localtempCanvas.width=g.video.offsetWidth;g.localtempCanvas.height=g.video.offsetHeight;vApp.prevScreen=g;var a=vApp.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});g.sharing();vApp.vutil.setContainerWidth(a);"t"==vApp.gObj.uRole&&vApp.vutil.makeActiveApp(g.id,vApp.prevApp);vApp.prevApp=g.id}},sharing:function(){function a(b,c){for(var f=b.toString(),d=f.length;d<c;d++)f="0"+f;return f.match(/[\S]{1,2}/g)||
[]}function c(){clearInterval(vApp.clear);if("undefined"!=typeof prvVWidth&&"undefined"!=typeof prvVHeight){if(prvVWidth!=n.video.offsetWidth||prvVHeight!=n.video.offsetHeight)changeonresize=1}else prvVWidth=n.video.offsetWidth,prvVHeight=n.video.offsetHeight;1==changeonresize?setTimeout(g,2E3):k(n.type)}function f(a){p=400>=a||"undefined"==typeof a?400:1E4<=a?a/2:a;4*q<p&&(p=4*q);400<p&&console.trace();q=p}function g(){console.log("RESIZE");prvVWidth=n.video.offsetWidth;prvVHeight=n.video.offsetHeight;
h=Math.round(n.localtempCanvas.height/12);m=Math.round(n.localtempCanvas.width/12);var g=n.type;n.localtempCanvas.width=n.video.offsetWidth;n.localtempCanvas.height=n.video.offsetHeight;n.localtempCont.drawImage(n.video,0,0,n.video.offsetWidth,n.video.offsetHeight);var k=n.localtempCont.getImageData(0,0,n.localtempCanvas.width,n.localtempCanvas.height),k=n.dc.encodeRGB(k.data),q=Math.round(n.localtempCanvas.width/m),v=Math.round(n.localtempCanvas.height/h),w=n.getContainerDimension();if("undefined"!=
typeof prvVWidth&&"undefined"!=typeof prvVHeight)var x=a(prvVWidth,4),z=a(prvVHeight,4),A=a(w.width,4);else x=a(n.video.offsetWidth,4),z=a(n.video.offsetHeight,4),A=a(w.width,4);w=a(w.height,4);g=new Uint8ClampedArray(["ss"==g?104:204,x[0],x[1],z[0],z[1],A[0],A[1],w[0],w[1]]);x=new Uint8ClampedArray(k.length+g.length);x.set(g);x.set(k,g.length);d.Worker&&sworker.postMessage({img:k,resize:1,resA:h,resB:m,dw:q,dh:v,offsetWidth:n.video.offsetWidth,offsetHeight:n.video.offsetHeight},[k.buffer]);io.sendBinary(x);
f(x.length/128);changeonresize=0;clearInterval(vApp.clear);vApp.clear=setInterval(c,p)}function k(a){n.localtempCanvas.width=n.video.offsetWidth;n.localtempCanvas.height=n.video.offsetHeight;n.localtempCont.drawImage(n.video,0,0,n.video.offsetWidth,n.video.offsetHeight);a=Math.round(n.localtempCanvas.width/m);var b=Math.round(n.localtempCanvas.height/h),g=n.localtempCont.getImageData(0,0,n.video.offsetWidth,n.video.offsetHeight);d.Worker&&(sworker.postMessage({img:g.data,resA:h,resB:m,dw:a,dh:b,offsetWidth:n.video.offsetWidth,
offsetHeight:n.video.offsetHeight,type:n.type},[g.data.buffer]),sworker.onmessage=function(a){if(1==a.data.needFullScreen){a=vApp.getDataFullScreen(n.type);io.sendBinary(a);var b=a.length/128}else null!=a.data.masterSlice&&(io.sendBinary(a.data.masterSlice),b=a.data.masterSlice.length/128);f(b)});clearInterval(vApp.clear);vApp.clear=setInterval(c,p)}var h=Math.round(this.localtempCanvas.height/12),m=Math.round(this.localtempCanvas.width/12),n=this;randomTime=Math.floor(10001*Math.random())+5E3;vApp.hasOwnProperty("wholeImage")&&
clearInterval(vApp.wholeImage);vApp.hasOwnProperty("clear")&&clearInterval(vApp.clear);var p=1E3,q=1E3;vApp.getDataFullScreen=function(c){n.localtempCanvas.width=n.video.offsetWidth;n.localtempCanvas.height=n.video.offsetHeight;n.localtempCont.drawImage(n.video,0,0,n.video.offsetWidth,n.video.offsetHeight);var f=n.localtempCont.getImageData(0,0,n.localtempCanvas.width,n.localtempCanvas.height),f=n.dc.encodeRGB(f.data),d=a(n.localtempCanvas.height,4),g=a(n.localtempCanvas.width,4);c=new Uint8ClampedArray(["ss"==
c?102:202,g[0],g[1],d[0],d[1]]);d=new Uint8ClampedArray(f.length+c.length);d.set(c);d.set(f,c.length);return d};clearInterval(vApp.clear);vApp.clear=setInterval(c,p)},getContainerDimension:function(){var a=document.getElementById(this.id+"Local");return{width:a.offsetWidth,height:a.offsetHeight}},drawImages:function(a,c){if("undefined"!=typeof c){var f=this.dc.decodeRGBSlice(a,this.localCont,c);this.localCont.putImageData(f,c.x,c.y)}else f=this.dc.decodeRGB(a,this.localCont,this.localCanvas),this.localCont.putImageData(f,
0,0)},drawSingleImage:function(a){a=this.dc.decodeRGB(a,this.localCont,this.localCanvas);this.localCont.putImageData(a,0,0)},dimensionStudentScreen:function(a,c){this.localCanvas=document.getElementById(vApp[app].local+"Video");this.localCont=vApp[app].localCanvas.getContext("2d");this.localCanvas.width=a;this.localCanvas.height=c;console.log("normal width "+this.localCanvas.width)},dimensionStudentScreenResize:function(a,c){this.hasOwnProperty("vac")||(this.vac=!0,this.localCanvas=document.getElementById(vApp[app].local+
"Video"),this.localCont=vApp[app].localCanvas.getContext("2d"));a.hasOwnProperty("d")&&(this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height),this.localCanvas.width=a.d.w,this.localCanvas.height=a.d.h);if(a.hasOwnProperty("vc")){var f=document.getElementById(vApp[app].local);f.style.width=a.vc.w+"px";f.style.height=a.vc.h+"px"}"vAppWhiteboard"!=vApp.previous&&vApp.vutil.setScreenInnerTagsWidth(vApp.previous)},html:{UI:function(a){var c=vApp.vutil.createDOM("div",this.id,[this.className]),
f=vApp.vutil.createDOM("div",this.local,[this.label]);if("t"==a){if(vApp.recorder.recImgPlay)var d=vApp.vutil.createDOM("canvas",this.local+"Video");else d=vApp.vutil.createDOM("video",this.local+"Video"),d.setAttribute("autoplay",!0);f.style.cssText+=";position:relative"}else d=vApp.vutil.createDOM("canvas",this.local+"Video");f.appendChild(d);c.appendChild(f);"t"!=a||vApp.recorder.recImgPlay||vApp.vutil.createLocalTempVideo(c,this.localTemp);return c},getDimension:function(a,c){return{height:a.height,
width:a.width}}},initPrevImage:function(){sworker.postMessage({initPrevImg:!0})}}}})(window);(function(d){d.recorder={items:[],recImgPlay:!1,init:function(a){function b(){f.objs=vApp.recorder.items;f.objNo=0;f.repMode=a;f.callBkfunc="";vApp.ss="";vApp.wss="";var b=document.getElementById("vApp"+vApp.apps[1]);null!=b&&b.parentNode.removeChild(b);setTimeout(function(){vApp.recorder.renderObj()},f.objs[0].mt-vApp.wb.pageEnteredTime)}var c=vApp.wb.vcan;"undefined"!=typeof myfunc?this.objs=c.getStates("replayObjs"):vApp.storage.getAllObjs(["allData"],b);var f=this;setTimeout(function(){"undefined"!=
typeof vApp.gObj.video&&vApp.gObj.video.audio.replayInit()},vApp.wb.recordStarted-vApp.wb.pageEnteredTime)},renderObj:function(a){vApp.wb.drawMode=!0;if("undefined"==typeof this.objs[this.objNo])console.log("is this happend");else{if(this.objs[this.objNo].hasOwnProperty("cmd"))vApp.wb.gObj.displayedObjId=this.objs[this.objNo].uid,vApp.wb.toolInit(this.objs[this.objNo].cmd,"fromFile",!0);else if(this.objs[this.objNo].hasOwnProperty("si"))vApp.studentScreen.initStudentScreen(this.objs[this.objNo],"recImgPlay");
else if(this.objs[this.objNo].hasOwnProperty("cuser"))vApp.gObj.chat.userChatList=[],vApp.gObj.chat.display(this.objs[this.objNo].cuser,"cevent");else{vApp.previous!="vApp"+vApp.apps[0]&&(document.getElementById("vApp"+vApp.apps[0]).style.display="block",document.getElementById(vApp.previous).style.display="none",vApp.previous="vApp"+vApp.apps[0]);a="";"d"==this.objs[this.objNo].ac?a="mousedown":"m"==this.objs[this.objNo].ac?a="mousemove":"u"==this.objs[this.objNo].ac&&(a="mouseup");var b=this.objs[this.objNo],
b=b.hasOwnProperty("mtext")?{detail:{cevent:{x:b.x,y:b.y,mtext:b.mtext}}}:{detail:{cevent:{x:b.x,y:b.y}}};this.objs[this.objNo].hasOwnProperty("uid")&&(alert("suman bogati"),vApp.wb.gObj.displayedObjId=this.objs[this.objNo].uid,a=new CustomEvent(a,b),vcan.main.canvas.dispatchEvent(a))}if("object"==typeof this.objs[this.objNo+1]){"undefined"!=typeof this.repMode&&"fromBrowser"==this.repMode?vApp.wb.replayTime=0:this.objs[this.objNo].hasOwnProperty("beforeRefresh")?vApp.wb.replayTime=this.objs[this.objNo+
1].mt-this.objs[this.objNo+1].peTime+1E3:vApp.wb.replayTime=this.objs[this.objNo+1].mt-this.objs[this.objNo].mt;this.objNo++;var c=this;setTimeout(function(){c.renderObj.call(c)},vApp.wb.replayTime)}}}}})(window);(function(d){var a=[],b;d.storage={init:function(){this.reclaim=JSON.parse(vApp.vutil.chkValueInLocalStorage("reclaim"));b=this;this.tables=["wbData","allData","audioData","config"];var a=d.indexedDB.open("vidya_app",3);a.onerror=function(a){console.log("Error opening db");console.dir(a)};a.onupgradeneeded=function(a){a=a.target.result;a.objectStoreNames.contains("wbData")||a.createObjectStore("wbData",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("audioData")||a.createObjectStore("audioData",
{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("allData")||a.createObjectStore("allData",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("config")||a.createObjectStore("config",{keyPath:"timeStamp",autoIncrement:!0})};a.onsuccess=function(a){b.db=a.target.result;(new Date).getTime();vApp.gObj.sessionClear?b.config.endSession(!0):b.getAllObjs(b.tables,function(a){if("undefined"==typeof a)b.config.createNewSession();else{var c=a.createdDate;(10368E6<(new Date).getTime()-
c||a.room!=wbUser.room)&&b.config.endSession()}});b.db.onerror=function(a){console.dir(a.target)}}},store:function(a){var f=b.db.transaction(["wbData"],"readwrite");f.objectStore("wbData").clear();f.objectStore("wbData").add({repObjs:a,timeStamp:(new Date).getTime(),id:1});return!1},audioStore:function(a){b.db.transaction(["audioData"],"readwrite").objectStore("audioData").add({audiostream:a,timeStamp:(new Date).getTime(),id:2});return!1},wholeStore_working:function(a,f){var g=[],k=(new Date).getTime();
"object"!=typeof a||a instanceof Array?g=a:g.push(a);for(var h=0;h<g.length;h++){a=g[h];k=a.mt;a.peTime=d.pageEnter;var m=JSON.stringify(a);"undefined"!=typeof this.prevTime&&k==this.prevTime&&(k+=1);var n=b.db.transaction(["allData"],"readwrite");"undefined"==typeof f?n.objectStore("allData").add({recObjs:m,timeStamp:k,id:3}):n.objectStore("allData").put({recObjs:m,timeStamp:this.prevTime,id:3});this.wholeStoreData=m;this.prevTime=k}},wholeStore:function(a,f){a.peTime=d.pageEnter;var g=JSON.stringify(a),
k=(new Date).getTime();"undefined"!=typeof this.prevTime&&k==this.prevTime&&(k+=1);var h=b.db.transaction(["allData"],"readwrite");"undefined"==typeof f?h.objectStore("allData").add({recObjs:g,timeStamp:k,id:3}):h.objectStore("allData").put({recObjs:g,timeStamp:this.prevTime,id:3});this.wholeStoreData=g;this.prevTime=k},displayData:function(){b.db.transaction(["vapp"],"readonly").objectStore("vapp").openCursor().onsuccess=b.handleResult},getAllObjs:function(a,f){for(var d="undefined"!=typeof f?f:
"",k=0;k<a.length;k++)b.db.transaction(a[k],"readonly").objectStore(a[k]).openCursor().onsuccess=function(f,d){return function(g){"function"==typeof d?b[a[f]].handleResult(g,d):b[a[f]].handleResult(g)}}(k,d)},wbData:{handleResult:function(a,b){var d=a.target.result;d?(d.value.hasOwnProperty("repObjs")&&(vApp.wb.utility.replayFromLocalStroage(JSON.parse(d.value.repObjs)),storeFirstObj=!0),d["continue"]()):"undefined"==typeof storeFirstObj&&vApp.wb.utility.makeUserAvailable()}},audioData:{handleResult:function(b,
f){var d=b.target.result;d?(d.value.hasOwnProperty("audiostream")&&a.push(JSON.parse(d.value.audiostream)),d["continue"]()):1<a.length&&(vApp.gObj.video.audio.recordingLength=0,"function"==typeof f?vApp.gObj.video.audio.assignFromLocal(a,f):vApp.gObj.video.audio.assignFromLocal(a))}},allData:{handleResult:function(a,b){var d=a.target.result;d?(d.value.hasOwnProperty("recObjs")&&vApp.recorder.items.push(JSON.parse(d.value.recObjs)),d["continue"]()):"function"==typeof b&&b()}},config:{handleResult:function(a,
b){var d=a.target.result;if(d){if(d.value.hasOwnProperty("myconfig")){var k=JSON.parse(d.value.myconfig);"undefined"!=typeof b&&(mc=!0,b(k))}d["continue"]()}else"undefined"!=typeof b&&"undefined"==typeof mc&&b()},createNewSession:function(){var a=(new Date).getTime(),f=b.db.transaction(["config"],"readwrite").objectStore("config"),a=JSON.stringify({createdDate:a,room:wbUser.room});f.add({myconfig:a,timeStamp:(new Date).getTime()})},endSession:function(a){a||(vApp.wb.utility.t_clearallInit(),vApp.wb.utility.makeDefaultValue(),
vApp.vutil.clearAllChat());vApp.vutil.removeClass("audioWidget","fixed");vApp.storage.clearStorageData();b.config.createNewSession()}},shapesData:{handleResult:function(){vApp.recorder.items.push(JSON.parse(cursor.value.recObjs))}},clearStorageData:function(){for(var a=0;a<this.tables.length;a++){var b=this.db.transaction([this.tables[a]],"readwrite");"undefined"!=typeof b&&b.objectStore(this.tables[a]).clear()}},handleResultNoUsing:function(){var a=event.target.result;if(a){if(a.value.hasOwnProperty("repObjs")){var b=
JSON.parse(a.value.repObjs);vApp.wb.utility.replayFromLocalStroage(b)}else a.value.hasOwnProperty("audiostream")?(b=JSON.parse(a.value.audiostream),vApp.gObj.video.audio.assignFromLocal(b)):a.value.hasOwnProperty("recObjs")&&vApp.recorder.items.push(JSON.parse(a.value.recObjs));a["continue"]()}}}})(window);(function(d,a){d.user=function(b){return{assignRole:function(b,f){"t"==b&&(vApp.html.optionsWithWrapper(),vApp.attachFunction(),a.getElementById("vAppOptionsCont"),d.vApp.wb.attachToolFunction(vcan.cmdWrapperDiv,!0),"Whiteboard"==f&&"t"==vApp.gObj.uRole&&(vApp.hasOwnProperty("prevApp")?vApp.vutil.makeActiveApp("vApp"+f,vApp.prevApp):vApp.vutil.makeActiveApp("vApp"+f),vApp.wb.utility.makeCanvasEnable()))},teacherIsAlreadyExist:function(){for(var b=a.getElementById("chat_div").getElementsByClassName("ui-memblist-usr"),
f,d=0;d<b.length;d++)if(f=b[d].getAttribute("data-role"),"t"==f)return!0;return!1},createControl:function(b,f){var d=a.createElement("div");d.id=b+"ControlContainer";d.className="controls";this.createControlDivs(d,b,f);return d},createAssignControl:function(b,f,d,k){var h=this,m=a.createElement("span");m.id=f+"contrAssignImg";var n=a.createElement("a");n.id=f+"contrAssignAnch";n.className="tooltip";n.appendChild(m);var p=a.createElement("div");p.id=f+"contrAssignCont";p.className="controleCont";p.appendChild(n);
n=a.getElementById(f+"ControlContainer");null!=n?0>=n.getElementsByClassName("controleCont").length?n.appendChild(p):n.insertBefore(p,n.firstChild):b.appendChild(p);vApp.user.control.changeAttribute(f,m,d,"assign","aRole");"undefined"!=typeof k&&(m.className+=" currTeacher");m.addEventListener("click",function(){h.control.init.call(h,m)})},createControlDivs:function(b,f,d){var k=this,h=!1,m=localStorage.getItem("vApp"+f);if(null!=m&&(h=!0,m=JSON.parse(m),m.hasOwnProperty("currTeacher")))if(vApp.gObj[f+
"currTeacher"]={},!0==m.currTeacher){var n=vApp.user.control.currTeacherAlready=!0;vApp.gObj[f+"currTeacher"].ct=!0}else vApp.gObj[f+"currTeacher"].ct=!1;var p=localStorage.getItem("reclaim"),p=null!=p&&p?!1:!0,q=vApp.vutil.userIsOrginalTeacher(f);vApp.vutil.isUserTeacher(f);for(var r=0;r<d.length;r++)if("assign"==d[r]&&q)"undefined"!=typeof n?this.createAssignControl(b,f,p,n):this.createAssignControl(b,f,p);else if("audio"==d[r]){var u=a.createElement("span");imgName="contrAud";u.id=f+imgName+"Img";
var s=a.createElement("a");s.id=f+imgName+"Anch";s.className="tooltip";s.appendChild(u);var v=a.createElement("div");v.id=f+imgName+"Cont";v.className="controleCont";v.appendChild(s);b.appendChild(v);v=h&&m.hasOwnProperty("aud")?m.aud?!0:!1:!0;vApp.user.control.changeAttribute(f,u,v,"audio","aud");q&&u.addEventListener("click",function(){k.control.init.call(k,u)})}else if("chat"==d[r]){var w=a.createElement("span");imgName="contrChat";w.id=f+imgName+"Img";s=a.createElement("a");s.id=f+imgName+"Anch";
s.className="tooltip";s.appendChild(w);v=a.createElement("div");v.id=f+imgName+"Cont";v.className="controleCont";v.appendChild(s);b.appendChild(v);q&&w.addEventListener("click",function(){k.control.init.call(k,w)});v=h&&m.hasOwnProperty("ch")?m.ch?!0:!1:!0;vApp.user.control.changeAttribute(f,w,v,"chat","ch")}},control:{addCurrTeacherToControl:function(b){var f=a.getElementById(b);null!=f&&(vApp.vutil.elemHasAnyClass(b)?f.classList.add("currTeacher"):f.className="currTeacher")},removeCurrTeacherFromControl:function(b){var f=
a.getElementById(b);vApp.vutil.elemHasAnyClass(b)&&(f.classList.remove("currTeacher"),f=b.indexOf("contr"),b=b.substring(0,f),vApp.user.control.updateUser(b,"currTeacher",!1))},removeAudioFromParticipate:function(b){b=a.getElementById(b+"contrAssignCont");null!=b&&b.parentNode.removeChild(b)},disable:function(b,f,d,k){d=a.getElementById(b+"contr"+d+"Img");vApp.user.control._disable(d,f,b,k)},_disable:function(a,b,d,k){a.parentNode.setAttribute("data-title",vApp.lang.getString(b+"Disable"));a.setAttribute("data-"+
b+"-disable","true");a.className="audio"==b?"icon-"+b+"DisImg block "+b+"DisImg":"icon-"+b+"Img block "+b+"Img";"assign"==b&&(a.parentNode.classList.remove("tooltip"),this.addCurrTeacherToControl(a.id),a=localStorage.getItem("vApp"+d),a=JSON.parse(a),vApp.gObj.hasOwnProperty(d+"currTeacher")?(vApp.gObj[d+"currTeacher"].ct||vApp.gObj.hasOwnProperty("controlAssign")&&vApp.gObj.controlAssign&&a.currTeacher)&&vApp.user.control.updateUser(d,"currTeacher",!0):vApp.gObj.hasOwnProperty("controlAssign")&&
vApp.gObj.controlAssignId==d&&vApp.user.control.updateUser(d,"currTeacher",!0));vApp.user.control.updateUser(d,k,!1)},enable:function(b,f,d,k){d=a.getElementById(b+"contr"+d+"Img");vApp.user.control._enable(d,f,b,k)},_enable:function(a,b,d,k){a.parentNode.setAttribute("data-title",vApp.lang.getString(b+"Enable"));"audio"==b&&a.parentNode.setAttribute("data-title",vApp.lang.getString(b+"Disable"));a.setAttribute("data-"+b+"-disable","false");a.className="icon-"+b+"Img enable "+b+"Img";vApp.user.control.updateUser(d,
k,!0)},changeAttribute:function(a,b,d,k,h){d?vApp.user.control._enable(b,k,a,h):vApp.user.control._disable(b,k,a,h)},init:function(a){var b=a.id,d=b.indexOf("contr"),d=b.substring(0,d),b=b.split("contr")[1],k=b.indexOf("Img"),b=b.substring(0,k);"Assign"==b?(vApp.gObj.controlAssign=!0,vApp.gObj.controlAssignId=d,b="true"==a.getAttribute("data-assign-disable")?!0:!1,b||(this.control.changeAttribute(d,a,b,"assign","aRole"),vApp.user.control._assign(d),vApp.user.control.changeAttrToAssign("block")),null==
localStorage.getItem("orginalTeacherId")&&vApp.user.control.removeAudioFromParticipate(d)):"Chat"==b?("true"==a.getAttribute("data-chat-disable")?(a.className="contrChatBlock",b="enable",this.control.changeAttribute(d,a,!0,"chat","ch")):(b="block",this.control.changeAttribute(d,a,!1,"chat","ch")),this.control._chat(d,b)):"Aud"==b&&("true"==a.getAttribute("data-audio-disable")?(b="enable",this.control.changeAttribute(d,a,!0,"audio","aud")):(b="block",this.control.changeAttribute(d,a,!1,"audio","aud")),
this.control._audio(d,b))},_assign:function(b,d,g){vApp.wb.utility.assignRole();vApp.vutil.removeAppPanel();if(!vApp.vutil.chkValueInLocalStorage("orginalTeacherId")){var k=a.getElementById("vcanvas");k.className=k.className.replace(/\bteacher\b/," ");k.className="student"}localStorage.setItem("canvasDrwMsg",!0);k=a.getElementById("vAppScreenShareLocalVideo");null!=k&&"VIDEO"==k.tagName&&vApp.vutil.videoTeacher2Student("ScreenShare",!0);var h;"ScreenShare"==vApp.currApp&&(h="ss");"Whiteboard"!=vApp.currApp&&
(vApp[h].hasOwnProperty("currentStream")&&vApp[h].currentStream.stop(),vApp[h]="");"undefined"==typeof d&&vApp.wb.utility.beforeSend({assignRole:!0,toUser:b});null==localStorage.getItem("orginalTeacherId")&&("undefined"==typeof g&&(g=b),b=a.getElementById(g+"ControlContainer").getElementsByClassName("controleCont")[0],b.removeChild(b.firstChild))},_chat:function(a,b){"enable"==b?vApp.wb.utility.beforeSend({enc:!0,toUser:a}):(vApp.user.control.updateUser(a,"ch",!1),vApp.wb.utility.beforeSend({dic:!0,
toUser:a}))},_audio:function(a,b){"enable"==b?vApp.wb.utility.beforeSend({ena:!0,toUser:a}):vApp.wb.utility.beforeSend({dia:!0,toUser:a})},audioWidgetEnable:function(){localStorage.setItem("audEnable","true");var b=a.getElementById("audioWidget");b.className="active";b.style.opacity="1";b.style.pointerEvents="visible"},audioWidgetDisable:function(){localStorage.setItem("audEnable","false");var b=a.getElementById("audioWidget");b.style.opacity="0.5";b.style.pointerEvents="none";b.className="deactive";
b=a.getElementById("speakerPressing");vApp.gObj.video.audio.studentNotSpeak(b);vApp.gObj.video.audio.clickOnceSpeaker("speakerPressOnce","alwaysDisable")},allChatDisable:function(){localStorage.setItem("chatEnable","false");this.disableCommonChat();this.disbaleAllChatBox();this.disableOnLineUser()},disableCommonChat:function(){var b=a.getElementById("chatrm");null!=b&&this.makeElemDisable(b)},disbaleAllChatBox:function(){for(var b=a.getElementById("stickybar").getElementsByClassName("ui-chatbox"),
d=0;d<b.length;d++)this.makeElemDisable(b[d])},disableOnLineUser:function(){for(var b=a.getElementsByClassName("ui-memblist-usr"),d=0;d<b.length;d++)b[d].style.pointerEvents="none"},makeElemDisable:function(a){vApp.vutil.elemHasAnyClass(a.id)?(a.classList.remove("enable"),a.classList.add("disable")):a.className="disable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!0)},allChatEnable:function(){localStorage.setItem("chatEnable","true");var b=a.getElementById("chatrm");
null!=b&&this.makeElemEnable(b);for(var d=a.getElementById("stickybar").getElementsByClassName("ui-chatbox"),b=0;b<d.length;b++)this.makeElemEnable(d[b]);d=a.getElementsByClassName("ui-memblist-usr");for(b=0;b<d.length;b++)d[b].style.pointerEvents="visible"},makeElemEnable:function(a){vApp.vutil.elemHasAnyClass(a.id)?(a.classList.remove("disable"),a.classList.add("enable")):a.className="enable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!1)},updateUser:function(a,b,
d){var k=localStorage.getItem("vApp"+a),h={};null==k?h.id=a:h=JSON.parse(k);h[b]=d;localStorage["vApp"+h.id]=JSON.stringify(h);return h},audioSign2:function(b,f){if("create"==f){if(null==a.getElementById(b.id+"AudEnableSign")){var g=a.createElement("div");g.id=b.id+"AudEnableSign";var k=a.createElement("img");imgName="audioenable";k.id=b.id+imgName+"Img";k.src=d.whiteboardPath+"images/"+imgName+".png";var h=a.createElement("a");h.id=b.id+imgName+"Anch";h.className="audEnableSign tooltip controleCont";
h.setAttribute("data-title","student audio enable");h.appendChild(k);g.appendChild(h);a.getElementById(b.id+"ControlContainer").appendChild(g)}}else g=a.getElementById(b.id+"AudEnableSign"),g.parentNode.removeChild(g)},audioSign:function(a,b){"create"==b?this.iconAttrManupulate(a.id,"icon-audioEnaGreen"):a.aud?this.iconAttrManupulate(a.id,"icon-audioImg"):this.iconAttrManupulate(a.id,"icon-audioDisImg")},iconAttrManupulate:function(b,d){var g=a.getElementById(b+"contrAudImg");if(null!=g)for(var k=
0;k<g.classList.length;k++)if("icon-"==g.classList[k].substring(0,5)){g.classList.remove(g.classList[k]);g.classList.add(d);break}},shouldApply:function(a){var b=localStorage.getItem("vApp"+a);null!=b&&(b=JSON.parse(b),console.log("uid "+a+" "+b.ad),b.ad&&vApp.user.control.audioSign({id:a},"create"))},changeAttrToAssign:function(b){for(var d=a.getElementById("chatWidget").getElementsByClassName("assignImg"),g=0;g<d.length;g++)"enable"==b?(d[g].classList.remove("block"),d[g].classList.add("enable"),
d[g].parentNode.classList.add("tooltip"),d[g].parentNode.setAttribute("data-title",vApp.lang.getString("assignEnable")),d[g].setAttribute("data-assign-disable","false")):(d[g].classList.remove("enable"),d[g].classList.add("block"),d[g].parentNode.classList.remove("tooltip"),d[g].setAttribute("data-assign-disable","true"))}},displayStudentSpeaker:function(b){var d=a.getElementById("alwaysPress");null!=d&&(d.style.display=b?"block":"none")}}}})(window,document);(function(d,a){d.Chat=function(){return{init:function(){this.chatroombox=null;this.counter=0;this.idList=[];a.htab=[];a.htabIndex=[];this.vmstorage={};a("body").footerbar();"false"==localStorage.getItem("init")&&(a("#stickybar").removeClass("maximize").addClass("minimize"),a("#hide_bar input").removeClass("close").addClass("expand"));tabs=a("#tabs").tabs({cache:!0,activeOnAdd:!0});!1==browserSupportsLocalStorage()?alert(lang.sterror):(this.history(),this.UI.privateChatBox.init(),a("ul.tabs").on("click, focus",
"li",function(){a("li[aria-controls='"+a(this).attr("id")+"']").removeClass("ui-state-highlight")}))},history:function(){var a=null;null!=localStorage.getItem(wbUser.sid)&&(displayPvtChatHistory(),a=localStorage.getItem("chatEnable"),null!=a&&"false"==a&&vApp.user.control.disbaleAllChatBox(),this.vmstorage=JSON.parse(localStorage.getItem(wbUser.sid)));0<sessionStorage.length&&(displaycomChatHistory(),null!=a&&"false"==a&&vApp.user.control.disableCommonChat())},UI:{privateChatBox:{init:function(){a("#tabs").delegate("span.ui-icon-close",
"click",this.close);a("#tabs").on("click","li a",this.toggle)},close:function(){var b=a(this).closest("li").attr("id").substring(5);a("#"+b).chatbox("option").boxClosed(b);a("div#cb"+b+".ui-widget").hide();var c=a(this).closest("li").remove().attr("aria-controls");a("#"+c).remove();delete vApp.chat.vmstorage[b]},toggle:function(){var b=a(this).closest("li").attr("id").substring(5);a("#"+b).chatbox("toggleContentbox");"hidden"==localStorage.getItem(b)?localStorage.removeItem(b):localStorage.setItem(b,
"hidden")}}},removedPrvLoggedInDetail:function(){a(".ui-memblist").remove();a(".ui-chatbox").remove();a("div#chatrm").remove();vApp.chat.chatroombox=null;for(key in io.uniquesids)key!=io.cfg.userid&&(chatboxManager.delBox(key),a("li#tabcb"+key).remove());this.idList=0;a("#stickybar").removeClass("maximize").addClass("minimize");tabs.tabs("refresh")},removeCookieUserInfo:function(){document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="auth_pass=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";
document.cookie="path=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";display_error(e.message)},makeUserListEmpty:function(){a("#user_list .inner_bt #usertab_icon").css({background:"url("+d.whiteboardPath+"images/offline.png)no-repeat top left"});a("#user_list .inner_bt #usertab_text").html("<span id='onlineusertext'>"+lang.whos+" (0) s</span> <span id='usertab_toogle_icon' class='icon-arrow-up'>d</span>");a("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+" (0)");a("div#memlist").css("display",
"none")}}}})(window,$);(function(d){d.widget("ui.footerbar",{options:{id:null,offset:0,width:"100%",barscroll:d(window).width()-430,boxClosed:function(a){}},init:function(a){this.elem=a},widget:function(){return this.uiFooterbar},_create:function(){var a=(this.uiFooterbar=d("<div></div>")).appendTo(document.getElementById("stickycontainer")).prop("id","stickybar").addClass("maximize"),b=(this.uiFooterbarchatroomtab=d("<div></div>")).addClass("vmchat_room_bt tooltip").attr("data-title",vApp.lang.getString("maxCommonChat")).prop("id",
"chatroom_bt2").appendTo(a),c=(this.uiFooterbarchatroomContent=d('<div class = "inner_bt"></div>')).appendTo(b);uiFooterbarchatroomIcon=(this.uiFooterbarchatroomIcon=d('<div id = "chatroom_icon"><span class="icon-chatroom"></span></div>')).appendTo(c);uiFooterbarchatroomText=(this.uiFooterbarchatroomText=d('<div id = "chatroom_text"></div>')).appendTo(c).html('Chatroom <span id="cc_arrow_button" class="icon-arrow-up"></span>').click(function(){if(vApp.chat.chatroombox){"hidden"==sessionStorage.getItem("chatroom_status")?
(sessionStorage.removeItem("chatroom_status"),b.attr("data-title",vApp.lang.getString("minCommonChat"))):(sessionStorage.setItem("chatroom_status","hidden"),b.attr("data-title",vApp.lang.getString("maxCommonChat")));var a=document.getElementById("cc_arrow_button");null!=a&&(vApp.vutil.elemHasAnyClass("cc_arrow_button")?a.classList.contains("icon-arrow-up")?(a.classList.add("icon-arrow-down"),a.classList.remove("icon-arrow-up")):(a.classList.add("icon-arrow-up"),a.classList.remove("icon-arrow-down")):
a.className="icon-arrow-up");vApp.chat.chatroombox.chatroom("option","boxManager").toggleBox()}else 0==d("div#chat_room").length&&(a=document.createElement("div"),a.id="chat_room",document.body.appendChild(a),vApp.chat.chatroombox=d("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,offset:"20px",messageSent:function(a,b){d("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}}),vApp.gObj.hasOwnProperty("chatEnable")&&!vApp.gObj.chatEnable&&(a=document.getElementById("chatrm"),
null!=a&&vApp.user.control.makeElemDisable(a)),a=document.getElementById("cc_arrow_button"),a.classList.add("icon-arrow-down"),a.classList.remove("icon-arrow-up"))});uiFooterbarUserlisttab=(this.uiFooterbarUserlisttab=d("<div></div>")).addClass("vmchat_bar_button").prop("id","user_list").appendTo(a);uiFooterbarUserlistContent=(this.uiFooterbarUserlistContent=d('<div class="inner_bt"></div>')).appendTo(uiFooterbarUserlisttab);uiFooterbarUserlistIcon=(this.uiFooterbarUserlistIcon=d('<div id="usertab_icon"></div>')).appendTo(uiFooterbarUserlistContent);
uiFooterbarUserlistText=(this.uiFooterbarUserlistText=d('<div id="usertab_text" class="tooltip close " data-title="'+vApp.lang.getString("maxUserList")+'"></div>')).appendTo(uiFooterbarUserlistContent).text("Private Chat").click(function(){vApp.gObj.video.dispAllVideo("chat_div");0<Object.keys(io.uniquesids).length&&(d(this).hasClass("close")?(d(this).addClass("open"),d(this).removeClass("close"),d("#usertab_toogle_icon").addClass("icon-arrow-down"),d("#usertab_toogle_icon").removeClass("close icon-arrow-up"),
d(this).attr("data-title",vApp.lang.getString("miniUserList"))):(d(this).addClass("close"),d(this).removeClass("open"),d("#usertab_toogle_icon").addClass("icon-arrow-up"),d("#usertab_toogle_icon").removeClass("icon-arrow-down"),d(this).attr("data-title",vApp.lang.getString("maxUserList"))),d("#chat_div").memberlist("option","boxManager").toggleBox())});uiFooterbartabCont=(this.uiFooterbartabCont=d("<div></div>")).attr("id","tabs").addClass("tabs-bottom").appendTo(a);uiFooterbartabs=(this.uiFooterbartabs=
d('<ul class="tabs"></ul>')).appendTo(uiFooterbartabCont);this._setWidth(this.options.width);this.init(this)},destroy:function(){this.element.remove();this._destroy()},_setWidth:function(a){this.uiFooterbar.width(a+"px")}})})(jQuery);(function(d){d.fn.clickToggle=function(a,b){var c=[a,b];this.data("toggleclicked",0);this.click(function(){var a=d(this).data(),b=a.toggleclicked;d.proxy(c[b],this)();a.toggleclicked=(b+1)%2});return this}})(jQuery);(function(d){d.widget("ui.memberlist",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,userSent:function(a){this.boxManager.addUsr(a.name)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addUsr:function(a){var b=this.elem.uiChatboxLog,c=document.createElement("div");b.append(c);if(a){b=document.createElement("a");b.href="#"+a.userid;b.classList.add("tooltip");b.setAttribute("data-title","Click to chat");var f=document.createElement("img");f.src=a.img;b.appendChild(f);
f=document.createElement("span");void 0==a.lname&&(a.lname="");d(f).text(a.name+" "+a.lname);b.appendChild(f);c.appendChild(b);b=["assign","audio","chat"];a.userid!=wbUser.id&&(b=vApp.user.createControl(a.userid,b),c.appendChild(b),vApp.user.control.shouldApply.call(vApp.user,a.userid));null!=localStorage.getItem("teacherId")&&null==localStorage.getItem("orginalTeacherId")&&a.userid==localStorage.getItem("aId")&&(b=["assign"],f=document.getElementById(a.userid+"ControlContainer"),null!=f?vApp.user.createAssignControl(f,
a.userid,!0):(f=document.getElementById("ml"+a.userid),b=vApp.user.createControl(a.userid,b),f.appendChild(b)))}d(c).addClass("ui-memblist-usr");d(c).attr("id","ml"+a.userid);d(c).fadeIn();this._scrollToBottom();a=localStorage.getItem("chatEnable");null!=a&&"false"==a&&vApp.user.control.disableOnLineUser()},highlightBox:function(){var a=this;a.elem.uiChatboxTitlebar.effect("highlight",{},300);a.elem.uiChatbox.effect("bounce",{times:3},300,function(){a.highlightLock=!1;a._scrollToBottom()})},toggleBox:function(){this.elem.uiChatbox.toggle("slide",
{direction:"down"},1E3)},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){this.uiChatboxContent.toggle();this.uiChatboxContent.is(":visible")},widget:function(){return this.uiChatbox},_create:function(){var a=this,b=a.options.title||"No Title",c=(a.uiChatbox=d("<div></div>")).appendTo(document.getElementById("chatWidget")).addClass("ui-widget ui-corner-top ui-memblist").attr("id","memlist").attr("outline",0).css("display","none").focusin(function(){a.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){a.uiChatboxTitlebar.removeClass("ui-state-focus")}),
f=(a.uiChatboxTitlebar=d("<div></div>")).addClass("ui-widget-header ui-corner-top ui-memblist-titlebar ui-dialog-header").click(function(a){}).appendTo(c);(a.uiChatboxTitle=d("<span></span>")).html('<span class="icon-user"> </span>'+b).appendTo(f);var g=(a.uiChatboxTitlebarClose=d('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon ").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")});uiChatboxTitlebarMinimize=(a.uiChatboxTitlebarMinimize=
d('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon").attr("role","button").hover(function(){uiChatboxTitlebarMinimize.addClass("ui-state-hover")},function(){uiChatboxTitlebarMinimize.removeClass("ui-state-hover")}).click(function(a){d("#chat_div").memberlist("option","boxManager").toggleBox();return!1}).appendTo(f);uiChatboxTitlebarMinimizeText=d("<span></span>").addClass("ui-icon ui-icon-minusthick").text("minimize").appendTo(uiChatboxTitlebarMinimize);uiChatboxContent=(a.uiChatboxContent=
d("<div></div>")).addClass("ui-widget-content ui-memblist-content ").appendTo(c);uiChatboxLog=(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-memblist-log").appendTo(uiChatboxContent).focusin(function(){var a=d(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)});f.find("*").add(f).disableSelection();d(document).on("click","#chat_div .ui-memblist-usr a",function(a){a=d(this);var b=a.attr("href");"undefined"!=typeof b&&(b=b.replace("#",""),a=a.find("span").html(),-1==d.inArray(b,vApp.chat.idList)&&
(vApp.chat.counter++,vApp.chat.idList.push(b),vApp.chat.vmstorage[b]=[],vApp.chat.vmstorage[b].push({userid:b,name:a})),chatboxManager.addBox(b,{dest:"dest"+vApp.chat.counter,title:"box"+vApp.chat.counter,first_name:a}),chatboxManager.init({user:{name:a},messageSent:function(a,b,c){d("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}}),a=b=null)});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a)},_setOption:function(a,b){if(null!=b)switch(a){case "hidden":b?
this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(a){this.uiChatboxTitlebar.width(a+"px");this.uiChatboxLog.width(a+"px")},_position:function(a){this.uiChatbox.css("right",a)}})})(jQuery);(function(d){d.widget("ui.chatbox",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,messageSent:function(a,b,c){this.boxManager.addMsg(b.name,c)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addMsg:function(a,b){var c=this.elem.uiChatboxLog,f=document.createElement("div");c.append(f);c=!1;if(a){var g=document.createElement("b");d(g).text(a+": ");f.appendChild(g)}else c=!0;c=document.createElement(c?"i":"span");d(c).text(b);f.appendChild(c);d(f).addClass("ui-chatbox-msg");
d(f).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){},toggleBox:function(){this.elem.uiChatbox.toggle()},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){},toggleContentbox:function(a){this.uiChatboxContent.is(":visible")?(this.uiChatboxInputBox.focus(),d(d('#tabs ul li[id = "tabcb'+this.options.id+
'"]')).removeClass("ui-state-active")):d(d('#tabs ul li[id="tabcb'+this.options.id+'"]')).addClass("ui-state-active");this.uiChatbox.toggle("slide",{direction:"down"},1E3)},widget:function(){return this.uiChatbox},_create:function(){createTab(this.options.id,this.options.title);var a=this,b=a.options.title||"No Title",c=(a.uiChatbox=d("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-chatbox").attr("id","cb"+a.options.id).attr("outline",0).focusin(function(){a.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){a.uiChatboxTitlebar.removeClass("ui-state-focus")}),
f=(a.uiChatboxTitlebar=d("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatbox-titlebar ui-dialog-header").click(function(a){}).appendTo(c);(a.uiChatboxTitle=d("<span></span>")).html(b).appendTo(f);var g=(a.uiChatboxTitlebarClose=d('<a href="#"></a>')).addClass("ui-corner-all ui-chatbox-icon ").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).click(function(b){c.hide();a.options.boxClosed(a.options.id);d("#tabcb"+a.options.id).remove();
delete vApp.chat.vmstorage[a.options.id];localStorage.removeItem(a.options.id);return!1}).appendTo(f);d("<span></span>").addClass("ui-icon ui-icon-closethick").text("close").appendTo(g);var k=(a.uiChatboxTitlebarMinimize=d('<a href = "#"></a>')).addClass("ui-corner-all ui-chatbox-icon").attr("role","button").hover(function(){k.addClass("ui-state-hover")},function(){k.removeClass("ui-state-hover")}).click(function(b){a.toggleContentbox(b);"hidden"==localStorage.getItem(a.options.id)?localStorage.removeItem(a.options.id):
localStorage.setItem(a.options.id,"hidden");return!1}).appendTo(f);d("<span></span>").addClass("ui-icon ui-icon-minusthick").text("minimize").appendTo(k);b=(a.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(c);(a.uiChatboxLog=a.element).addClass("ui-widget-content ui-chatbox-log").appendTo(b);var h=(a.uiChatboxInput=d("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(b),m=(a.uiChatboxInputBox=d("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ui-corner-all").prop("id",
"ta"+a.options.id).appendTo(h).keypress(function(b){if(b.keyCode&&b.keyCode==d.ui.keyCode.ENTER){msg=d.trim(d(this).val());if(0<msg.length){io.send(msg,a.options.id);d(this).val("");d("#"+a.options.id).chatbox("option").messageSent(a.options.id,{name:io.cfg.userobj.name},msg);b=a.options.id;"undefined"==typeof vApp.chat.vmstorage[b]&&(vApp.chat.vmstorage[b]=[]);var c=(new Date).getTime();vApp.chat.vmstorage[b].push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:c})}return!1}}).focusin(function(){m.addClass("ui-chatbox-input-focus");
var a=d(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){m.removeClass("ui-chatbox-input-focus")});f.find("*").add(f).disableSelection();b.children().click(function(){a.uiChatboxInputBox.focus()});a._setWidth(a.options.width);a._position(a.options.offset);a.options.boxManager.init(a);a.options.hidden||c.show();d(d('#tabs ul li[id = "tabcb'+a.options.id+'"]')).append(c)},_setOption:function(a,b){if(null!=b)switch(a){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();
break;case "offset":this._position(b);break;case "width":this._setWidth(b)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(a){this.uiChatbox.width(a+"px");this.uiChatboxInputBox.css("width",a-14+"px")},_position:function(a){}})})(jQuery);(function(d){d.widget("ui.chatroom",{options:{id:null,title:null,user:null,hidden:!1,offset:20,width:230,messageSent:function(a,b){this.boxManager.addMsg(a.name,b)},boxClosed:function(a){},boxManager:{init:function(a){this.elem=a},addMsg:function(a,b){var c=this.elem.uiChatboxLog,f=document.createElement("div");c.append(f);c=!1;if(a){var g=document.createElement("b");d(g).text(a+": ");f.appendChild(g)}else c=!0;c=document.createElement(c?"i":"span");d(c).text(b);f.appendChild(c);d(f).addClass("ui-chatbox-msg");
d(f).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){this.elem.uiChatboxTitlebar.addClass("ui-state-highlight");this.highlightLock=!1;this._scrollToBottom()},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom:function(){var a=this.elem.uiChatboxLog;a.scrollTop(a.get(0).scrollHeight)}}},toggleContent:function(a){this.uiChatboxContent.toggle();
this.uiChatboxContent.is(":visible")&&this.uiChatboxInputBox.focus()},widget:function(){return this.uiChatbox},_create:function(){var a=null!=localStorage.getItem("chatEnable")?"true"==localStorage.chatEnable?"enable":"disable":"enable",b=this,c=b.options,f=c.title||"No Title",a=(b.uiChatbox=d("<div></div>")).appendTo(document.getElementById("chatWidget")).addClass("ui-widget ui-corner-top ui-chatroom "+a).prop("id","chatrm").prop("outline",0).focusin(function(){b.uiChatboxTitlebar.removeClass("ui-state-highlight");
b.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){b.uiChatboxTitlebar.removeClass("ui-state-focus")}),g=(b.uiChatboxTitlebar=d("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatroom-titlebar ui-dialog-header").click(function(a){b.uiChatboxTitlebar.removeClass("ui-state-highlight")}).appendTo(a);(b.uiChatboxTitle=d("<span></span>")).html(f).appendTo(g);var k=(b.uiChatboxTitlebarMinimize=d('<a href="#"></a>')).addClass("ui-corner-all ui-chatbox-icon").prop("role","button").hover(function(){k.addClass("ui-state-hover")},
function(){k.removeClass("ui-state-hover")}).focus(function(){k.addClass("ui-state-focus")}).blur(function(){k.removeClass("ui-state-focus")}).click(function(a){c.boxManager.toggleBox();sessionStorage.setItem("chatroom_status","hidden");return!1}).appendTo(g);d("<span></span>").addClass("ui-icon ui-icon-minusthick").text("minimize").appendTo(k);f=(b.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(a);(b.uiChatboxLog=b.element).addClass("ui-widget-content ui-chatbox-log").appendTo(f);
var h=(b.uiChatboxInput=d("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(f),m=(b.uiChatboxInputBox=d("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ui-corner-all").prop("id","ta_chrm").appendTo(h).keydown(function(a){if(a.keyCode&&a.keyCode==d.ui.keyCode.ENTER){msg=d.trim(d(this).val());a={receiver:"chatroom",msg:msg};if(0<msg.length)if(io.send(a),d(this).val(""),b.options.messageSent({name:io.cfg.userobj.name},msg),a=(new Date).getTime(),
null!=sessionStorage.getItem("chatroom")){var c=JSON.parse(sessionStorage.getItem("chatroom"));c.push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:a});sessionStorage.setItem("chatroom",JSON.stringify(c))}else sessionStorage.setItem("chatroom",JSON.stringify([{userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:a}]));return!1}}).focusin(function(){m.addClass("ui-chatbox-input-focus");var a=d(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){m.removeClass("ui-chatbox-input-focus")});
g.find("*").add(g).disableSelection();f.children().click(function(){b.uiChatboxInputBox.focus()});b._setWidth(b.options.width);b._position(b.options.offset);b.options.boxManager.init(b);b.options.hidden||a.show()},_setOption:function(a,b){if(null!=b)switch(a){case "hidden":b?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(b);break;case "width":this._setWidth(b)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(a){this.uiChatbox.width(a+"px");this.uiChatboxInputBox.css("width",
a-14+"px")},_position:function(a){this.uiChatbox.css("left",a)}})})(jQuery);Array.indexOf||(Array.prototype.indexOf=function(d){for(var a=0;a<this.length;a++)if(this[a]==d)return a;return-1});
var chatboxManager=function(){var d=[],a=[],b={width:230,gap:20,maxBoxes:5,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b,c)}},c=function(c){var f=a.indexOf(c);if(-1!=f)for(a.splice(f,1),d.splice(f,1),diff=b.width+b.gap,c=f;c<a.length;c++)offset=$("#"+a[c]).chatbox("option","offset"),$("#"+a[c]).chatbox("option","offset",offset-diff);else alert("should not happen: "+c)},f=function(a,c,f){d.indexOf(c.userid);b.messageSent(a,c,f)};return{init:function(a){$.extend(b,a)},
addBox:function(g,k,h){h=a.indexOf(g);var m=d.indexOf(g);-1==h&&(-1!=m?($("#"+g).chatbox("option","offset",285+(b.width+b.gap)*a.length),$("#"+g).chatbox("option","boxManager").toggleBox(),a.push(g),k=-1,k=$("#tabs li").index($("#tabcb"+g)),$($(".tabs li")[k]).css("display","list-item"),$("#tabs").tabs("option","active",k),$("#tabs").tabs("show")):(void 0==k.last_name&&(k.last_name=""),h=document.createElement("div"),h.setAttribute("id",g),$(h).chatbox({id:g,user:k,title:k.first_name+" "+k.last_name,
hidden:!1,width:b.width,offset:285+(b.width+b.gap)*a.length,messageSent:f,boxClosed:c}),d.push(g),a.push(g)))},delBox:function(b){a=$.grep(a,function(a){return b!=a});d=$.grep(d,function(a){return b!=a})},dispatch:function(a,b){$("#"+a.userid).chatbox("option","boxManager").addMsg(a.name,b)}}}();function memberUpdate(d,a){var b=d.message,c="undefined"===typeof whiteboardPath?"../images/online.png":window.whiteboardPath+"images/online.png";if(0<b.length){var f=b.length-1;vApp.gObj.totalUser=[];for(var g=0;g<b.length;g++)vApp.gObj.totalUser.push(b[g].id);vApp.gObj.totalUser.sort();$("#user_list .inner_bt #usertab_icon").css({background:"url("+c+")no-repeat top left"})}$("#user_list .inner_bt #usertab_text").html("<span id='onlineusertext'>"+lang.whos+" ( "+f+" )</span> <span id='usertab_toogle_icon' class='icon-arrow-up'></span>");
$("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+" ("+f+")");0<b.length?(document.getElementById("chat_div")||(c=document.createElement("div"),c.id="chat_div",document.body.appendChild(c)),$("#chat_div").memberlist({id:"chat_div",user:b,offset:"7px",title:lang.online,userSent:function(a){$("#chat_div").memberlist("option","boxManager").addUsr(a)}}),$("#chat_div .ui-memblist-usr:not(.mySelf)").remove(),$.each(b,function(b,c){null==document.getElementById("video"+c.userid)&&$("#chat_div").memberlist("option").userSent(c);
c.userid==io.cfg.userid&&"undefined"!=typeof a&&"removed"!=a&&null==document.getElementById("video"+c.userid)&&vApp.gObj.video._handleUserMedia(c.userid);vApp.gObj.video.addUserRole(c.userid,c.role)})):$("div#memlist").length&&$("div#memlist").remove()}
function messageUpdate(d){var a=$.isPlainObject(d.message)?d.message.msg:d.message,b=d.toUser,c=d.fromUser,f=io.cfg.userid,g=(new Date).getTime();if("chatroom"==d.message.receiver&&(""==b||void 0==b))f==c.userid||vApp.chat.chatroombox||0!=$("div#chat_room").length||(d=document.createElement("div"),d.id="chat_room",document.body.appendChild(d),vApp.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:c,title:lang.chatroom_header,messageSent:function(a,b){$("#chat_room").chatroom("option",
"boxManager").addMsg(a.name,b)}})),$("#chat_room").chatroom("option").messageSent(c,a),null!=sessionStorage.getItem("chatroom")?(d=JSON.parse(sessionStorage.getItem("chatroom")),d.push({userid:c.userid,name:c.name,msg:a,time:g}),sessionStorage.setItem("chatroom",JSON.stringify(d))):sessionStorage.setItem("chatroom",JSON.stringify([{userid:c.userid,name:c.name,msg:a,time:g}]));else if(void 0!=b&&""!=b){if(f==b.userid&&c.userid!=f){if(-1==$.inArray(c.userid,vApp.chat.idList)){vApp.chat.counter++;vApp.chat.idList.push(c.userid);
if("undefined"==typeof c.lname){alert("hello guys");debugger}vApp.chat.vmstorage[c.userid]=[];vApp.chat.vmstorage[c.userid].push({userid:c.userid,name:c.name+" "+c.lname})}chatboxManager.addBox(c.userid,{dest:"dest"+vApp.chat.counter,title:"box"+vApp.chat.counter,first_name:c.name,last_name:c.lname});chatboxManager.init({user:c,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}});d=localStorage.getItem("chatEnable");null!=d&&"false"==d&&vApp.user.control.allChatDisable();
$("#"+c.userid).chatbox("option").messageSent(c.userid,c,a);$("li[aria-controls='tabcb"+c.userid+"']").addClass("ui-state-highlight");var k=c.userid}vApp.chat.vmstorage[k].push({userid:c.userid,name:c.name,msg:a,time:g})}}function statusUpdate(d,a,b){$("#"+d.userid).length&&($("#"+d.userid).chatbox("option").messageSent(d.userid,d,a),$("#ta"+d.userid).prop("disabled",b))}function common_chatbox_update(d,a){$("div#chat_room").length&&$("#chat_room").chatroom("option").messageSent(d,a)}
function newStatus(d){$.each(d.message,function(a,b){null!=d.newuser&&b.userid==d.newuser&&(statusUpdate(b,"Online",!1),common_chatbox_update(b,"Online"))})}function createTab(d,a){var b=$("#tabs").tabs(),c=$("div#tabs ul li").length;tabId="tabcb"+d;addTab(b,tabId,c,a)}
function addTab(d,a,b,c){var f=$("#tab_content");b=c||"Tab "+b;a=$(("<li id = '"+a+"' class = 'ui-state-default ui-corner-bottom ui-tabs-active ui-state-active' aria-controls = '"+a+"'><a href = '#{href}' class = 'ui-tabs-anchor'>#{label}</a> <a href = '#' role = 'button'class = 'ui-corner-all ui-chatbox-icon'><span class = 'ui-icon ui-icon-close'>close</span></a></li>").replace(/#\{href\}/g,"#"+a).replace(/#\{label\}/g,b));f.val();d.find(".ui-tabs-nav").append(a)}
function browserSupportsLocalStorage(){return"localStorage"in window&&null!=window.localStorage}
function displaycomChatHistory(){if(1<sessionStorage.length||1==sessionStorage.length&&null==sessionStorage.getItem("chatroom_status")){var d=document.createElement("div");d.id="chat_room";document.body.appendChild(d);d=JSON.parse(sessionStorage.getItem("chatroom"));$.each(d,function(a,b){1>a&&(vApp.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:b,title:"Common chat",messageSent:function(a,b){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}}));$("#chat_room").chatroom("option").messageSent(b,
b.msg)})}"hidden"==sessionStorage.getItem("chatroom_status")&&$("#chatrm").hide()}
function displayPvtChatHistory(){if(null!=localStorage.getItem(wbUser.sid)){var d=JSON.parse(localStorage.getItem(wbUser.sid));$.each(d,function(a,b){vApp.chat.counter++;vApp.chat.idList.push(a);$.each(b,function(b,d){1>b?(chatboxManager.addBox(a,{dest:"dest"+vApp.chat.counter,title:"box"+vApp.chat.counter,first_name:d.name}),chatboxManager.init({messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}})):$("#"+a).chatbox("option").messageSent(a,d,d.msg)});"hidden"==localStorage.getItem(a)&&
($("#cb"+a).hide(),$("#tabcb"+a).removeClass("ui-state-active"))})}}function display_error(d){$("<div id = 'dialog' title = 'VmChat Error:'></div>").prependTo("#stickybar");$("#dialog").html(d);$("#dialog").dialog()}function clearAllChatBox(){$(".ui-icon-closethick").trigger("click")};var lang={online:"Online Users",whos:"Who's online",chatroom:"Chatroom",chatroom_header:"Common Chat",error:"Something bad happend. Sorry!",wserror:"Browser does not support WebSocket",sterror:"This browser doesn't support Web Storage standard"};
